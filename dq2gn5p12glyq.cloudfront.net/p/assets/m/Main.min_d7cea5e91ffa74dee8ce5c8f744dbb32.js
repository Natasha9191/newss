!function(t){for(let t of __jqdeferred)$(t);__jqdeferred.length=0;class e{constructor(t){this._css=t}css(){return this._css}$(t){return!t&&this._cache||(this._cache=$(this._css))}join(t,i){return new e(this._css+i+t._css)}or(t){return this.join(t,", ")}and(t){return this.join(t,"")}anscestorOf(t){return this.join(t," ")}parentOf(t){return this.join(t,">")}followedBy(t){return this.join(t,"~")}immediatelyFollowedBy(t){return this.join(t,"+")}exists(t){return this.$(t).length>0}addClass(t){return this.$().addClass(t.name()),this}addClasses(...t){const e=t.map((t=>t.name())).join(" ");return this.$().addClass(e),this}removeClass(t){return this.$().removeClass(t.name()),this}removeClasses(...t){const e=t.map((t=>t.name())).join(" ");return this.$().removeClass(e),this}setClasses(...t){const e=t.map((t=>t.name())).join(" ");return this.$().attr("class",e),this}toggleClass(t,e){return this.$().toggleClass(t.name(),e),this}toggleClasses(t,...e){const i=e.map((t=>t.name())).join(" ");return this.$().toggleClass(i,t),this}hasClass(t){return this.$().hasClass(t.name())}addAttr(t){return this.$().attr(t,t),this}toggleAttr(t,e){return e?this.$().attr(t,t):this.$().removeAttr(t),this}removeAttr(t){return this.$().removeAttr(t),this}}class i extends e{tag(){return this.css()}constructor(t){super(t)}}class s extends e{name(){return this._name}constructor(t){super("."+t),this._name=t}elements(){return document.querySelectorAll(this.css())}}class n extends e{name(){return this._name}constructor(t){super("#"+t),this._name=t}el(){return document.getElementById(this._name)}}class r{constructor(t){this.key=t,this.caseSensitive=!0}caseInsensitive(){return this.caseSensitive=!1,this}exists(){return new e("["+this.key+"]")}build(t,i){return new e("["+this.key+t+'"'+i+'"'+(this.caseSensitive?"":" i")+"]")}equals(t){return this.build("=",t)}containsWhitespaceSeparatedToken(t){return this.build("~=",t)}equalsOrPlusDashStartsWith(t){return this.build("|=",t)}startsWith(t){return this.build("^=",t)}endsWidth(t){return this.build("$=",t)}contains(t){return this.build("*=",t)}}var o,a,h,c,l,u,d,p,m,g,f,w,v,y,b,x,C,S,P,T,M,k,A,I,E,R,_,D,F,B,O,L,z,U,W,N,G,H,q,X,V,Q,j,J,Y;!function(t){function o(t){return new r(t)}t.empty=new e(""),t.html=new e("html"),t.body=new e("body"),t.htmlBody=new e("html, body"),t.$window=$(window),t.data=function(t){return o("data-"+t)},t.attr=o,t.id=function(t){return new n(t)},t.c=function(t){return new s(t)},t.tag=function(t){return new i(t)}}(a||(a={})),function(t){t.active=new s("active")}(o||(o={})),function(t){let e,i,s,n,r,o,a,h,c,l,u,d,p,m,g,f,w,v,y;t.ScrollTarget=t.id("ScrollTarget"),t.active_key=t.c("active_key"),t.app_is_visible=t.c("app_is_visible"),t.app_starter=t.c("app_starter"),t.bttn=t.c("bttn"),t.bttn_dark=t.c("bttn_dark"),t.bttn_icon_left=t.c("bttn_icon_left"),t.bttn_icon_right=t.c("bttn_icon_right"),t.bttn_red=t.c("bttn_red"),t.bttn_short=t.c("bttn_short"),t.bttn_white=t.c("bttn_white"),t.bttn_wire=t.c("bttn_wire"),t.bttn_wire_white=t.c("bttn_wire_white"),t.cannot_run_app=t.c("cannot_run_app"),t.canvas_container=t.c("canvas_container"),t.chart=t.c("chart"),t.checkmark=t.c("checkmark"),t.checkmark_check=t.c("checkmark_check"),t.ctl_key=t.c("ctl_key"),t.dark_checker=t.c("dark_checker"),t.drop_ready=t.c("drop_ready"),t.dropdown_auto=t.c("dropdown_auto"),t.format_toggle=t.c("format_toggle"),t.grab_closed=t.c("grab_closed"),t.grab_open=t.c("grab_open"),t.hasDroppedImage=t.c("hasDroppedImage"),t.hasDroppedImageIndicator=t.c("hasDroppedImageIndicator"),t.hasNotDroppedImage=t.c("hasNotDroppedImage"),t.jsNotInitializedYet=t.c("jsNotInitializedYet"),t.modern_menu=t.c("modern_menu"),t.noselect=t.c("noselect"),t.paste_buttons=t.c("paste_buttons"),t.pasted=t.c("pasted"),t.popup_drop_target_container=t.c("popup_drop_target_container"),t.popup_drop_target_particles_container=t.c("popup_drop_target_particles_container"),t.svgz_toggle=t.c("svgz_toggle"),t.tabLink=t.c("tabLink"),t.v_key=t.c("v_key"),t.wrong_shake=t.c("wrong_shake"),function(e){let i,s,n,r;e.App=t.id("App-App"),e.DownloadLink=t.id("App-DownloadLink"),e.ModernizrAlert=t.id("App-ModernizrAlert"),e.ProgressLightbox=t.id("App-ProgressLightbox"),e.ProgressLightboxBar=t.id("App-ProgressLightboxBar"),e.appView=t.id("App-appView"),e.cancel_upload=t.c("App-cancel_upload"),e.exit_app=t.c("App-exit_app"),e.force_exit=t.c("App-force_exit"),e.new_from_url_link=t.c("App-new_from_url_link"),e.starter=t.c("App-starter"),function(e){e.Dialog=t.id("App-Error-Dialog"),e.Message=t.id("App-Error-Message"),e.RetryButton=t.id("App-Error-RetryButton")}(i=e.Error||(e.Error={})),function(e){e.CanvasContainer=t.id("App-ImageView-CanvasContainer"),e.LeftCanvas=t.id("App-ImageView-LeftCanvas"),e.RightCanvas=t.id("App-ImageView-RightCanvas"),e.single_pane=t.c("App-ImageView-single_pane")}(s=e.ImageView||(e.ImageView={})),function(e){let i,s,n;e.Dialog=t.id("App-Progress-Dialog"),e.bar=t.c("App-Progress-bar"),e.progress=t.c("App-Progress-progress"),function(e){e.Bar=t.id("App-Progress-Download-Bar"),e.Pane=t.id("App-Progress-Download-Pane")}(i||(i={})),e.Download=i,function(e){e.Bar=t.id("App-Progress-Process-Bar"),e.Pane=t.id("App-Progress-Process-Pane")}(s||(s={})),e.Process=s,function(e){e.Bar=t.id("App-Progress-Upload-Bar"),e.Pane=t.id("App-Progress-Upload-Pane")}(n||(n={})),e.Upload=n}(n=e.Progress||(e.Progress={})),function(e){e.Exit=t.id("App-Toolbar-Exit"),e.NumPanesGroup=t.id("App-Toolbar-NumPanesGroup"),e.Redo=t.id("App-Toolbar-Redo"),e.Reset=t.id("App-Toolbar-Reset"),e.ResultReview=t.id("App-Toolbar-ResultReview"),e.Revert=t.id("App-Toolbar-Revert"),e.RevertMenu=t.id("App-Toolbar-RevertMenu"),e.SegEditor=t.id("App-Toolbar-SegEditor"),e.Undo=t.id("App-Toolbar-Undo"),e.ViewBitmap=t.id("App-Toolbar-ViewBitmap"),e.ViewSingle=t.id("App-Toolbar-ViewSingle"),e.ViewSplit=t.id("App-Toolbar-ViewSplit"),e.Zoom1To1=t.id("App-Toolbar-Zoom1To1"),e.ZoomIn=t.id("App-Toolbar-ZoomIn"),e.ZoomOut=t.id("App-Toolbar-ZoomOut"),e.ZoomToFit=t.id("App-Toolbar-ZoomToFit"),e.revert_link=t.c("App-Toolbar-revert_link"),e.revert_swatch=t.c("App-Toolbar-revert_swatch")}(r=e.Toolbar||(e.Toolbar={}))}(e=t.App||(t.App={})),function(e){e.container=t.c("BeforeAfter-container"),e.divider=t.c("BeforeAfter-divider"),e.second_row=t.c("BeforeAfter-second_row"),e.try_this_btn=t.c("BeforeAfter-try_this_btn")}(i=t.BeforeAfter||(t.BeforeAfter={})),function(e){e.indicator=t.c("BinaryToggle-indicator"),e.indicator_inner=t.c("BinaryToggle-indicator_inner"),e.option=t.c("BinaryToggle-option"),e.option_left=t.c("BinaryToggle-option_left"),e.option_right=t.c("BinaryToggle-option_right"),e.toggle=t.c("BinaryToggle-toggle")}(s=t.BinaryToggle||(t.BinaryToggle={})),function(e){e.CardList=t.id("Card-CardList"),e.Template=t.id("Card-Template"),e.clippingMagic=t.c("Card-clippingMagic"),e.containerProcessing=t.c("Card-containerProcessing"),e.copy=t.c("Card-copy"),e.download=t.c("Card-download"),e.error=t.c("Card-error"),e.filename=t.c("Card-filename"),e.imageOriginal=t.c("Card-imageOriginal"),e.imageResult=t.c("Card-imageResult"),e.imageSize=t.c("Card-imageSize"),e.innerBottom=t.c("Card-innerBottom"),e.innerTop=t.c("Card-innerTop"),e.outer=t.c("Card-outer"),e.pixianBg=t.c("Card-pixianBg"),e.pixianFaceSticker=t.c("Card-pixianFaceSticker"),e.pixspy=t.c("Card-pixspy"),e.recompressor=t.c("Card-recompressor"),e.remove=t.c("Card-remove"),e.removeHovered=t.c("Card-removeHovered"),e.stateDone=t.c("Card-stateDone"),e.stateError=t.c("Card-stateError"),e.statePending=t.c("Card-statePending"),e.stateProcessing=t.c("Card-stateProcessing"),e.stateRegenerating=t.c("Card-stateRegenerating"),e.vectorMagic=t.c("Card-vectorMagic"),e.vectorizer=t.c("Card-vectorizer"),e.zazzle=t.c("Card-zazzle")}(n=t.Card||(t.Card={})),function(e){let i,s,n;e.StartRating=t.id("Comparison-StartRating"),function(e){let i,s;e.AdminInfo=t.id("Comparison-App-AdminInfo"),e.CanvasOriginal=t.id("Comparison-App-CanvasOriginal"),e.CanvasResult=t.id("Comparison-App-CanvasResult"),e.Container=t.id("Comparison-App-Container"),e.ProgressText=t.id("Comparison-App-ProgressText"),e.Viewport=t.id("Comparison-App-Viewport"),e.swapCanvases=t.c("Comparison-App-swapCanvases"),function(e){e.BgColor=t.id("Comparison-App-Buttons-BgColor"),e.BgSwatch=t.id("Comparison-App-Buttons-BgSwatch"),e.Exit=t.id("Comparison-App-Buttons-Exit"),e.Help=t.id("Comparison-App-Buttons-Help"),e.Next=t.id("Comparison-App-Buttons-Next"),e.Prev=t.id("Comparison-App-Buttons-Prev"),e.ThumbsDown=t.id("Comparison-App-Buttons-ThumbsDown"),e.ThumbsUp=t.id("Comparison-App-Buttons-ThumbsUp"),e.rating=t.c("Comparison-App-Buttons-rating")}(i=e.Buttons||(e.Buttons={})),function(e){e.Done=t.id("Comparison-App-Modals-Done"),e.DoneAll=t.id("Comparison-App-Modals-DoneAll"),e.Help=t.id("Comparison-App-Modals-Help")}(s=e.Modals||(e.Modals={}))}(i=e.App||(e.App={})),function(e){e.Table=t.id("Comparison-Originals-Table"),e.count=t.c("Comparison-Originals-count")}(s||(s={})),e.Originals=s,function(e){e.Table=t.id("Comparison-Results-Table"),e.count=t.c("Comparison-Results-count")}(n||(n={})),e.Results=n}(r=t.Comparison||(t.Comparison={})),function(e){e.show_copied=t.c("CopyToClipboard-show_copied"),e.show_copying=t.c("CopyToClipboard-show_copying"),e.show_failed=t.c("CopyToClipboard-show_failed"),e.supported=t.c("CopyToClipboard-supported")}(o=t.CopyToClipboard||(t.CopyToClipboard={})),function(e){e.grab_closed=t.c("Cursor-grab_closed"),e.move=t.c("Cursor-move"),e.resize_ew=t.c("Cursor-resize_ew"),e.resize_nesw=t.c("Cursor-resize_nesw"),e.resize_ns=t.c("Cursor-resize_ns"),e.resize_nwse=t.c("Cursor-resize_nwse")}(a=t.Cursor||(t.Cursor={})),function(e){e.Dialog=t.id("FatalError-Dialog"),e.Message=t.id("FatalError-Message")}(h=t.FatalError||(t.FatalError={})),function(e){let i;e.Field=t.id("FileInput-Field"),e.PasteTarget=t.id("FileInput-PasteTarget"),e.click_to_upload=t.c("FileInput-click_to_upload"),function(e){e.Dialog=t.id("FileInput-UploadFromWeb-Dialog"),e.DialogButton=t.id("FileInput-UploadFromWeb-DialogButton"),e.DialogInput=t.id("FileInput-UploadFromWeb-DialogInput"),e.MainButton=t.id("FileInput-UploadFromWeb-MainButton"),e.MainInput=t.id("FileInput-UploadFromWeb-MainInput"),e.show_dialog=t.c("FileInput-UploadFromWeb-show_dialog")}(i=e.UploadFromWeb||(e.UploadFromWeb={}))}(c=t.FileInput||(t.FileInput={})),function(e){e.outer_container=t.c("ImageList-outer_container")}(l=t.ImageList||(t.ImageList={})),function(e){e.capture=t.c("LevelSlider-capture"),e.hover=t.c("LevelSlider-hover"),e.label=t.c("LevelSlider-label"),e.left_btn=t.c("LevelSlider-left_btn"),e.line=t.c("LevelSlider-line"),e.rect=t.c("LevelSlider-rect"),e.right_btn=t.c("LevelSlider-right_btn"),e.selected=t.c("LevelSlider-selected"),e.tic=t.c("LevelSlider-tic"),e.zone=t.c("LevelSlider-zone")}(u=t.LevelSlider||(t.LevelSlider={})),function(e){let i,s,n,r,o,a,h;e.ResetToDefaults=t.id("Options-ResetToDefaults"),e.ResetToEcommerce=t.id("Options-ResetToEcommerce"),e.container=t.c("Options-container"),e.form_row=t.c("Options-form_row"),function(e){let i,s,n,r;e.group=t.c("Options-BackgroundStyleGroup-group"),function(e){e.attribute=t.c("Options-BackgroundStyleGroup-Custom-attribute"),e.input=t.c("Options-BackgroundStyleGroup-Custom-input"),e.row=t.c("Options-BackgroundStyleGroup-Custom-row")}(i||(i={})),e.Custom=i,function(e){e.attribute=t.c("Options-BackgroundStyleGroup-CustomColor-attribute"),e.input=t.c("Options-BackgroundStyleGroup-CustomColor-input"),e.row=t.c("Options-BackgroundStyleGroup-CustomColor-row")}(s||(s={})),e.CustomColor=s,function(e){e.attribute=t.c("Options-BackgroundStyleGroup-Transparent-attribute"),e.input=t.c("Options-BackgroundStyleGroup-Transparent-input"),e.row=t.c("Options-BackgroundStyleGroup-Transparent-row")}(n||(n={})),e.Transparent=n,function(e){e.attribute=t.c("Options-BackgroundStyleGroup-White-attribute"),e.input=t.c("Options-BackgroundStyleGroup-White-input"),e.row=t.c("Options-BackgroundStyleGroup-White-row")}(r||(r={})),e.White=r}(i=e.BackgroundStyleGroup||(e.BackgroundStyleGroup={})),function(e){let i,s;e.group=t.c("Options-CropAlignmentGroup-group"),function(e){e.attribute=t.c("Options-CropAlignmentGroup-Bottom-attribute"),e.input=t.c("Options-CropAlignmentGroup-Bottom-input"),e.row=t.c("Options-CropAlignmentGroup-Bottom-row")}(i||(i={})),e.Bottom=i,function(e){e.attribute=t.c("Options-CropAlignmentGroup-Middle-attribute"),e.input=t.c("Options-CropAlignmentGroup-Middle-input"),e.row=t.c("Options-CropAlignmentGroup-Middle-row")}(s||(s={})),e.Middle=s}(s=e.CropAlignmentGroup||(e.CropAlignmentGroup={})),function(e){let i;e.group=t.c("Options-JpegQualityGroup-group"),function(e){e.attribute=t.c("Options-JpegQualityGroup-JpegQuality-attribute"),e.input=t.c("Options-JpegQualityGroup-JpegQuality-input"),e.row=t.c("Options-JpegQualityGroup-JpegQuality-row")}(i||(i={})),e.JpegQuality=i}(n=e.JpegQualityGroup||(e.JpegQualityGroup={})),function(e){let i;e.group=t.c("Options-MarginGroup-group"),function(e){e.attribute=t.c("Options-MarginGroup-Margin-attribute"),e.input=t.c("Options-MarginGroup-Margin-input"),e.row=t.c("Options-MarginGroup-Margin-row")}(i||(i={})),e.Margin=i}(r=e.MarginGroup||(e.MarginGroup={})),function(e){let i,s;e.group=t.c("Options-OpaqueFileFormatGroup-group"),function(e){e.attribute=t.c("Options-OpaqueFileFormatGroup-Jpeg-attribute"),e.input=t.c("Options-OpaqueFileFormatGroup-Jpeg-input"),e.row=t.c("Options-OpaqueFileFormatGroup-Jpeg-row")}(i||(i={})),e.Jpeg=i,function(e){e.attribute=t.c("Options-OpaqueFileFormatGroup-Png-attribute"),e.input=t.c("Options-OpaqueFileFormatGroup-Png-input"),e.row=t.c("Options-OpaqueFileFormatGroup-Png-row")}(s||(s={})),e.Png=s}(o=e.OpaqueFileFormatGroup||(e.OpaqueFileFormatGroup={})),function(e){let i,s;e.group=t.c("Options-SuffixGroup-group"),function(e){e.attribute=t.c("Options-SuffixGroup-None-attribute"),e.input=t.c("Options-SuffixGroup-None-input"),e.row=t.c("Options-SuffixGroup-None-row")}(i||(i={})),e.None=i,function(e){e.attribute=t.c("Options-SuffixGroup-Pixian-attribute"),e.input=t.c("Options-SuffixGroup-Pixian-input"),e.row=t.c("Options-SuffixGroup-Pixian-row")}(s||(s={})),e.Pixian=s}(a=e.SuffixGroup||(e.SuffixGroup={})),function(e){let i;e.group=t.c("Options-TargetSizeGroup-group"),function(e){e.attribute=t.c("Options-TargetSizeGroup-TargetSize-attribute"),e.input=t.c("Options-TargetSizeGroup-TargetSize-input"),e.row=t.c("Options-TargetSizeGroup-TargetSize-row")}(i||(i={})),e.TargetSize=i}(h=e.TargetSizeGroup||(e.TargetSizeGroup={}))}(d=t.Options||(t.Options={})),function(e){let i;e.App=t.id("PreCrop-App"),e.ViewContainer=t.id("PreCrop-ViewContainer"),function(e){let i;e.cancel_button=t.c("PreCrop-Sidebar-cancel_button"),e.crop_button=t.c("PreCrop-Sidebar-crop_button"),e.cropped_image_aspect_ratio_display=t.c("PreCrop-Sidebar-cropped_image_aspect_ratio_display"),e.cropped_image_megapixels_display=t.c("PreCrop-Sidebar-cropped_image_megapixels_display"),e.cropped_image_size_display=t.c("PreCrop-Sidebar-cropped_image_size_display"),e.cropped_image_success=t.c("PreCrop-Sidebar-cropped_image_success"),e.cropped_image_warning=t.c("PreCrop-Sidebar-cropped_image_warning"),e.input_image_aspect_ratio_display=t.c("PreCrop-Sidebar-input_image_aspect_ratio_display"),e.input_image_megapixels_display=t.c("PreCrop-Sidebar-input_image_megapixels_display"),e.input_image_size_display=t.c("PreCrop-Sidebar-input_image_size_display"),e.lock_aspect_ratio_button=t.c("PreCrop-Sidebar-lock_aspect_ratio_button"),function(e){e.container=t.c("PreCrop-Sidebar-MaxNumMegapixels-container"),e.decrease=t.c("PreCrop-Sidebar-MaxNumMegapixels-decrease"),e.display=t.c("PreCrop-Sidebar-MaxNumMegapixels-display"),e.increase=t.c("PreCrop-Sidebar-MaxNumMegapixels-increase"),e.reset=t.c("PreCrop-Sidebar-MaxNumMegapixels-reset")}(i||(i={})),e.MaxNumMegapixels=i}(i=e.Sidebar||(e.Sidebar={}))}(p=t.PreCrop||(t.PreCrop={})),function(e){e.Body=t.id("RetryDialog-Body"),e.Countdown=t.id("RetryDialog-Countdown"),e.Dialog=t.id("RetryDialog-Dialog"),e.RetryNowButton=t.id("RetryDialog-RetryNowButton")}(m=t.RetryDialog||(t.RetryDialog={})),function(e){e.ImageList=t.id("Sidebar-ImageList"),e.download=t.c("Sidebar-download"),e.edit_icon=t.c("Sidebar-edit_icon"),e.filename=t.c("Sidebar-filename"),e.image=t.c("Sidebar-image"),e.main_row=t.c("Sidebar-main_row"),e.mode=t.c("Sidebar-mode"),e.mode_icon=t.c("Sidebar-mode_icon"),e.mode_label=t.c("Sidebar-mode_label"),e.mode_row=t.c("Sidebar-mode_row"),e.polish=t.c("Sidebar-polish"),e.remove=t.c("Sidebar-remove"),e.rest=t.c("Sidebar-rest"),e.slider=t.c("Sidebar-slider"),e.slider_label=t.c("Sidebar-slider_label"),e.smooth=t.c("Sidebar-smooth"),e.thumbnail=t.c("Sidebar-thumbnail"),e.title=t.c("Sidebar-title")}(g=t.Sidebar||(t.Sidebar={})),function(e){e.Dialog=t.id("Signon-Dialog"),e.Header=t.id("Signon-Header"),e.IframeContainer=t.id("Signon-IframeContainer"),e.LoadingIndicator=t.id("Signon-LoadingIndicator"),e.preload=t.c("Signon-preload"),e.trigger=t.c("Signon-trigger")}(f=t.Signon||(t.Signon={})),function(e){e.details_container=t.c("Totals-details_container"),e.image_count=t.c("Totals-image_count"),e.original_size=t.c("Totals-original_size"),e.outer_container=t.c("Totals-outer_container"),e.progress=t.c("Totals-progress"),e.reduction=t.c("Totals-reduction"),e.reduction_container=t.c("Totals-reduction_container"),e.result_size=t.c("Totals-result_size"),e.result_size_container=t.c("Totals-result_size_container"),e.save_all_btn=t.c("Totals-save_all_btn"),e.save_all_icon=t.c("Totals-save_all_icon"),e.save_all_spinner=t.c("Totals-save_all_spinner"),e.unit=t.c("Totals-unit")}(w=t.Totals||(t.Totals={})),function(e){e.Canvas=t.id("Viewer-Canvas"),e.CanvasContainer=t.id("Viewer-CanvasContainer"),e.CurrentImageDecrement=t.id("Viewer-CurrentImageDecrement"),e.CurrentImageDetails=t.id("Viewer-CurrentImageDetails"),e.CurrentImageIncrement=t.id("Viewer-CurrentImageIncrement"),e.DownloadCurrent=t.id("Viewer-DownloadCurrent"),e.DownloadCurrentIcon=t.id("Viewer-DownloadCurrentIcon"),e.DownloadCurrentSpinner=t.id("Viewer-DownloadCurrentSpinner"),e.ImageControlGroup=t.id("Viewer-ImageControlGroup"),e.ImageName=t.id("Viewer-ImageName"),e.LoadingIndicator=t.id("Viewer-LoadingIndicator"),e.LoadingIndicatorOver=t.id("Viewer-LoadingIndicatorOver"),e.LoadingIndicatorOverShade=t.id("Viewer-LoadingIndicatorOverShade"),e.NextImage=t.id("Viewer-NextImage"),e.PrevImage=t.id("Viewer-PrevImage"),e.ViewCompressedButton=t.id("Viewer-ViewCompressedButton"),e.ViewDifferenceButton=t.id("Viewer-ViewDifferenceButton"),e.ViewOriginalButton=t.id("Viewer-ViewOriginalButton"),e.backdrop=t.c("Viewer-backdrop"),e.blue_button=t.c("Viewer-blue_button"),e.cancel_button=t.c("Viewer-cancel_button"),e.clear_button=t.c("Viewer-clear_button"),e.container=t.c("Viewer-container"),e.highlight=t.c("Viewer-highlight"),e.layer_button=t.c("Viewer-layer_button"),e.pane_control_button=t.c("Viewer-pane_control_button"),e.toolbar=t.c("Viewer-toolbar"),e.underline_button=t.c("Viewer-underline_button"),e.zoom_1_to_1_button=t.c("Viewer-zoom_1_to_1_button"),e.zoom_in_button=t.c("Viewer-zoom_in_button"),e.zoom_out_button=t.c("Viewer-zoom_out_button"),e.zoom_to_fit_button=t.c("Viewer-zoom_to_fit_button")}(v=t.Viewer||(t.Viewer={})),function(e){e.AcceptTerms=t.id("merchant-AcceptTerms"),e.AcceptTermsWrapper=t.id("merchant-AcceptTermsWrapper"),e.BraintreeDropinContainer=t.id("merchant-BraintreeDropinContainer"),e.Cents=t.id("merchant-Cents"),e.CreditCardProcessorForm=t.id("merchant-CreditCardProcessorForm"),e.DefaultPaymentMethod=t.id("merchant-DefaultPaymentMethod"),e.FailedToLoadPaymentBackendJs=t.id("merchant-FailedToLoadPaymentBackendJs"),e.InitializingIndicator=t.id("merchant-InitializingIndicator"),e.PaymentError=t.id("merchant-PaymentError"),e.PaymentForm=t.id("merchant-PaymentForm"),e.PaymentMethodForm=t.id("merchant-PaymentMethodForm"),e.PaymentMethodFormSubmit=t.id("merchant-PaymentMethodFormSubmit"),e.RadioBraintree=t.id("paymentMethod_braintree"),e.RadioStripe=t.id("paymentMethod_stripe"),e.ShowWhenCreatingPm=t.id("merchant-ShowWhenCreatingPm"),e.ShowWhenMinibrowsing=t.id("merchant-ShowWhenMinibrowsing"),e.ShowWhenSubmitting=t.id("merchant-ShowWhenSubmitting"),e.StreamlexPaymentToken=t.id("merchant-StreamlexPaymentToken"),e.StripeCardElement=t.id("merchant-StripeCardElement"),e.StripeCardErrors=t.id("merchant-StripeCardErrors"),e.StripeNameElement=t.id("merchant-StripeNameElement"),e.StripeNameErrors=t.id("merchant-StripeNameErrors"),e.StripePaymentError=t.id("merchant-StripePaymentError"),e.SubmitSection=t.id("merchant-SubmitSection"),e.TaxLocationPostalCode=t.id("merchant-TaxLocationPostalCode"),e.TaxPostalCode=t.id("merchant-TaxPostalCode"),e.TaxPostalCodeFormGroup=t.id("merchant-TaxPostalCodeFormGroup"),e.TaxSection=t.id("merchant-TaxSection"),e.has_error=t.c("has-error"),e.radio_paymentMethod=t.c("radio_paymentMethod")}(y=t.merchant||(t.merchant={}))}(a||(a={})),function(t){const e=a.Signon.Dialog.anscestorOf(new s("modal-header")),i="message.signup",n=[];let r=null;function o(t){const e=t.originalEvent,i=function(t){for(let e of n)if(e.contentWindow==t)return e;return null}(e.source);if(i){let t=parseInt(e.data);t>10&&(i.height=t+"px"),i.hasLoaded||(i.hasLoaded=!0,l())}}function h(){c($(this))}function c(t){const e=t.data("url");if(null==r||r.src!=e){r=function(t){for(let e of n)if(e.src==t)return e;return null}(e)||function(t){let e=document.createElement("iframe");return e.setAttribute("seamless","seamless"),e.frameBorder="0",e.width="100%",e.height="650px",e.style.backgroundColor="#fff",e.hasLoaded=!1,e.onload=function(t){e.hasLoaded=!0,l()},e.src=t,n.push(e),a.Signon.IframeContainer.$().prepend(e),e}(e),r.style.display="block";for(let t of n)t!=r&&(t.style.display="none")}l()}function l(){a.Signon.LoadingIndicator.$().toggle(!(r&&r.hasLoaded))}function u(){const t=$(this);c(t),a.$window.on(i,o);const s=t.data("header");return s?(a.Signon.Header.$().text(s).show(),e.$().css("border-bottom","")):(a.Signon.Header.$().hide(),e.$().css("border-bottom","none")),a.Signon.Dialog.$().modal(),!1}t.checkInit=function(){a.Signon.Dialog.$().length>0&&a.Signon.trigger.$().length>0&&(a.Signon.Dialog.$().on("hide.bs.modal",(function(){a.$window.off(i)})),a.Signon.trigger.elements().forEach((t=>{t.addEventListener("touchstart",h,{passive:!0}),t.addEventListener("mouseover",h,{passive:!0})})),a.Signon.trigger.$().click(u),a.Signon.preload.$().each(h))}}(h||(h={})),function(t){function e(t,e){return t[e]}t.get=e,t.getOrElse=function(t,i,s){var n=e(t,i);return void 0===n?s:n},t.set=function(t,e,i){return t[e]=i},t.cast=function(t){return t}}(c||(c={})),function(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[],s=new Uint8Array(256);for(var n=0;n<64;n++)i[n]=e.charAt(n),s[e.charCodeAt(n)]=n;function r(t,e){return s[0|t.charCodeAt(e)]}function o(t){return i[63&t]}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63,t.decode=function(t){if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4. ");var e,i,s=t.length,n="="===t.charAt(s-2)?2:"="===t.charAt(s-1)?1:0,o=new Uint8Array(3*t.length/4-n),a=n>0?t.length-4:t.length,h=0;function c(t){o[h++]=255&t}for(e=0;e<a;e+=4)c((i=r(t,e)<<18|r(t,e+1)<<12|r(t,e+2)<<6|r(t,e+3))>>16),c(i>>8),c(i);return 2===n?c(i=r(t,e)<<2|r(t,e+1)>>4):1===n&&(c((i=r(t,e)<<10|r(t,e+1)<<4|r(t,e+2)>>2)>>8),c(i)),o},t.decodeString=function(t,e){try{return atob(t)}catch(t){}return e},t.encode=function(t,e){if(t instanceof Uint8Array){const r=(e=e||t.length)%3;var i,s="";const a=e-r;for(var n=0;n<a;n+=3)s+=o((i=(t[n]<<16)+(t[n+1]<<8)+t[n+2])>>18),s+=o(i>>12),s+=o(i>>6),s+=o(i);return 1==r?(s+=o((i=t[a])>>2),s+=o(i<<4),s+="=="):2==r&&(s+=o((i=(t[a]<<8)+t[a+1])>>10),s+=o(i>>4),s+=o(i<<2),s+="="),s.replace(/\!/,"!")}return btoa(c.cast(t))}}(l||(l={})),function(t){const e=[0];function i(t,e){return t.toFixed(e).replace(/\.?0+$/,"")}function s(t,e){"use strict";if(null==t)throw new TypeError("can't convert "+t+" to object");if((e=+e)!=e&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e==1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0==t.length||0==e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var i="",s=0;s<e;s++)i+=t;return i}function n(t,e){return(t%e+e)%e}function r(t,e){return(t%e-e)%e}function o(t){if(!t)return null;const e=t.match(/data:(.*?)(;base64)?,(.*)/);if(!e)return null;const i=e[1]||"text/plain",s=!!e[2],n=decodeURIComponent(e[3].trim());if(s){const t=l.decode(n);let e=new Blob([t],{type:i});return e.size!=t.length&&(e=new Blob([t.buffer],{type:i})),e}return new Blob([n],{type:i})}function a(t,e,i){return new File([t],e,{type:t.type,lastModified:i||Date.now()})}t.tic=function(){e.push(Date.now())},t.toc=function(t){Date.now(),e.pop()},t.toFixed=i,t.formatAspectRatio=function(t){return i(t.w,3)+":"+i(t.h,3)},t.hex=function(t,e){return("000000000"+t.toString(16)).substr(-e)},t.fuzzyAspectRatioEx=function(t,e){for(var i=t.w/t.h,s=0;s<e.length;s++){var n=e[s],r=n.w/n.h;if(Math.abs((i-r)/r)<.01)return n}return t.w>t.h?{w:t.w/t.h,h:1}:{w:1,h:t.h/t.w}},t.roundTo=function(t,e){return parseFloat(t.toFixed(e))},t.empty=function(){},t.sign=function(t){return 0==t?0:t>0?1:-1},t.clamp=function(t,e,i){return Math.max(e,Math.min(t,i))},t.log10=function(t){return Math.log(t)/Math.LN10},t.parseIntWithAlt=function(t,e,i){const s=parseInt(t,e);return isNaN(s)?i:s},t.padStart=function(t,e,i){return e>>=0,i=String(void 0!==i?i:" "),t.length>e?String(t):((e-=t.length)>i.length&&(i+=s(i,e/i.length)),i.slice(0,e)+String(t))},t.repeat=s,t.posMod=n,t.negMod=r,t.minMod=function(t,e){var i=n(t,e),s=r(t,e);return Math.abs(i)<=Math.abs(s)?i:s},t.startsWith=function(t,e){return 0==t.lastIndexOf(e,0)},t.endsWith=function(t,e){return t.indexOf(e,t.length-e.length)>=0},t.blobToArrayBuffer=function(t,e,i){var s=new FileReader;s.onerror=s.onabort=i,s.onloadend=function(t){e(c.cast(s.result))},s.readAsArrayBuffer(t)},t.blobToString=function(t,e,i){var s=new FileReader;s.onerror=s.onabort=i,s.onloadend=function(t){e(c.cast(s.result))},s.readAsText(t)},t.dataUrlToBlob=o,t.dataUrlToFile=function(t,e){return a(o(t),e)},t.blobToFile=a,t.svgStringToDataUrl=function(t){return"data:image/svg+xml;base64,"+btoa(t)},t.toDataUrl=function(t,e){return"data:"+e+";base64,"+l.encode(t)},t.min=function(t){return Math.min.apply(null,t)},t.max=function(t){return Math.max.apply(null,t)},t.minBy=function(t,e){if(0!=t.length){let i=0,s=t[0],n=e(s);for(let r=1;r<t.length;r++){let o=t[r],a=e(o);a<n&&(s=o,n=a,i=r)}return{min:s,value:n,index:i}}},t.maxBy=function(t,e){if(0!=t.length){let i=0,s=t[0],n=e(s);for(let r=1;r<t.length;r++){let o=t[r],a=e(o);a>n&&(s=o,n=a,i=r)}return{max:s,value:n,index:i}}},t.signedNumber=function(t){return 0==t?"0":t>0?"+"+t:""+t},t.splitExtensionFromFilename=function(t){let e=t.lastIndexOf(".");return e>=0?{base:t.substr(0,e),extension:t.substr(e+1)}:{base:t,extension:""}},t.dropExtension=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(0,e):t},t.getExtensionWithDot=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(e):""},t.getExtensionNoDot=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(e+1):""},t.parsePx=function(t){try{return parseInt(t)}catch(t){return 0}},t.colorBytesToRgbaCss=function(t){return"rgba("+t.join(",")+")"},t.colorBytesToAbgr32=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},t.colorBytesToRgba32=function(t){return t[0]<<24|t[1]<<16|t[2]<<8|t[3]},t.spliterate=function(t,e,i){for(var s,n=0;(s=t.indexOf(e,n))>=0;)i(t.substring(n,s)),n=s+e.length;n<t.length-1&&i(t.substring(n,t.length))},t.stringify=function(t){if(void 0===t)return"undefined";if(null==t)return"null";if(t.hasOwnProperty("message"))return t.message||"[No message]";if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t.toString()}},t.join16=function(t,e){return t.map((t=>(0|t).toString(16))).join(e)},t.uint8ArrayToString=function(t){for(var e="",i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return e},t.randomInt=function(t){return Math.floor(Math.random()*t)},t.randomInt2=function(t,e){return Math.floor(Math.random()*(e-t)+t)},t.centerElide=function(t,e){if(t&&t.length>=e){let i=Math.floor((e-4)/2);return t.substring(0,i)+"..."+t.substring(t.length-i)}return t},t.elide=function(t,e){return t&&t.length>=e?t.substring(0,e-3)+"...":t},t.sqr=function(t){return t*t},t.cube=function(t){return t*t*t},t.safeDiv=function(t,e,i=0){return 0==e?i:t/e},t.find=function(t,e){for(var i=0;i<t.length;i++)if(e(t[i]))return t[i];return null}}(E||(E={})),function(t){function e(t){return"undefined"==typeof csrfToken?t:t+(t.indexOf("?")<0?"?":"&")+csrfToken.name+"="+csrfToken.value}t.csrf=e,t.ajax=function(t){if("undefined"!=typeof csrfToken){"GET"!=(t.method||t.type||"GET").toUpperCase()&&(t.url=e(t.url||""))}return $.ajax(t)}}(u||(u={})),function(t){const e=/(''|[^']|^){(\d+)}/g,i=/(''|[^']|^){(\d+),plural,\s*(one\s*{([^}]*)})?\s*(few\s*{([^}]*)})?\s*other\s*{([^}]*)}\s*}/g;let s;t.s=function(t,...s){if(0==t.length)return"";const n=t;for(var r=t.length,o=0;o<r&&n.charCodeAt(o)<=32;)o++;for(;o<r&&n.charCodeAt(r-1)<=32;)r--;const a=0==o?"":n.substring(0,o);t=0==o&&r==n.length?n:n.substring(o,r);const h=r==n.length?"":n.substring(r,n.length);var c=window.I18nPhrases[t];return void 0===c&&(!function(t,e){if(window.I18nPhrases[t]=t,!window.I18nPhrases.__translations_disabled__){const s={en:t,args:e};u.ajax({url:"/logMissingI18nPhrase",method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(s)});const n=window.I18nPhrases||{};for(var i in n)n.hasOwnProperty(i)}}(t,s),c=t),s.length>0&&(c=(c=c.replace(e,(function(t,e,i){return"''"==e&&(e="'"),e+s[parseInt(i,10)]}))).replace(i,(function(t,e,i,n,r,o,a,h){"''"==e&&(e="'");const c=s[parseInt(i,10)];return e+(function(t,e,i){switch(GlobalsShared.locale.split("-")[0]){case"zh":case"ja":case"ko":case"tr":case"th":case"id":return;case"ru":return t%10==1&&t%100!=11?e:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?i:void 0;case"po":return 1==t?e:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?i:void 0;case"fr":case"pt":return t>1?e:void 0;default:return 1==t?e:void 0}}(parseInt(c),r,a)||h)}))),a&&(c=a+c),h&&(c+=h),c},t.commaList=function(t){return t.join(", ")},function(t){t.format=function(t){return"$"+t.toFixed(2)}}(s||(s={}));class n{constructor(t){this.currency=t}format(t){return this.currency+t.toFixed(2)}}const r={};function o(t,e,i=GlobalsShared.locale){const o=i+"-"+t,a=r[o]||(r[o]=function(t,e){try{return new Intl.NumberFormat(e,{style:"currency",currency:t})}catch(e){return"USD"==t?s:new n(t)}}(t,i));return a.format(e/100)}let a;t.dollars=function(t,e=GlobalsShared.locale){return o("USD",t,e)},t.currencyAmount=o,function(t){t.format=function(t){return(100*t).toFixed(0)+"%"}}(a||(a={}));const h={};t.percent=function(t,e=GlobalsShared.locale){return(h[e]||(h[e]=function(t){try{return new Intl.NumberFormat(t,{style:"percent",minimumFractionDigits:0})}catch(t){return a}}(e))).format(t/100)}}(d||(d={}));class Z{constructor(t){this.data=new Uint8Array(t),this.offsetCount=0}length(){return this.data.length}hasMore(){return this.offsetCount<this.data.length}skip(t){this.offsetCount+=t}nonEmpty(){return this.data.length>0}readInt8(){return this.data[this.offsetCount++]}readInt8s(t){var e=this.data.slice(this.offsetCount,this.offsetCount+t);return this.offsetCount+=t,e}readInt16(){return 256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readInt24(){return 256*this.data[this.offsetCount++]*256+256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readInt32(){return 256*this.data[this.offsetCount++]*256*256+256*this.data[this.offsetCount++]*256+256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readSignedInt16(){var t=this.readInt16();return t>=32768&&(t-=65536),t}}!function(t){const e={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},i={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},s={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},n={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};const r={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function o(t,e,i){for(var s,n,o,a,h=new DataView(t),l={},u=e;u<e+i;)28===h.getUint8(u)&&2===h.getUint8(u+1)&&(a=h.getUint8(u+2))in r&&((o=h.getInt16(u+3))+5,n=r[a],s=c(h,u+5,o),l.hasOwnProperty(n)?l[n]instanceof Array?l[n].push(s):l[n]=[l[n],s]:l[n]=s),u++;return l}function a(t,e,i,s,n){var r,o,a=t.getUint16(i,!n),c={};for(o=0;o<a;o++)r=i+12*o+2,c[s[t.getUint16(r,!n)]]=h(t,r,e,i,n);return c}function h(t,e,i,s,n){var r,o,a,h,l,u,d=t.getUint16(e+2,!n),p=t.getUint32(e+4,!n),m=t.getUint32(e+8,!n)+i;switch(d){case 1:case 7:if(1==p)return t.getUint8(e+8);for(r=p>4?m:e+8,o=[],h=0;h<p;h++)o[h]=t.getUint8(r+h);return o;case 2:return c(t,r=p>4?m:e+8,p-1);case 3:if(1==p)return t.getUint16(e+8,!n);for(r=p>2?m:e+8,o=[],h=0;h<p;h++)o[h]=t.getUint16(r+2*h,!n);return o;case 4:if(1==p)return t.getUint32(e+8,!n);for(o=[],h=0;h<p;h++)o[h]=t.getUint32(m+4*h,!n);return o;case 5:if(1==p)return l=t.getUint32(m,!n),u=t.getUint32(m+4,!n),(a=new Number(l/u)).numerator=l,a.denominator=u,a;for(o=[],h=0;h<p;h++)l=t.getUint32(m+8*h,!n),u=t.getUint32(m+4+8*h,!n),o[h]=new Number(l/u),o[h].numerator=l,o[h].denominator=u;return o;case 9:if(1==p)return t.getInt32(e+8,!n);for(o=[],h=0;h<p;h++)o[h]=t.getInt32(m+4*h,!n);return o;case 10:if(1==p)return t.getInt32(m,!n)/t.getInt32(m+4,!n);for(o=[],h=0;h<p;h++)o[h]=t.getInt32(m+8*h,!n)/t.getInt32(m+4+8*h,!n);return o}}function c(t,e,i){for(var s="",n=e;n<e+i;n++)s+=String.fromCharCode(t.getUint8(n));return s}function l(t,r,o){if("Exif"!=c(t,r,4))return!1;var h,l,u,d,p,m=r+6;if(18761==t.getUint16(m))h=!1;else{if(19789!=t.getUint16(m))return!1;h=!0}if(42!=t.getUint16(m+2,!h))return!1;var g=t.getUint32(m+4,!h);if(g<8)return!1;if((l=a(t,m,m+g,i,h)).ExifIFDPointer)for(u in d=a(t,m,m+l.ExifIFDPointer,e,h)){switch(u){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":d[u]=n[u][d[u]];break;case"ExifVersion":case"FlashpixVersion":d[u]=String.fromCharCode(d[u][0],d[u][1],d[u][2],d[u][3]);break;case"ComponentsConfiguration":d[u]=n.Components[d[u][0]]+n.Components[d[u][1]]+n.Components[d[u][2]]+n.Components[d[u][3]]}l[u]=d[u]}if(l.GPSInfoIFDPointer)for(u in p=a(t,m,m+l.GPSInfoIFDPointer,s,h)){if("GPSVersionID"===u)p[u]=p[u][0]+"."+p[u][1]+"."+p[u][2]+"."+p[u][3];l[u]=p[u]}return l}t.readFromBinaryFile=function(t){const e=function(t){var e=new DataView(t);if(255!=e.getUint8(0)||216!=e.getUint8(1))return!1;for(var i=2,s=t.byteLength,n=function(t,e){return 56===t.getUint8(e)&&66===t.getUint8(e+1)&&73===t.getUint8(e+2)&&77===t.getUint8(e+3)&&4===t.getUint8(e+4)&&4===t.getUint8(e+5)};i<s;){if(n(e,i)){var r=e.getUint8(i+7);return r%2!=0&&(r+=1),0===r&&(r=4),o(t,i+8+r,e.getUint16(i+6+r))}i++}}(t),i=function(t){var e=new DataView(t);if(255!=e.getUint8(0)||216!=e.getUint8(1))return!1;for(var i=2,s=t.byteLength;i<s;){if(255!=e.getUint8(i))return!1;if(225==e.getUint8(i+1))return l(e,i+4,e.getUint16(i+2));i+=2+e.getUint16(i+2)}}(t);return{iptc:e,exif:i}}}(p||(p={})),function(t){t[t.Undefined=0]="Undefined",t[t.R0=1]="R0",t[t.R90=2]="R90",t[t.R180=3]="R180",t[t.R270=4]="R270"}(m||(m={})),function(t){t[t.Undefined=0]="Undefined",t[t.Uncalibrated=1]="Uncalibrated",t[t.sRgb=2]="sRgb",t[t.adobeRgb=3]="adobeRgb"}(g||(g={})),function(t){t[t.Success=0]="Success",t[t.ErrorFileReader=1]="ErrorFileReader",t[t.ErrorParse=2]="ErrorParse",t[t.ErrorException=3]="ErrorException"}(f||(f={})),function(t){t[t.Undefined=0]="Undefined",t[t.None=1]="None",t[t.Inch=2]="Inch",t[t.Centimeter=3]="Centimeter",t[t.Meter=4]="Meter"}(w||(w={}));class K{constructor(t,e,i,s,n,r,o,a){this.statusCode=t,this.width=e,this.height=i,this.orientation=s,this.resolutionUnits=n,this.resolutionX=r,this.resolutionY=o,this.colorSpace=a,this.wasRotated=!1}applyOrientation(){if(this.orientation==m.R90||this.orientation==m.R270){let t=this.width;this.width=this.height,this.height=t}this.wasRotated=!0}getRawDpi(){let t=this.resolutionX.valueOf();if(t<=0)return 72;switch(this.resolutionUnits){case w.Inch:return t;case w.Centimeter:return 2.54*t;case w.Meter:return 2.54*t/100;default:return 72}}dpi(){let t=this.getRawDpi(),e=Math.round(t),i=Math.abs(t-e);return 0<i&&i<.01?e:t}}!function(t){const e=[137,80,78,71,13,10,26,10],i=new Number(0);function s(t){return new K(t,0,0,m.Undefined,w.Undefined,0,0,g.Undefined)}t.inverseOrientation=function(t){switch(t){default:case m.Undefined:return m.Undefined;case m.R0:return m.R0;case m.R90:return m.R270;case m.R180:return m.R180;case m.R270:return m.R90}},t.get=function(t,n){E.blobToArrayBuffer(t,(function(r){try{let o=new Z(r);switch(t.type){case"image/png":n(function(t){for(let i=0;i<e.length&&t.hasMore();i++)if(e[i]!=t.readInt8())return s(f.ErrorParse);let i=0,n=0,r=0,o=0,a=w.Undefined,h=g.Undefined,c=m.Undefined;for(;t.hasMore();){let e=t.readInt32(),s=E.uint8ArrayToString(t.readInt8s(4));if("pHYs"==s){i=t.readInt32(),n=t.readInt32();let e=t.readInt8();a=0==e?w.None:1==e?w.Meter:w.Undefined}else if("IHDR"==s){let i=t.offsetCount;r=t.readInt32(),o=t.readInt32(),t.offsetCount=i,t.readInt8s(e)}else if("iCCP"==s){let i=t.offsetCount,s="",n=t.readInt8(),r=0;for(;0!=n&&r<79;)s+=String.fromCharCode(n),n=t.readInt8(),r++;t.readInt8s(e-(t.offsetCount-i))}else t.readInt8s(e);t.readInt32()}return new K(f.Success,r,o,c,a,i,n,h)}(o));break;case"image/jpg":case"image/jpeg":n(function(t){let e=i,s=i,n=0,r=0,o=w.Undefined,a=g.Undefined,h=m.Undefined,l=p.readFromBinaryFile(t.data.buffer);if(l.exif){e=c.getOrElse(l.exif,"XResolution",i),s=c.getOrElse(l.exif,"YResolution",i),n=c.getOrElse(l.exif,"ImageWidth",0),r=c.getOrElse(l.exif,"ImageHeight",0);let t=c.getOrElse(l.exif,"ResolutionUnit",0);o=3==t?w.Centimeter:2==t?w.Inch:1==t?w.None:w.Undefined;let u=c.getOrElse(l.exif,"ColorSpace",0);a=65535==u?g.Uncalibrated:1==u?g.sRgb:g.Undefined;let d=c.getOrElse(l.exif,"Orientation",0);h=1==d?m.R0:3==d?m.R180:6==d?m.R90:8==d?m.R270:m.Undefined}return new K(f.Success,n,r,h,o,e,s,a)}(o));break;default:n(s(f.ErrorParse))}}catch(t){n(s(f.ErrorException))}}),(function(t){n(s(f.ErrorFileReader))}))}}(v||(v={}));class tt{constructor(t,e){this.x=t,this.y=e}static empty(){return new tt(0,0)}static zero(){return new tt(0,0)}static nan(){return new tt(Number.NaN,Number.NaN)}static from(t){return new tt(t.x,t.y)}toString(){return"("+this.x+", "+this.y+")"}inFinite(){return this.isFinite()}isFinite(){return isFinite(this.x)&&isFinite(this.y)}isNaN(){return isNaN(this.x)||isNaN(this.y)}interpolate(t,e){return new tt(this.x*(1-e)+t.x*e,this.y*(1-e)+t.y*e)}setInterpolated(t,e,i){return this.setXy(t.x*(1-i)+e.x*i,t.y*(1-i)+e.y*i)}distanceSqrTo(t){let e=this.x-t.x,i=this.y-t.y;return e*e+i*i}distanceTo(t){return Math.sqrt(this.distanceSqrTo(t))}offset(t,e){return new tt(this.x+t,this.y+e)}set(t){return this.x=t.x,this.y=t.y,this}setXy(t,e){return this.x=t,this.y=e,this}setNan(){return this.setXy(Number.NaN,Number.NaN)}round(){return new tt(Math.round(this.x),Math.round(this.y))}floor(){return new tt(Math.floor(this.x),Math.floor(this.y))}snap(t=.5,e=.5){return new tt(Math.floor(this.x)+t,Math.floor(this.y)+e)}rotateInPlace(t,e){const i=Math.sin(t),s=Math.cos(t),n=this.x-e.x,r=this.y-e.y;return this.setXy(e.x+s*n-i*r,e.y+i*n+s*r),this}rotateInto(t,e,i,s,n){const r=this.x-i,o=this.y-s;n.setXy(i+t*r-e*o,s+e*r+t*o)}rotate(t,e){const i=Math.sin(t),s=Math.cos(t),n=this.x-e.x,r=this.y-e.y;return new tt(e.x+s*n-i*r,e.y+i*n+s*r)}plusEquals(t){return this.x+=t.x,this.y+=t.y,this}plusEqualsXy(t,e){return this.x+=t,this.y+=e,this}plusEqualsScaled(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}equals(t){return t&&this.x==t.x&&this.y==t.y}notEquals(t){return!this.equals(t)}minusEquals(t){return this.x-=t.x,this.y-=t.y,this}minusXyEquals(t,e){return this.x-=t,this.y-=e,this}minus(t){return new tt(this.x-t.x,this.y-t.y)}plus(t){return new tt(this.x+t.x,this.y+t.y)}times(t){return new tt(t*this.x,t*this.y)}timesEquals(t){return this.x*=t,this.y*=t,this}cross(t){return this.x*t.y-this.y*t.x}ortho(){return new tt(this.y,-this.x)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSqr(){return this.x*this.x+this.y*this.y}normalize(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}capLength(t){let e=this.length();return e>t&&this.timesEquals(t/e),this}dup(){return tt.from(this)}}!function(t){t[t.TopLeft=0]="TopLeft",t[t.Top=1]="Top",t[t.TopRight=2]="TopRight",t[t.Right=3]="Right",t[t.BottomRight=4]="BottomRight",t[t.Bottom=5]="Bottom",t[t.BottomLeft=6]="BottomLeft",t[t.Left=7]="Left",t[t.Center=8]="Center"}(y||(y={})),function(t){t.opposite=function(e){switch(e){case t.TopLeft:return t.BottomRight;case t.Top:return t.Bottom;case t.TopRight:return t.BottomLeft;case t.Right:return t.Left;case t.BottomRight:return t.TopLeft;case t.Bottom:return t.Top;case t.BottomLeft:return t.TopRight;case t.Left:return t.Right;case t.Center:return t.Center}return t.Center},t.flipX=function(e){switch(e){case t.TopLeft:return t.TopRight;case t.Top:return t.Top;case t.TopRight:return t.TopLeft;case t.Right:return t.Left;case t.BottomRight:return t.BottomLeft;case t.Bottom:return t.Bottom;case t.BottomLeft:return t.BottomRight;case t.Left:return t.Right;case t.Center:return t.Center}return t.Center},t.flipY=function(e){switch(e){case t.TopLeft:return t.BottomLeft;case t.Top:return t.Bottom;case t.TopRight:return t.BottomRight;case t.Right:return t.Right;case t.BottomRight:return t.TopRight;case t.Bottom:return t.Top;case t.BottomLeft:return t.TopLeft;case t.Left:return t.Left;case t.Center:return t.Center}return t.Center},t.interpolationCoefficientsFor=function(e){switch(e){case t.TopLeft:return{tx:0,ty:0};case t.Top:return{tx:.5,ty:0};case t.TopRight:return{tx:1,ty:0};case t.Right:return{tx:1,ty:.5};case t.BottomRight:return{tx:1,ty:1};case t.Bottom:return{tx:.5,ty:1};case t.BottomLeft:return{tx:0,ty:1};case t.Left:return{tx:0,ty:.5};case t.Center:return{tx:.5,ty:.5}}return{tx:.5,ty:.5}}}(y||(y={}));class et{constructor(t,e,i,s){this.p0=t,this.p1=e,this.p2=i,this.p3=s,this.points=[],this.points.push(t,e,i,s)}static empty(){return new et(tt.empty(),tt.empty(),tt.empty(),tt.empty())}set(t){return this.p0.set(t.p0),this.p1.set(t.p1),this.p2.set(t.p2),this.p3.set(t.p3),this}dup(){return new et(this.p0.dup(),this.p1.dup(),this.p2.dup(),this.p3.dup())}contains(t,e){var i=!1;const s=this.points.length;for(var n=0;n<s;n++){var r=this.points[n],o=this.points[(n+1)%s];(o.y<e&&r.y>=e||r.y<e&&o.y>=e)&&o.x+(e-o.y)/(r.y-o.y)*(r.x-o.x)<t&&(i=!i)}return i}isConvex(){function t(t){return t<0?-1:t>0?1:0}var e=this.p1.minus(this.p0),i=this.p2.minus(this.p1),s=this.p3.minus(this.p2),n=this.p0.minus(this.p3),r=t(e.cross(i)),o=t(i.cross(s)),a=t(s.cross(n)),h=t(n.cross(e));return r==o&&r==a&&r==h}rotateInPlace(t,e){return this.p0.rotateInPlace(t,e),this.p1.rotateInPlace(t,e),this.p2.rotateInPlace(t,e),this.p3.rotateInPlace(t,e),this}rotate(t,e){return this.dup().rotateInPlace(t,e)}}class it{constructor(t,e,i,s){this.left=t,this.top=e,this.right=i,this.bottom=s}static empty(){return new it(0,0,0,0)}static unit(){return new it(0,0,1,1)}static fromBoundingRect(t){return new it(t[0],t[1],t[2],t[3])}static fromCropRect(t){return new it(t.left0,t.top0,t.right0,t.bottom0)}static fromPoints(t){if(0==t.length)return null;for(var e=t[0],i=new it(e.x,e.y,e.x,e.y),s=1;s<t.length;s++)i.addPoint(t[s]);return i}static fromQuad(t){return it.fromPoints(t.points)}dup(){return new it(this.left,this.top,this.right,this.bottom)}setNull(){return this.set(null,null,null,null)}setFrom(t){return this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom,this}set(t,e,i,s){return this.left=t,this.top=e,this.right=i,this.bottom=s,this}fromCropRect(t){return this.set(t.left0,t.top0,t.right0,t.bottom0)}containsPoint(t){return this.left<=t.x&&t.x<=this.right&&this.top<=t.y&&t.y<=this.bottom}intersectionWith(t){return this.left=Math.max(this.left,t.left),this.top=Math.max(this.top,t.top),this.right=Math.min(this.right,t.right),this.bottom=Math.min(this.bottom,t.bottom),this}leftCenter(){return new tt(this.left,.5*(this.top+this.bottom))}topLeft(){return new tt(this.left,this.top)}topCenter(){return new tt(.5*(this.left+this.right),this.top)}topRight(){return new tt(this.right,this.top)}rightCenter(){return new tt(this.right,.5*(this.top+this.bottom))}bottomLeft(){return new tt(this.left,this.bottom)}bottomCenter(){return new tt(.5*(this.left+this.right),this.bottom)}bottomRight(){return new tt(this.right,this.bottom)}center(){return new tt(.5*(this.left+this.right),.5*(this.top+this.bottom))}translate(t,e){return this.top+=e,this.bottom+=e,this.left+=t,this.right+=t,this}point(t){switch(t){case y.TopLeft:return this.interpolate(0,0);case y.Top:return this.interpolate(.5,0);case y.TopRight:return this.interpolate(1,0);case y.Right:return this.interpolate(1,.5);case y.BottomRight:return this.interpolate(1,1);case y.Bottom:return this.interpolate(.5,1);case y.BottomLeft:return this.interpolate(0,1);case y.Left:return this.interpolate(0,.5);case y.Center:return this.interpolate(.5,.5)}return this.interpolate(.5,.5)}setAnchorPoint(t,e){switch(t){case y.TopLeft:this.left=e.x,this.top=e.y;break;case y.Top:this.top=e.y;break;case y.TopRight:this.top=e.y,this.right=e.x;break;case y.Right:this.right=e.x;break;case y.BottomRight:this.right=e.x,this.bottom=e.y;break;case y.Bottom:this.bottom=e.y;break;case y.BottomLeft:this.left=e.x,this.bottom=e.y;break;case y.Left:this.left=e.x;case y.Center:}return this}moveAnchorTo(t,e){let i=this.point(t);return this.translate(e.x-i.x,e.y-i.y),this}moveAnchor(t,e){switch(t){case y.TopLeft:this.left=Math.min(this.left+e.x,this.right),this.top=Math.min(this.top+e.y,this.bottom);break;case y.Top:this.top=Math.min(this.top+e.y,this.bottom);break;case y.TopRight:this.top=Math.min(this.top+e.y,this.bottom),this.right=Math.max(this.right+e.x,this.left);break;case y.Right:this.right=Math.max(this.right+e.x,this.left);break;case y.BottomRight:this.right=Math.max(this.right+e.x,this.left),this.bottom=Math.max(this.bottom+e.y,this.top);break;case y.Bottom:this.bottom=Math.max(this.bottom+e.y,this.top);break;case y.BottomLeft:this.left=Math.min(this.left+e.x,this.right),this.bottom=Math.max(this.bottom+e.y,this.top);break;case y.Left:this.left=Math.min(this.left+e.x,this.right);break;case y.Center:this.left+=e.x,this.top+=e.y,this.right+=e.x,this.bottom+=e.y}return this}moveAnchorToMinSize(t,e,i){var s=Math.max(0,e-this.width()),n=Math.max(0,i-this.height());switch(t){case y.TopLeft:this.left-=s,this.top-=n;break;case y.Top:this.top-=n;break;case y.TopRight:this.top-=n,this.right+=s;break;case y.Right:this.right+=s;break;case y.BottomRight:this.right+=s,this.bottom+=n;break;case y.Bottom:this.bottom+=n;break;case y.BottomLeft:this.left-=s,this.bottom+=n;break;case y.Left:this.left-=s;break;case y.Center:s*=.5,n*=.5,this.left-=s,this.right+=s,this.top-=n,this.bottom+=n}return this}forceAspectRatio(t,e){const i=t*this.width();var s=0,n=0;e==y.TopLeft||e==y.TopRight||e==y.BottomRight||e==y.BottomLeft?i>this.height()?s=i-this.height():n=this.height()/t-this.width():e==y.Top||e==y.Bottom?n=this.height()/t-this.width():s=i-this.height();const r=.5*n,o=.5*s;switch(e){case y.Top:this.bottom+=s,this.left-=r,this.right+=r;break;case y.Left:this.right+=n,this.top-=o,this.bottom+=o;break;case y.Bottom:this.top-=s,this.left-=r,this.right+=r;break;case y.Right:this.left-=n,this.top-=o,this.bottom+=o;break;case y.TopLeft:this.bottom+=s,this.right+=n;break;case y.TopRight:this.bottom+=s,this.left-=n;break;case y.BottomRight:this.top-=s,this.left-=n;break;case y.BottomLeft:this.top-=s,this.right+=n;break;case y.Center:this.top-=o,this.bottom+=o,this.left-=r,this.right+=r}return this}interpolate(t,e){return new tt(this.left*(1-t)+t*this.right,this.top*(1-e)+e*this.bottom)}transform(t,e){return new tt(e.left+(t.x-this.left)/this.width()*e.width(),e.top+(t.y-this.top)/this.height()*e.height())}sampleGrid(t,e){for(var i=[],s=0;s<e;s++)for(var n=s/(e-1),r=0;r<t;r++)i.push(this.interpolate(r/(t-1),n));return i}setHorizontal(t){return this.left=t.left,this.right=t.right,this}padToFit(t){var e=0,i=0;return e=Math.max(e,this.left-t.left),e=Math.max(e,t.right-this.right),i=Math.max(i,this.top-t.top),i=Math.max(i,t.bottom-this.bottom),this.left-=e,this.right+=e,this.top=Math.min(this.top,t.top),this.bottom=Math.max(this.bottom,t.bottom),this}addRect(t){return this.left=Math.min(this.left,t.left),this.right=Math.max(this.right,t.right),this.top=Math.min(this.top,t.top),this.bottom=Math.max(this.bottom,t.bottom),this}addPoint(t){this.left=Math.min(this.left,t.x),this.top=Math.min(this.top,t.y),this.right=Math.max(this.right,t.x),this.bottom=Math.max(this.bottom,t.y)}addPointSafe(t){t&&(null==this.left?(this.left=t.x,this.top=t.y,this.right=t.x,this.bottom=t.y):this.addPoint(t))}width(){return this.right-this.left}height(){return this.bottom-this.top}pad(t,e,i,s){return null==e&&(e=t),null==i&&(i=t),null==s&&(s=e),this.left-=t,this.top-=e,this.right+=i,this.bottom+=s,this}padBottom(t){return this.bottom+=t,this}toQuad(){return new et(this.topLeft(),this.topRight(),this.bottomRight(),this.bottomLeft())}snap(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this}round(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this}normalize(){var t=Math.min(this.left,this.right),e=Math.max(this.left,this.right),i=Math.min(this.top,this.bottom),s=Math.max(this.top,this.bottom);return this.left=t,this.right=e,this.top=i,this.bottom=s,this}}!function(t){let e=!1,i=new Image;i.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k=",i.onload=function(){e=2==i.width&&3==i.height},t.BrowserRotates=function(){return e}}(b||(b={})),function(t){t.RecodeJpegQuality=.95;const e=new Set(["image/png","image/jpeg"]);function i(e,i,s,n){v.get(e,(function(r){E.loadImageFromBlob(e,s,(e=>{if(r.statusCode!=f.Success||r.orientation==m.R0||r.orientation==m.Undefined||b.BrowserRotates()){const s=t.imageToCanvasEx(e,i);s.wasRotated=!1,n(s,r)}else{const s=t.rotateImageToCanvasEx(e,r.orientation,i);s.wasRotated=!0,r.applyOrientation(),n(s,r)}}))}))}function s(t,e){const i=t.naturalWidth,s=t.naturalHeight;let n=new nt(i,s);return n.wasShrunk=!1,n.context().setGlobalAlpha(1),e&&(n.context().setFillStyle("rgb(255,255,255)"),n.context().fillRect(0,0,i,s)),n.context().context.drawImage(t,0,0,i,s),n}function n(t){return s(t,!0)}function r(t,e,i){const s=t.naturalWidth,r=t.naturalHeight;let o=s,a=r,h=0;switch(e){case m.Undefined:case m.R0:return n(t);case m.R90:o=r,a=s,h=.5*Math.PI;break;case m.R180:h=Math.PI;break;case m.R270:o=r,a=s,h=.5*-Math.PI}let c=new nt(o,a);return c.wasShrunk=!1,c.context().setGlobalAlpha(1),i&&(c.context().setFillStyle("rgb(255,255,255)"),c.context().fillRect(0,0,o,a)),c.context().save(),c.context().translate(.5*o,.5*a),c.context().rotate(h),c.context().context.drawImage(t,.5*-s,.5*-r,s,r),c.context().restore(),c}t.DefaultFontFamily=function(){try{return window.getComputedStyle(document.querySelector("body")).fontFamily}catch(t){return"sans-serif"}}(),t.needsReencoding=function(t){return!e.has(t)},t.recodeCanvasFile=function(e,i){return s=e.type,E.endsWith(s,"jpeg")||E.endsWith(s,"jpg")||E.endsWith(s,"webp")||E.endsWith(s,"jp2")||E.endsWith(s,"cr2")||E.endsWith(s,"nef")||E.endsWith(s,"dng")||E.endsWith(s,"jps")||E.startsWith(s,"image/heif")||E.startsWith(s,"image/avif")?i.toFile("image/jpeg",t.RecodeJpegQuality,E.dropExtension(e.name)+".jpeg"):i.toFile("image/png",1,E.dropExtension(e.name)+".png");var s},t.loadCheckRotateImage=i,t.loadCheckRotateFlattenImage=function(t,e,s){i(t,!0,e,s)},t.imageToCanvasEx=s,t.flattenImage=n,t.rotateImageToCanvasEx=r,t.rotateAndFlattenImage=function(t,e){return r(t,e,!0)}}(F||(F={}));class st{constructor(t,e){this.canvas=t,this.context=e,this.toggleImageSmoothing(!1)}toggleImageSmoothing(t){this.context.mozImageSmoothingEnabled=t,this.context.webkitImageSmoothingEnabled=t,this.context.imageSmoothingEnabled=t}width(){return this.context.canvas.width}height(){return this.context.canvas.height}logicalWidth(){return this.canvas.logicalWidth()}logicalHeight(){return this.canvas.logicalHeight()}createPattern(t,e){return this.context.createPattern(t,e)}setStrokeStyle(t){this.context.strokeStyle=t}setLineDash(t){this.context.setLineDash(t)}setLineWidth(t){this.context.lineWidth=t}setLineJoin(t){this.context.lineJoin=t}setLineCap(t){this.context.lineCap=t}strokeText(t,e,i){this.context.strokeText(t,e,i)}fillText(t,e,i){this.context.fillText(t,e,i)}measureText(t){return this.context.measureText(t)}setFont(t){this.context.font=t}save(){this.context.save()}stroke(){this.context.stroke()}strokeRect(t,e,i,s){this.context.strokeRect(t,e,i,s)}createRadialGradient(t,e,i,s,n,r){return this.context.createRadialGradient(t,e,i,s,n,r)}createLinearGradient(t,e,i,s){return this.context.createLinearGradient(t,e,i,s)}scale(t,e){this.context.scale(t,e)}translate(t,e){this.context.translate(t,e)}setRectToRectTransform(t,e){let i=e.width()/t.width(),s=e.height()/t.height();this.context.setTransform(i,0,0,s,e.left-t.left*i,e.top-t.top*s)}moveTo(t,e){this.context.moveTo(t,e)}lineTo(t,e){this.context.lineTo(t,e)}quadraticCurveTo(t,e,i,s){this.context.quadraticCurveTo(t,e,i,s)}bezierCurveTo(t,e,i,s,n,r){this.context.bezierCurveTo(t,e,i,s,n,r)}rotate(t){this.context.rotate(t)}beginPath(){this.context.beginPath()}closePath(){this.context.closePath()}arc(t,e,i,s,n,r){this.context.arc(t,e,i,s,n,r)}rect(t,e,i,s){this.context.rect(t,e,i,s)}rectTo(t,e,i,s,n){let r=t+i,o=e+s;this.moveTo(t,e),n?(this.lineTo(r,e),this.lineTo(r,o),this.lineTo(t,o)):(this.lineTo(t,o),this.lineTo(r,o),this.lineTo(r,e)),this.lineTo(t,e),this.closePath()}clip(){this.context.clip()}clipBlock(t,e,i,s,n,r){t?(this.save(),this.beginPath(),this.rect(e,i,s-e,n-i),this.clip(),r(),this.restore()):r()}rotatedFrame(t,e,i){0!=t?(this.save(),this.translate(e.x,e.y),this.rotate(t),this.translate(-e.x,-e.y),i(),this.restore()):i()}restore(){this.context.restore()}setFillStyle(t){this.context.fillStyle=t}clearShadow(){this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowBlur=0,this.context.shadowColor=void 0}setShadow(t,e,i,s){this.context.shadowOffsetX=t,this.context.shadowOffsetY=e,this.context.shadowBlur=i,this.context.shadowColor=s}setGlobalAlpha(t){this.context.globalAlpha=t}withGlobalAlpha(t,e){let i=this.context.globalAlpha;this.setGlobalAlpha(t),e(),this.setGlobalAlpha(i)}clearRect(t,e,i,s){this.context.clearRect(t,e,i,s)}clearAll(){this.clearRect(0,0,this.logicalWidth(),this.logicalHeight())}createImageData(t,e){return this.context.createImageData(t,e)}getImageData(t,e,i,s){return this.context.getImageData(t,e,i,s)}getImageDataFull(){return this.context.getImageData(0,0,this.width(),this.height())}putImageData(t,e,i){this.context.putImageData(t,e,i)}putImageData2(t,e,i,s,n,r,o){this.context.putImageData(t,e,i,s,n,r,o)}fillRect(t,e,i,s){this.context.fillRect(t,e,i,s)}roundedRect(t,e,i,s,n){i<2*n&&(n=i/2),s<2*n&&(n=s/2),this.beginPath(),this.moveTo(t+n,e),this.context.arcTo(t+i,e,t+i,e+s,n),this.context.arcTo(t+i,e+s,t,e+s,n),this.context.arcTo(t,e+s,t,e,n),this.context.arcTo(t,e,t+i,e,n),this.closePath()}fillRoundedRect(t,e,i,s,n){this.roundedRect(t,e,i,s,n),this.context.fill()}drawImage(t,e,i){this.context.drawImage(t,e,i)}drawImage2(t,e,i,s,n){this.context.drawImage(t,e,i,s,n)}drawImage3(t,e,i,s,n,r,o,a,h){this.context.drawImage(t,e,i,s,n,r,o,a,h)}drawCanvasEx(t,e,i){this.context.drawImage(t.element,e,i)}drawCanvasEx2(t,e,i,s,n){this.context.drawImage(t.element,e,i,s,n)}drawCanvasEx3(t,e,i,s,n,r,o,a,h){this.context.drawImage(t.element,e,i,s,n,r,o,a,h)}circle(t,e,i){this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI,!0)}fillCircle(t,e,i,s){s&&(this.context.fillStyle=s),this.circle(t,e,i),this.context.fill()}fillSquare(t,e,i,s){s&&(this.context.fillStyle=s),this.context.fillRect(t-i,e-i,2*i,2*i)}strokeSquare(t,e,i,s){s&&(this.context.strokeStyle=s),this.context.strokeRect(t-i,e-i,2*i,2*i)}strokeCircle(t,e,i,s){s&&(this.context.strokeStyle=s),this.circle(t,e,i),this.context.stroke()}strokeLine(t,e,i,s,n,r){n&&(this.context.lineWidth=n),r&&(this.context.strokeStyle=r),this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.stroke()}strokePolyline(...t){if(t.length>1){this.context.beginPath(),this.context.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)this.context.lineTo(t[e].x,t[e].y);this.context.stroke()}}triangle(t,e,i,s,n,r){var o=120*Math.PI/180;n=n||s,r=r||n,this.context.moveTo(t+s*Math.cos(i),e+s*Math.sin(i)),this.context.lineTo(t+n*Math.cos(i+o),e+n*Math.sin(i+o)),this.context.lineTo(t+r*Math.cos(i+2*o),e+r*Math.sin(i+2*o)),this.context.closePath()}strokeEx(t,e,i,s){i&&(this.context.lineJoin=i),s&&(this.context.lineCap=s),this.context.lineWidth=t,this.context.strokeStyle=e,this.context.stroke()}fillEx(t){this.context.fillStyle=t,this.context.fill()}drawCenteredText(t,e){var i=t;const s=t.length;this.setGlobalAlpha(1),this.setFont(this.canvas.largeFont);let n=18;var r=this.measureText(t).width;const o=this.canvas.logicalWidth();var a=o-20;r>a&&(this.setFont(this.canvas.smallFont),n=12,(r=this.measureText(t).width)>a&&(t=E.centerElide(i,.75*s),(r=this.measureText(t).width)>a&&(t=E.centerElide(i,.5*s),(r=this.measureText(t).width)>a&&(t=E.centerElide(i,.25*s),r=this.measureText(t).width))));let h=(o-r)/2,c=n+4,l=.25*n+1;this.setGlobalAlpha(.4),this.setFillStyle("#fff"),this.fillRoundedRect(h-4,e-c+l,r+8,c,.4*c),this.setGlobalAlpha(1),this.setFillStyle("#000"),this.fillText(t,h,e)}}class nt{static fromHTMLImageElement(t,e=1){let i=t.naturalWidth*e,s=t.naturalHeight*e,n=new nt(i,s);return n.context().drawImage2(t,0,0,i,s),n}constructor(t,e,i=1){this.w=t,this.h=e,this.highDpiRatio=1,this.largeFont="20px "+F.DefaultFontFamily,this.smallFont="14px "+F.DefaultFontFamily,this.element=document.createElement("canvas"),this.$element=$(this.element),this.setSize(t,e,i),this.wasShrunk=!1,this.contextCache=null}empty(){}width(){return this.w}height(){return this.h}snapStrokeCenterToDevice(t,e){let i=t*this.highDpiRatio,s=e*this.highDpiRatio;return s==Math.round(s)?s%2==0?Math.round(i)/this.highDpiRatio:(Math.floor(i)+.5)/this.highDpiRatio:t}logicalWidth(){return this.wLogical}logicalHeight(){return this.hLogical}boundsRect(){return new it(0,0,this.width(),this.height())}size(){return this.w*this.h}isInBounds(t,e){return 0<=t&&t<this.width()&&0<=e&&e<this.height()}byteLength(){return 4*this.size()}dup(){let t=new nt(this.width(),this.height());return t.context().drawCanvasEx(this,0,0),t}crop(t,e,i,s){let n=new nt(i,s);return n.context().drawCanvasEx(this,-t,-e),n}isOpaque(){let t=this.context().getImageDataFull().data,e=t.length/4;if(e>0)for(let i=0;i<e;i++){if(t[4*i+3]<255)return!1}return!0}hasTransparency(){return!this.isOpaque()}computeMeanRgba(t,e,i,s){if(null!=t&&null!=e&&null!=i&&null!=s){let n=this.context().getImageData(t,e,i,s).data,r=n.length/4;if(r>0){let t=new Float64Array(4);for(let e=0,i=0;e<r;e++)t[0]+=n[i++],t[1]+=n[i++],t[2]+=n[i++],t[3]+=n[i++];let e=new Uint8ClampedArray(4);return e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r,e[3]=t[3]/r,e}}}scale(t){let e=new nt(Math.round(this.width()*t),Math.round(this.height()*t));return e.context().drawCanvasEx2(this,0,0,e.width(),e.height()),e}context(){return null==this.contextCache&&(this.contextCache=new st(this,this.element.getContext("2d")),1!=this.highDpiRatio&&this.contextCache.scale(this.highDpiRatio,this.highDpiRatio)),this.contextCache}checkSetSize(t,e,i=1){return(this.w!=t||this.h!=e||this.highDpiRatio!=i)&&(this.setSize(t,e,i),!0)}setSize(t,e,i=1){t>0&&e>0&&(this.highDpiRatio=i,this.wLogical=t,this.hLogical=e,this.w=t*this.highDpiRatio,this.h=e*this.highDpiRatio,this.element.style.width=t+"px",this.element.style.height=e+"px",this.element.width=this.w,this.element.height=this.h,this.contextCache=null)}clearAll(){this.context().clearRect(0,0,this.width(),this.height())}toImage(){let t=document.createElement("img");return t.src=this.toDataURL(),t}toDataURL(t,e){return this.element.toDataURL(t,e)}toBlob(t,e){return E.dataUrlToBlob(this.toDataURL(t,e))}toBlobAsync(t,e,i){this.element.toBlob(t)}toFile(t,e,i){return E.blobToFile(this.toBlob(t,e),i)}fillAliasedCircle(t,e,i,s){if(!(i<=0)){for(var n=this.context().getImageData(0,0,this.width(),this.height()),r=i*i,o=Math.max(0,Math.floor(t-i)),a=Math.min(this.width()-1,Math.ceil(t+i)),h=Math.max(0,Math.floor(e-i)),c=Math.min(this.height()-1,Math.ceil(e+i)),l=h;l<=c;l++)for(var u=o;u<=a;u++)if((u+.5-t)*(u+.5-t)+(l+.5-e)*(l+.5-e)<=r){var d=4*(l*this.width()+u);n.data[d]=s[0],n.data[d+1]=s[1],n.data[d+2]=s[2],n.data[d+3]=s[3]}this.context().putImageData(n,0,0)}}}!function(t){t.copyTextToClipboard=function(t,e,i){window.navigator&&window.navigator.clipboard&&window.navigator.clipboard.writeText?window.navigator.clipboard.writeText(t).then((()=>{e()}),(()=>{i()})):i()};const e=new RegExp("mobile|ip(hone|od|ad)|android|blackberry|iemobile|kindle|netfront|silk-accelerated|(hpw|web)os|fennec|minimo|opera m(obi|ini)|blazer|dolfin|dolphin|skyfire|zune");function i(t,e,i){navigator.clipboard&&navigator.clipboard.write?navigator.clipboard.write([new ClipboardItem({[t.type]:t})]).then((()=>{e()}),(t=>{i()})):setTimeout(i,0)}t.copyImageToClipboard=function(t,e,s){nt.fromHTMLImageElement(t).toBlobAsync((t=>i(t,e,s)))},t.copyImageBlobToClipboard=i,t.isMobile=function(){return!!(navigator&&navigator.userAgent&&navigator.userAgent.length>0)&&e.test(navigator.userAgent.toLowerCase())};const s=/\<svg[^\>]+viewBox\s*=\s*"\s*([\d\.]+)\s+([\d\.]+)\s+([\d\.]+)\s+([\d\.]+)\s*"/,n=/\<svg[^\>]+width\s*=\s*"\s*([\d\.]+)/,r=/\<svg[^\>]+height\s*=\s*"\s*([\d\.]+)/;function o(t,e,i){let s=new Image;s.onload=function(){URL.revokeObjectURL(s.src),i(s)},s.onerror=e,s.src=t}t.loadImageFromSvgString=function(e,i,a){o(t.svgStringToDataUrl(function(t){let e=n.exec(t),i=r.exec(t);if(e&&2==e.length&&isFinite(parseInt(e[1]))&&i&&2==i.length&&isFinite(parseInt(i[1])))return t;{let e=s.exec(t);if(5==e.length){parseInt(e[1]),parseInt(e[2]);let i=parseInt(e[3]),s=parseInt(e[4]);if(isFinite(i)&&isFinite(s)){let e=150,n=Math.ceil(s/i*e);return t.replace("<svg",`<svg width="${e}" height="${n}"`)}}}return t}(e)),i,a)},t.loadImageFromDataUrl=o,t.loadImageFromUrl=function(t,e,i){let s=new Image;s.onload=()=>i(s),s.onerror=e,s.src=t},t.loadImageFromBlob=function(t,e,i){o(URL.createObjectURL(t),e,i)},t.loadFileFromUrl=function(e,i,s){let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(n){if(200==this.status){let n=this.response,r=e.split("/");i||(i=r[r.length-1]),s(t.blobToFile(n,i))}},n.send()},t.gaTrack=function(t,e,i,s){"gtag"in window?gtag("event",e,{event_category:t,event_label:i,value:s,non_interaction:!0}):ga("send","event",t,e,i,s,{nonInteraction:!0})},t.gaSetPageAndSendPageview=function(t){ga("set","page",t||location.pathname),ga("send","pageview")},t.modal=function(t,e=!1,i=!1){var s="string"==typeof t?$(t):t.$();e?s.modal({backdrop:!i,keyboard:!0}):s.modal({backdrop:"static",keyboard:!1});var n=$(".modal-backdrop"),r=1040+2*(n.length-1);n.last().css("z-index",r),s.css("z-index",r+1)},t.blink=function(t,e=200,i=3){var s="string"==typeof t?$(t):t.$();function n(){s.fadeIn(e,r)}function r(){--i>0&&s.fadeOut(e,n)}s.fadeOut(e,n)},t.makeElement=function(t,e){var i=$(document.createElement(t));return i.text(e),i},t.formatXhrError=function(e,i){const s=e.responseURL||"[Unknown URL]";if(t.gaTrack("XhrError",s,e.status+", "+(i||"[unknown]")),0===e.status)return d.s("Failed to connect to the server.")+"\n"+d.s("Please verify your network connection.")+"\n";{const s=t.elide(e.responseText.toString(),200);return e.status<200||299<e.status?e.statusText+" ["+e.status+"]\n"+s:"parsererror"===i?d.s("Failed to parse JSON response.")+" ["+i+"]\n"+s:"timeout"===i?d.s("Request time out.")+" ["+i+"]":"abort"===i?d.s("Request aborted by the server.")+" ["+i+"]":"empty"===i?d.s("Server gave an empty response."):d.s("Unknown error.")+"\n"+s}}}(E||(E={})),function(t){t.attachToLink=function(t,e){t.off("dragstart.DragUrl").on("dragstart.DragUrl",(function(t){const i=e();i&&t.originalEvent.dataTransfer.setData("DownloadURL",i+":"+this.href)}))},t.attachDecorated=function(){$("a[data-dragurl]").on("dragstart",(function(t){const e=$(this).data("dragurl");e&&t.originalEvent.dataTransfer.setData("DownloadURL",e)}))}}(x||(x={})),function(t){t.isCommandOrCtrl=function(t){return 17==t||224==t||91==t||93==t},t.isShift=function(t){return 16==t}}(C||(C={})),function(t){const e=".FileDropper";var i,s=!0;let n,r;!function(t){t[t.Dropped=0]="Dropped",t[t.Picked=1]="Picked",t[t.Pasted=2]="Pasted",t[t.Url=3]="Url"}(n=t.InputMethod||(t.InputMethod={})),function(t){t[t.NoBrowserSupport=0]="NoBrowserSupport",t[t.NonFileInput=1]="NonFileInput",t[t.NonImageInput=2]="NonImageInput"}(r=t.ErrorCode||(t.ErrorCode={})),t.initialize=function(t){var o=!1,a=$.extend({},{hover_class_on:t.monitor_drag,focusPasteOnCtrlV:!!t.monitor_paste,afterPaste:t=>{}},t);function h(t,e,i){a.afterPaste(!1),a.error(t,e,i)}function c(){s=!1,a.monitor_drag&&a.hover_class_on&&a.hover_class&&a.monitor_drag.$().off(e),a.monitor_file_input&&a.monitor_file_input.$().off(e),a.monitor_paste&&a.monitor_paste.$().off(e),a.focusPasteOnCtrlV&&$(window).off(e)}function l(t,e,i){s&&(t&&t.length>0?("Pasted"==e&&a.afterPaste(!0),a.beforeDrop&&a.beforeDrop(),i==n.Dropped&&a.hideDurationMs?setTimeout((()=>{a.drop.call(this,t,i),a.dropOnce&&c()}),a.hideDurationMs):(a.drop.call(this,t,i),a.dropOnce&&c())):h(d.s(e+" a non-file input"),i,r.NonFileInput))}function u(t,e){clearTimeout(i),t.stopImmediatePropagation(),t.preventDefault();let s=!1;try{let e=t.originalEvent.dataTransfer;if(e){let t=e.types;for(let e=0;e<t.length;e++){if("Files"==t[e]){s=!0;break}}}}catch(t){s=!0}let n=a.hover_class_on.$().hasClass(a.hover_class.name()),r=e&&s;return n&&!r?(a.beforeHide&&a.beforeHide(),a.hideDurationMs?setTimeout((()=>a.hover_class_on.$().removeClass(a.hover_class.name())),a.hideDurationMs):a.hover_class_on.$().removeClass(a.hover_class.name()),a.afterHide&&a.afterHide()):!n&&r&&(a.beforeShow&&a.beforeShow(),a.hover_class_on.$().addClass(a.hover_class.name())),s}function p(){a.pastedUrl?h(d.s("Pasted something that wasn't an image or URL?"),n.Pasted,r.NonImageInput):h(d.s("Pasted something that wasn't an image?"),n.Pasted,r.NonImageInput)}function m(t){let e=new Blob([t],{type:t.type});return e.lastModified=t.lastModified,e.name=function(){function t(t){return("0"+t).slice(-2)}let e=new Date;return"Pasted-"+e.getFullYear()+t(e.getMonth()+1)+t(e.getDate())+"-"+t(e.getHours())+t(e.getMinutes())+t(e.getSeconds())}(),e}return a.monitor_drag&&a.hover_class_on&&a.hover_class&&a.monitor_drag.$().on("drop"+e,(function(t){return u(t,!1)&&l(t.originalEvent.dataTransfer.files,"Dropped",n.Dropped),!1})).on("dragenter"+e,(function(t){u(t,!0),a.onDragEnter&&a.onDragEnter(t)})).on("dragover"+e,(function(t){let e=u(t,!0);t.originalEvent.dataTransfer.dropEffect=s&&e?"copy":"none",a.onDragOver&&a.onDragOver(t)})).on("dragleave"+e,(function(t){i=setTimeout((()=>{u(t,!1),a.onDragLeave&&a.onDragLeave(t)}),100)})),a.monitor_file_input&&a.monitor_file_input.$().on("change"+e,(t=>{let e=t.originalEvent.target;return l(e.files,"Picked",n.Picked),e.value=null,!1})),a.monitor_paste&&(a.monitor_paste.$().on("paste"+e,(function(t){if(!s)return;const e=t.originalEvent.clipboardData;if(e&&e.files&&e.files.length>0)1==e.files.length&&"image.png"==e.files[0].name?l([m(e.files[0])],"Pasted",n.Pasted):l(e.files,"Pasted",n.Pasted);else if(e&&!e.items)h(d.s("Terribly sorry, it seems like your browser doesn't fully support pasting of images yet?")+"\n\n"+d.s("Paste should work in at least Chrome, Firefox, and Microsoft Edge. "),n.Pasted,r.NoBrowserSupport);else if(e&&e.items&&e.items.length>0&&e.types&&e.types.length==e.items.length){const t=[];let i=!1,s=0;for(let n=0;n<e.items.length;n++)if("Files"==e.types[n]){let i=e.items[n].getAsFile();i&&(t[s]=m(i),s++)}else"text/plain"==e.types[n]&&a.pastedUrl&&(i=!0,e.items[n].getAsString((function(t){(t=t.trim()).length>5e3||t.length<=4||t.indexOf("\n")>=0||t.indexOf("\r")>=0||t.indexOf(" ")>=0||t.indexOf(".")<0?p():a.pastedUrl(t)})));s>0?l(t,"Pasted",n.Pasted):i||p()}else p();o&&(o=!1,a.monitor_paste.$().blur()),t.preventDefault()})),a.focusPasteOnCtrlV&&$(window).on("keydown"+e,(t=>{(t.ctrlKey||t.metaKey)&&86==t.keyCode&&($(document.activeElement).is("input")||(a.monitor_paste.$().focus(),o=!0))}))),{disable:c}};try{XMLHttpRequest.prototype.hasOwnProperty("sendAsBinary")||c.set(XMLHttpRequest.prototype,"sendAsBinary",(function(t){var e=Array.prototype.map.call(t,(function(t){return 255&t.charCodeAt(0)})),i=new Uint8Array(e);this.send(i.buffer)}))}catch(t){}}(S||(S={})),function(t){var e=/%([0-9A-Fa-f]{2})/g,i=/[^\x20-\x7e\xa0-\xff]/g,s=/\\([\u0000-\u007f])/g,n=/; *([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g,r=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+\-\.^_`|~])+)$/,o=/^([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *(?:$|;)/;function a(t){var s=r.exec(t);if(!s)throw new TypeError("invalid extended field value");var n,o=s[1].toLowerCase(),a=s[2].replace(e,h);switch(o){case"iso-8859-1":n=String(a).replace(i,"?");break;case"utf-8":n=decodeURIComponent(escape(a));break;default:throw new TypeError("unsupported charset in extended field")}return n}function h(t,e){return String.fromCharCode(parseInt(e,16))}t.parse=function(t){if(t&&"string"==typeof t){var e=o.exec(t);if(e){var i,r,h=e[0].length,c=(e[1].toLowerCase(),[]),l={};try{for(h=n.lastIndex=";"===e[0].substr(-1)?h-1:h;e=n.exec(t);){if(e.index!==h)throw new TypeError("invalid parameter format");if(h+=e[0].length,i=e[1].toLowerCase(),r=e[2],-1!==c.indexOf(i))throw new TypeError("invalid duplicate parameter");c.push(i),i.indexOf("*")+1!==i.length?"string"!=typeof l[i]&&('"'===r[0]&&(r=r.substr(1,r.length-2).replace(s,"$1")),l[i]=r):(i=i.slice(0,-1),r=a(r),l[i]=r)}if(-1!==h&&h!==t.length)throw new TypeError("invalid parameter format")}catch(t){}return l.filename}}}}(P||(P={})),function(t){const e={url:"",progress:E.empty,error:E.empty,success:E.empty,withCredentials:!1,contentType:null};function i(t,e){return E.blobToFile(t,e||"FetchedFromUrl_"+Date.now())}t.download=function(t){let s=$.extend({},e,t),n=E.dataUrlToBlob(s.url)||E.dataUrlToBlob(s.displayUrl);if(n)setTimeout((function(){s.success(i(n))}),0);else{let t=new XMLHttpRequest,e=0;s.progress!=E.empty&&(t.onprogress=t=>{if(t.lengthComputable){let i=Math.round(100*t.loaded/t.total);e!==i&&(e=i,s.progress(e))}}),t.onerror=e=>{s.error(E.formatXhrError(t,void 0))},t.onabort=e=>{s.error(E.formatXhrError(t,"abort"))},t.withCredentials=!!s.withCredentials,t.onload=e=>{if(t.response)if(t.status<200||t.status>299){let e=String.fromCharCode.apply(null,new Uint8Array(t.response));s.error(d.s('Failed to fetch "{0}"',s.displayUrl||s.url)+"\n"+e)}else{let e=s.contentType||t.getResponseHeader("Content-Type"),n=P.parse(t.getResponseHeader("Content-Disposition")),r=t.response,o=i(new Blob([r],{type:e}),n);s.success(o)}},t.open("GET",s.url,!0),t.responseType="arraybuffer",t.send()}}}(T||(T={})),function(t){t.initialize=function(t,e){t.$().click((function(){let t=prompt(d.s("Please enter the image URL to upload:"));return t&&(t=t.trim(),t.length>4&&e(t)),!1}))}}(M||(M={}));class rt{constructor(t,e,i,s=7){this.containerSelector=t,this.beforeUrl=e,this.afterUrl=i,this.scale=s,this.lastTouchAt=0,this.$container=$(this.containerSelector),this.$container.length>0&&(E.loadImageFromUrl(this.beforeUrl,E.empty,(t=>{this.before=t,this.checkDoneLoading()})),E.loadImageFromUrl(this.afterUrl,E.empty,(t=>{this.after=t,this.checkDoneLoading()})))}checkDoneLoading(){if(this.before&&this.after){this.imageWidth=this.before.naturalWidth,this.imageHeight=this.before.naturalHeight,this.canvas=new nt(this.imageWidth*this.scale,this.imageHeight*this.scale),this.divider=document.createElement("div"),this.divider.classList.add("BeforeAfter-divider");const t=this.$container.empty().append(this.canvas.element,this.divider).parent().mouseleave((t=>this.resetToMiddle())).mousemove((t=>this.hoverHandler(t.pageX,!1))).get(0);t.addEventListener("touchmove",(t=>this.hoverHandler(t.touches[0].pageX,!0))),t.addEventListener("touchstart",(t=>this.hoverHandler(t.touches[0].pageX,!0))),$(this.canvas.element).css("width","100%").css("height",100*this.imageHeight/this.imageWidth+"%"),$(window).resize((()=>this.resetToMiddle())),this.resetToMiddle()}}hoverHandler(t,e){e&&(this.lastTouchAt=Date.now());let i=$(this.canvas.element),s=Math.max(0,Math.min(t-i.offset().left,i.width())),n=Math.floor(s/i.width()*this.canvas.width());this.setCanvasX(Math.floor(n/this.scale)*this.scale,s)}resetToMiddle(){if(Date.now()-this.lastTouchAt<1e3)return;let t=$(this.canvas.element),e=Math.floor(.5*t.width()),i=Math.floor(e/t.width()*this.canvas.width());this.setCanvasX(Math.floor(i/this.scale)*this.scale,e)}setCanvasX(t,e){this.canvasX=Math.max(0,Math.min(t,this.canvas.width())),$(this.divider).css("left",e+rt.parsePx(this.$container.css("padding-left"))+"px"),this.draw()}draw(){let t=Math.floor(this.canvasX/this.scale),e=this.canvas.context();e.clearAll(),this.canvasX>0?(e.drawImage3(this.before,0,0,t,this.imageHeight,0,0,this.canvasX,this.canvas.height()),e.drawImage3(this.after,t,0,this.imageWidth-t,this.imageHeight,this.canvasX,0,this.canvas.width()-this.canvasX,this.canvas.height())):e.drawImage2(this.after,0,0,this.canvas.width(),this.canvas.height())}static parsePx(t){return"px"==t.substr(t.length-2,2)?parseFloat(t.substr(0,t.length-2)):0}}!function(t){const e=Math.pow(100,2);t.NumExplodingFrames=50;class i{constructor(t,e){this.p0=t,this.p1=e}lengthSqr(){return this.p0.distanceSqrTo(this.p1)}direction(){return this.p1.minus(this.p0)}interpolate(t){return this.p0.interpolate(this.p1,t)}snapTo(t){let e=E.clamp(t.minus(this.p0).dot(this.direction())/this.lengthSqr(),0,1),i=this.interpolate(e);return{pp:i,t:e,distance:i.distanceTo(t)}}distSqrTo(t){let e=this.lengthSqr();if(0==e)return{pp:this.p0,t:0,distanceSqr:this.p0.distanceSqrTo(t)};{let i=E.clamp(t.minus(this.p0).dot(this.direction())/e,0,1),s=this.interpolate(i);return{pp:s,t:i,distanceSqr:s.distanceSqrTo(t)}}}}class s{constructor(t,e){this.p0=tt.empty(),this.p=tt.empty(),this.v=tt.empty(),this.p0.setXy(t,e),this.reset()}reset(){this.p.set(this.p0),this.v.setXy(0,0),this.isVisible=!1}index(t,e){let i=Math.round(this.p.x),s=Math.round(this.p.y);return i<0||i>=t||s<0||s>=e?-1:4*(Math.round(this.p.x)+Math.round(this.p.y)*t)}}let n;!function(t){t[t.Idle=0]="Idle",t[t.Initializing=1]="Initializing",t[t.Tracking=2]="Tracking",t[t.Exiting=3]="Exiting",t[t.Exploding=4]="Exploding"}(n||(n={}));t.Particles=class{constructor(t,s={r:0,g:0,b:255,a:255}){this.direction=tt.empty(),this.mouse=tt.nan(),this.lastMouse=tt.nan(),this.line=new i(this.lastMouse,this.mouse),this.particles=[],this.spacingPx=6,this.radiusSqr=e,this.drag=.99,this.ease=.25,this.drawCount=0,this.mode=n.Idle,this.haveAppendedCanvas=!1,this.hasMouse=!1,this.animationFrameId=void 0,this.$container=t,this.color=s,this.canvas=new nt(1,1)}mouseInHandler(t){this.haveAppendedCanvas||(this.$container.html(""),this.$container.append(this.canvas.element),this.haveAppendedCanvas=!0),this.hasMouse||this.updateSize()&&(this.setMode(n.Initializing),this.hasMouse=!0,this.mouseMoveHandler(t),null==this.animationFrameId&&this.draw())}mouseOutHandler(t){this.mouseMoveHandler(t),this.hide()}mouseMoveHandler(t){let e=this.canvas.width()/this.$container.innerWidth();this.mouse.setXy(e*c.get(t.originalEvent,"clientX"),e*c.get(t.originalEvent,"clientY"))}explode(){this.setMode(n.Exploding)}hide(){this.hasMouse=!1,this.setMode(n.Exiting),this.lastMouse.setNan()}setMode(t){if(t!=this.mode){if(this.mode==n.Initializing&&(t==n.Tracking||t==n.Exploding))for(let t=0;t<this.particles.length;t++){this.particles[t].isVisible=!0}this.mode=t,this.drawCount=0,this.radiusSqr=e,this.mode==n.Initializing?this.resetParticles():this.mode==n.Idle&&(this.hasMouse=!1,this.mouse.setNan(),this.lastMouse.setNan())}}updateSize(){let t=this.$container.innerWidth(),e=this.$container.innerHeight();if(t&&e&&0!=t&&0!=e){let i=t*e,n=Math.sqrt(Math.min(1,1048576/i));if(t=Math.round(n*t),e=Math.round(n*e),this.spacingPx=6,t!=this.canvas.width()||e!=this.canvas.height()){this.canvas.setSize(t,e),this.$container.children().css("width","100%").css("height","100%"),this.imageData=this.canvas.context().createImageData(t,e);let i=t-100,n=e-100;this.numRows=Math.floor(n/this.spacingPx-1),this.numCols=Math.floor(i/this.spacingPx-1),this.marginX=Math.round(50+.5*(i-this.numCols*this.spacingPx)),this.marginY=Math.round(50+.5*(n-this.numRows*this.spacingPx)),this.particles=new Array(this.numRows*this.numCols);for(let t=0,e=0;t<this.numRows;t++)for(let i=0;i<this.numCols;i++,e++)this.particles[e]=new s(this.marginX+(i+1)*this.spacingPx,this.marginY+(t+1)*this.spacingPx)}return!0}return!1}resetParticles(){for(let t=0;t<this.particles.length;t++){this.particles[t].reset()}}updateParticlesFromLines(){if(this.mouse.isFinite()&&this.lastMouse.isFinite())for(let t=0;t<this.particles.length;t++){let e=this.particles[t],i=this.line.distSqrTo(e.p),s=i.distanceSqr;this.direction.set(i.pp).minusEquals(e.p);let n=this.radiusSqr/s;if(s<this.radiusSqr){let t=Math.atan2(this.direction.y,this.direction.x);e.v.x-=n*Math.cos(t),e.v.y-=n*Math.sin(t)}e.v.timesEquals(this.drag),e.p.x+=e.v.x+(e.p0.x-e.p.x)*this.ease,e.p.y+=e.v.y+(e.p0.y-e.p.y)*this.ease}}updateParticlesFromPoint(){if(this.mouse.isFinite())for(let t=0;t<this.particles.length;t++){let e=this.particles[t];this.direction.set(this.mouse).minusEquals(e.p);let i=this.direction.lengthSqr(),s=this.radiusSqr/i;if(i<this.radiusSqr){let t=Math.atan2(this.direction.y,this.direction.x);e.v.x-=s*Math.cos(t),e.v.y-=s*Math.sin(t)}e.v.timesEquals(this.drag),e.p.x+=e.v.x+(e.p0.x-e.p.x)*this.ease,e.p.y+=e.v.y+(e.p0.y-e.p.y)*this.ease}}drawParticlesImageData(){let t=this.imageData.data;t.fill(0);for(let e=0;e<this.particles.length;e++){let i=this.particles[e];if(i.isVisible){let e=i.index(this.canvas.width(),this.canvas.height());t[e+0]=this.color.r,t[e+1]=this.color.g,t[e+2]=this.color.b,t[e+3]=this.color.a}}this.canvas.context().putImageData(this.imageData,0,0)}draw(){if(this.mode==n.Exiting&&this.drawCount>=20&&this.setMode(n.Idle),this.mode==n.Exploding)if(this.drawCount<t.NumExplodingFrames){let i=this.drawCount/(.75*t.NumExplodingFrames),s=Math.max(this.canvas.width(),this.canvas.height()),n=Math.sqrt(e),r=n+Math.pow(i,6)*(s-n);this.radiusSqr=E.sqr(r)}else this.setMode(n.Idle);if(this.mode==n.Initializing||this.mode==n.Exiting)if(this.drawCount<20){let t=Math.ceil(this.numRows/20),e=this.drawCount*t,i=Math.min(e+t,this.numRows);for(let t=e;t<i;t++){let e=(this.mode==n.Initializing?t:this.numRows-1-t)*this.numCols;for(let t=0;t<this.numCols;t++,e++)this.particles[e].isVisible=this.mode==n.Initializing}}else this.mode==n.Initializing&&this.setMode(n.Tracking);this.mode!=n.Idle&&this.hasMouse&&(this.updateParticlesFromLines(),this.lastMouse.set(this.mouse)),this.drawParticlesImageData(),this.mode==n.Idle?this.animationFrameId=void 0:this.animationFrameId=requestAnimationFrame((()=>this.draw())),this.drawCount++}}}(k||(k={})),function(t){var e;e=()=>{window.addEventListener("message",(t=>{if(t.data)if("ping"==t.data)t.source.postMessage("pong","*");else if("pong"==t.data)for(let e=0;e<a.length;e++)a[e].checkPong(t)&&(a.splice(e,1),e--);else if(t.data.file||t.data.blob){let e=t.data.file||t.data.blob;i?r(e):s.push(e)}}),!1)},"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e);let i,s=[],n=!1;function r(t){n&&window.hasOwnProperty("chrome")?t.arrayBuffer().then((e=>{i(new File([e],t.name,{type:t.type,lastModified:t.lastModified}))})).catch((t=>{})):i(t)}t.setFileReceiver=function(t,e=!1){n=e,i=t,setTimeout((()=>{for(let t of s)r(t);s=[]}),1)};class o{constructor(t,e){this.connected=!1,this.onOpens=[],this.targetWindow=window.open(t,e),this.targetWindow.postMessage("ping","*"),this.pingIntervalId=setInterval((()=>{this.targetWindow.postMessage("ping","*")}),30)}onOpen(t){return this.connected?t():this.onOpens.push(t),this}checkPong(t){if(t.source==this.targetWindow){clearInterval(this.pingIntervalId),this.connected=!0;for(let t of this.onOpens)t();return this.onOpens=[],!0}return!1}}let a=[],h={};function c(t,e,i,s){let n=e?h[e]:null;n&&!n.targetWindow.closed||(n=function(t,e){let i=new o(t,e);return a.push(i),e&&(h[e]=i),i}(t,e)),n.onOpen((function(){setTimeout((()=>{(s?n.targetWindow:window).focus(),n.targetWindow.postMessage({file:i},"*")}),1)}))}t.sendFile=c,t.sendFileToRecompressor=function(t,e){c("https://recompressor.com","recompressor",t,e)},t.sendFileToVectorMagic=function(t,e){c("https://vectormagic.com",null,t,e)},t.sendFileToVectorizer=function(t,e){c("https://vectorizer.ai",null,t,e)},t.sendFileToPixianFaceSticker=function(t,e){c("https://pixian.ai/face-stickers","pixian-face-stickers",t,e)},t.sendFileToPixianBg=function(t,e){c("https://pixian.ai","pixian",t,e)},t.sendFileToClippingMagic=function(t,e){c("https://clippingmagic.com",null,t,e)},t.sendFileToPixspy=function(t,e){c("https://pixspy.com","pixspy",t,e)}}(A||(A={})),function(t){t.MaxTries=1,t.BytesPerChunk=14848,t.NumPuntsWhenWorkersBusy=3,t.MaxBytesPerImage=31457280,t.IouThresholdI=7500,t.BrowserChromeUrl="https://www.google.com/chrome/",t.BrowserFirefoxUrl="https://www.mozilla.org/en-US/firefox/new/",t.BrowserMicrosoftEdgeUrl="https://www.microsoft.com/en-us/edge",t.DarkColor="#4e3764",t.DarkColorRgb="78,55,100",t.DefaultDownloadOptions={version:1,background:0,customBackgroundColor:"#000000",opaqueFileFormat:0,jpegQuality:75,margin:"",targetSize:"",verticalAlignment:1,suffix:1},t.EcommerceDownloadOptions={version:1,background:1,customBackgroundColor:"#000000",opaqueFileFormat:0,jpegQuality:75,margin:"5%",targetSize:"",verticalAlignment:1,suffix:1},t.FaceStickerDownloadOptions={version:1,background:0,customBackgroundColor:"#000000",opaqueFileFormat:0,jpegQuality:75,margin:"1px",targetSize:"",verticalAlignment:1,suffix:1}}(W||(W={})),function(t){t.list=function(){var t=[];function e(e,i){e||t.push(i)}function i(t,i){try{e(t(),i)}catch(t){e(!1,i)}}return i((function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}),"HTML5 Canvas"),e("undefined"!=typeof WebSocket,"WebSockets"),i((function(){var t=document.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t}),"HTML5 Drag-and-Drop"),e("undefined"!=typeof URL,"window.URL Support"),e("undefined"!=typeof XMLHttpRequest,"XML Http Requests"),i((function(){return"undefined"!=typeof Uint32Array&&"undefined"!=typeof Uint8Array&&void 0!==new Uint8Array(2).set}),"Native Type Arrays"),i((function(){var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d").getImageData(0,0,1,1).data;return new Int32Array(e.buffer).length>0}),"ImageData.data is not a Uint8ClampedArray"),e(!(!window.history||!window.history.pushState),"HTML5 History"),e("undefined"!=typeof Worker,"Web Workers"),e(!!Date.now,"Date.now()"),i((function(){return!!new Blob}),"Blob and/or Blob Constructor"),i((function(){return!!new Path2D}),"Path2D and/or Path2D Constructor"),t.sort(),t}}(I||(I={}));class ot{constructor(t=100,e=(()=>{}),i="0,0,255",s="#C0C0FF",n=i){this.radius=t,this.complete=e,this.mainRgb=i,this.thinColor=s,this.shadowRgb=n,this.catchUpDuration=200,this.postAnimationDuration=500,this.diameter=2*this.radius,this.canvas=new nt(this.diameter,this.diameter),this.lastPercent=0,this.doneAt=void 0,this.mainColor="rgb("+this.mainRgb+")",this.canvas.$element.css("width",`${Math.round(this.diameter/2)}px`),this.canvas.$element.css("height",`${Math.round(this.diameter/2)}px`),this.setPercent(0)}shadowRgba(t){return`rgba(${this.shadowRgb},${t})`}setPercent(t,e=!0){this.setAt=Date.now(),e?0==t?(this.lastDrawnPercent=void 0,this.lastDrawnPostPercent=void 0,this.lastPercent=this.percent=0,this.draw()):(this.frameAt=Date.now(),this.lastPercent=this.percent,this.percent=Math.round(t),requestAnimationFrame((()=>this.draw()))):(this.percent=this.lastPercent=Math.round(t),this.draw())}visiblePercent(){let t=Math.max(0,Math.min((this.frameAt-this.setAt)/this.catchUpDuration,1));return Math.round(this.lastPercent+(this.percent-this.lastPercent)*t)}getPostPercent(){return this.doneAt?Math.max(0,Math.min(Math.round(100*(this.frameAt-this.doneAt)/this.postAnimationDuration),100)):0}draw(){this.frameAt=Date.now();let t=this.visiblePercent(),e=this.getPostPercent();if(t!=this.lastDrawnPercent||e!=this.lastDrawnPostPercent){let i=t/100,s=this.radius,n=this.diameter,r=.7*s,o=this.canvas.context();o.clearAll(),o.setLineWidth(1),o.clearShadow(),o.strokeCircle(s,s,r,this.thinColor);let a=Math.round(.14*n),h=t+"%";o.setFont(`800 ${a}px sans-serif`);let c=o.measureText(h);if(t<100){if(this.doneAt=void 0,o.setFillStyle(this.mainColor),o.fillText(h,.5*(n-c.width),s+.5*a),t>0){o.save(),o.beginPath();let t=1.5*Math.PI,e=t-2*i*Math.PI;o.arc(s,s,r,t,e,!0),o.setShadow(0,.04*n,.05*n,this.shadowRgba(.35)),o.strokeEx(.15*n,this.mainColor,void 0,"round"),o.restore()}}else{null==this.doneAt&&(this.doneAt=this.frameAt);let t=e/100,i=.5,a=.3,h=Math.max(0,Math.min(1,t/i)),c=Math.max(0,Math.min(1,(t-i)/(1-i))),l=Math.max(0,Math.min(1,c/a)),u=Math.max(0,Math.min(1,(c-a)/(1-a))),d=new tt(.484*n,.616*n),p=new tt(.406*n,.538*n),m=new tt(.62*n,.435*n),g=new tt(d.x,s+r);if(e<100&&l<1){let t=.5*Math.PI;if(o.save(),o.beginPath(),h<1){let e=t+Math.PI*(1-h),i=t-Math.PI*(1-h);o.arc(s,s,r,i,e,!1)}let e=.15*n-.1*h*n;o.setShadow(0,.04*n,.05*n,this.shadowRgba(.35)),o.strokeEx(e,this.mainColor,void 0,"round"),o.restore(),o.save(),o.setLineCap("round");let i=g.interpolate(d,h),a=g.interpolate(d,l);o.setLineWidth(e),o.strokeLine(i.x,i.y-e/4,a.x,a.y,7,this.mainColor),o.restore()}if(l>0){let t=1-Math.abs(2*u-1),e=.05*n+.04*n*t,i=d.interpolate(p,l),s=d.interpolate(m,l);o.save(),o.beginPath(),o.setShadow(0,.02*n,.05*n+.02*n*t,this.shadowRgba(.35+.1*t)),o.moveTo(i.x,i.y),o.lineTo(d.x,d.y),o.lineTo(s.x,s.y),o.strokeEx(e,this.mainColor,"round","round"),o.restore()}}this.lastDrawnPercent=t,this.lastDrawnPostPercent=e}100!=t||100!=e?requestAnimationFrame((()=>this.draw())):this.complete()}}!function(t){function e(e){a.FatalError.Message.$().text(e),t.modal(a.FatalError.Dialog),t.gaTrack("ErrorShown","Fatal",e)}t.countInstances=function(t,e){const i=e.charCodeAt(0);for(var s=0,n=0;n<t.length;n++)t.charCodeAt(n)==i&&s++;return s},t.whilePressing=function(t,e,i){function s(){window.removeEventListener("touchend",s),window.removeEventListener("mouseup",s),i()}function n(){window.addEventListener("touchend",s),window.addEventListener("mouseup",s),e()}t.$().each((function(t,e){e.addEventListener("touchstart",n),e.addEventListener("mousedown",n)}))},t.radioButton=function(t,e,i){let s=t.$();s.click((t=>{t.preventDefault(),t.stopPropagation(),!s.hasClass(o.active.name())?e():i()}))},t.blurActiveElement=function(){document.activeElement instanceof HTMLElement?document.activeElement.blur():window.focus()},t.progressBar=function(t,e){let i=0<e&&e<100;e<0?e=0:e>100&&(e=100),t.$().css({width:e+"%"}).toggleClass("active",i)},t.fatalError=function(i){e(t.stringify(i))},t.fatalErrorStr=e,t.progress=function(e){e?t.modal(a.App.ProgressLightbox):a.App.ProgressLightbox.$().modal("hide")},t.progressUpdate=function(t){a.App.ProgressLightboxBar.$().attr("style","width:"+t+"%")}}(E||(E={}));class at{static parse(t,e){return"%"==e?new at(Math.min(50,parseFloat(t)),0):new at(NaN,Math.min(500,parseInt(t)))}constructor(t,e){this.percent=t,this.pixels=e,this.isPercent=!isNaN(this.percent)}marginFor(t){return 0|(this.isPercent?Math.round(t*this.percent/100):this.pixels)}}at.Zero=new at(NaN,0);class ht{static parse(t){if(0==(t=(t||"").trim()).length)return;const e=ht.regex.exec(t);if(!e)return;const i=at.parse(e[1],e[2]),s=void 0===e[4]?i:at.parse(e[4],e[5]),n=void 0===e[7]?i:at.parse(e[7],e[8]),r=void 0===e[10]?s:at.parse(e[10],e[11]);return new ht(i,s,n,r)}constructor(t,e,i,s){this.top=t,this.right=e,this.bottom=i,this.left=s}marginFor(t,e){return new mt(this.left.marginFor(t),this.top.marginFor(e),this.right.marginFor(t),this.bottom.marginFor(e))}}ht.regex=/^(\d+\.?\d*)(|px|%)(\s*(\d+\.?\d*)(|px|%))?(\s*(\d+\.?\d*)(|px|%))?(\s*(\d+\.?\d*)(|px|%))?$/,ht.Zero=new ht(at.Zero,at.Zero,at.Zero,at.Zero);class ct{static parse(t){if(0!=(t=(t||"").trim()).length)try{let e=t.split(/\s+/,2),i=parseInt(e[0]),s=e.length>1?parseInt(e[1]):i;return isNaN(i)||isNaN(s)?void 0:new ct(i,s)}catch(t){return}}constructor(t,e){this.width=t,this.height=e}}function lt(t,e){if(e)try{self.postMessage(t,e)}catch(e){self.postMessage(t)}else self.postMessage(t)}class ut{constructor(t,e=null,i=null,s=null){this.name=t,this.scriptUrls=e,this.workerFunction=i,this.messageListener=s,this.myMessageListener=t=>this.messageListener?this.messageListener(t):void 0}static getBasics(){return lt.toString()}ensureWorker(){if(!this.worker){let t="'use strict';\n";if(t+=ut.getBasics()+";\n",this.scriptUrls&&this.scriptUrls.length>0){let e=this.scriptUrls.map((function(t){return t.length>1&&"/"==t[0]&&"/"==t[1]?"https:"+t:t.length>0&&"/"==t[0]?location.protocol+"//"+location.host+t:t}));t+="importScripts(\n  '"+e.join("',\n  '")+"');\n"}this.workerFunction&&(t+="("+this.workerFunction.toString()+")();\n");let e=new Blob([t],{type:"text/javascript"}),i=URL.createObjectURL(e);this.worker=new Worker(i),this.worker.addEventListener("error",(t=>{E.gaTrack("YoWorker","Error",t.filename+":"+t.lineno+":"+t.colno+", '"+t.message+"', '"+t.error+"'")})),this.worker.addEventListener("message",this.myMessageListener)}return this.worker}setMessageListener(t){this.messageListener=t}postMessage(t,e){try{try{this.ensureWorker().postMessage(t,e)}catch(e){this.worker.postMessage(t)}}catch(t){throw E.gaTrack("YoWorker","Exception",this.name+": '"+t+"', '"+t.stack+"'"),t}}terminate(){this.worker&&(this.worker.terminate(),this.worker=null)}}class dt{constructor(t){if(this.store={},t)for(var e in t){let i=e.toString();t.hasOwnProperty(i)&&this.put(c.cast(i),t[i])}}static from(t){for(var e=new dt,i=0;i<t.length;i++){var s=t[i];if(2==s.length){var n=s[0],r=s[1];e.put(n,r)}}return e}getOrElse(t,e){return this.contains(t)?this.get(t):e}get(t){return this.store[t.toString()]}put(t,e){return this.store[t.toString()]=e}contains(t){return this.store.hasOwnProperty(t.toString())}remove(t){return!!this.contains(t)&&(delete this.store[t.toString()],!0)}clear(){this.store={}}}function pt(){class t{constructor(t,e,i,s,n){this.dataIn=t,this.wIn=e,this.hIn=i,this.wOut=s,this.hOut=n,this.dataOut=new Uint8ClampedArray(s*n*4),this.outToInX=this.wIn/this.wOut,this.outToInY=this.hIn/this.hOut;let r=t.length,o=!1;for(let e=3;e<r;e+=4){if(t[e]<255){o=!0;break}}this.hasTransparency=o,this.accumulate=this.hasTransparency?this.accumulateRgba:this.accumulateRgb}reset(){this.aSum=0,this.rSum=0,this.gSum=0,this.bSum=0,this.wSum=0}accumulateRgb(t,e,i){const s=4*(t+this.wIn*e);this.rSum+=this.dataIn[s+0]*i,this.gSum+=this.dataIn[s+1]*i,this.bSum+=this.dataIn[s+2]*i,this.wSum+=i}accumulateRgba(t,e,i){const s=4*(t+this.wIn*e);let n=(this.dataIn[s+3]/255+1e-12)*i;this.aSum+=n,this.rSum+=this.dataIn[s+0]*n,this.gSum+=this.dataIn[s+1]*n,this.bSum+=this.dataIn[s+2]*n,this.wSum+=i}populate(t,e){this.reset();const i=t*this.outToInX,s=e*this.outToInY,n=Math.min(i+this.outToInX,this.wIn),r=Math.min(s+this.outToInY,this.hIn),o=Math.floor(i),a=Math.floor(s),h=Math.ceil(n)-1,c=Math.ceil(r)-1,l=Math.ceil(i),u=Math.ceil(s),d=h,p=c,m=l-i,g=u-s,f=n-d,w=r-p;this.accumulate(o,a,m*g),this.accumulate(o,c,m*w);for(var v=l;v<d;v++)this.accumulate(v,a,g),this.accumulate(v,c,w);this.accumulate(h,a,f*g),this.accumulate(h,c,f*w);for(var y=u;y<p;y++){this.accumulate(o,y,m);for(v=l;v<d;v++)this.accumulate(v,y,1);this.accumulate(h,y,f)}const b=4*(t+e*this.wOut);this.hasTransparency?(this.dataOut[b+0]=this.rSum/this.aSum,this.dataOut[b+1]=this.gSum/this.aSum,this.dataOut[b+2]=this.bSum/this.aSum,this.dataOut[b+3]=this.aSum/this.wSum*255):(this.dataOut[b+0]=this.rSum/this.wSum,this.dataOut[b+1]=this.gSum/this.wSum,this.dataOut[b+2]=this.bSum/this.wSum,this.dataOut[b+3]=255)}shrink(){for(var t=0,e=0;t<this.hOut;t++)for(var i=0;i<this.wOut;i++,e++)this.populate(i,t);return this.dataOut}}var e=[];function i(i){e.push(Date.now());const s=(n=i.dataIn,r=i.wIn,o=i.hIn,a=i.wOut,h=i.hOut,new t(n,r,o,a,h).shrink());var n,r,o,a,h;return Date.now(),e.pop(),s}self.addEventListener("message",(t=>{try{var e=t.data;const s=i(e);lt({canvasId:e.canvasId,success:!0,wOut:e.wOut,hOut:e.hOut,dataOut:s},[s.buffer])}catch(t){lt({canvasId:e.canvasId,success:!1,wOut:0,hOut:0,dataOut:null})}}))}!function(t){let e=!0,i=0;const s=new dt;t.ThumbnailJpegQuality=.7;class n{constructor(t,e){if(this.canvasId=t,this.spec=e,this.failSafeTimeout=void 0,this.croppedCanvas=this.spec.inputCanvas,this.spec.crop){const t=this.spec.crop,e=t.right-t.left,i=t.bottom-t.top;if(0!=t.top||0!=t.left||e!=this.spec.inputCanvas.width()||i!=this.spec.inputCanvas.height()){const s=new nt(e,i);s.context().drawCanvasEx3(this.spec.inputCanvas,t.left,t.top,s.width(),s.height(),0,0,s.width(),s.height()),this.croppedCanvas=s,this.croppedCanvas.wasCropped=!0}}let i=this.croppedCanvas.width(),s=this.croppedCanvas.height();this.wOut=i,this.hOut=s;if(i*s>this.spec.maxNumPixels){const t=Math.sqrt(this.spec.maxNumPixels/(i*s));if(i<s){for(this.wOut=Math.max(1,0|Math.round(i*t)),this.hOut=0|Math.round(s*this.wOut/i);this.wOut*this.hOut>this.spec.maxNumPixels&&this.wOut>1;)this.wOut--,this.hOut=0|Math.round(s*this.wOut/i);1==this.wOut&&this.hOut>this.spec.maxNumPixels&&(this.hOut=this.spec.maxNumPixels)}else{for(this.hOut=Math.max(1,0|Math.round(s*t)),this.wOut=0|Math.round(i*this.hOut/s);this.wOut*this.hOut>this.spec.maxNumPixels&&this.hOut>1;)this.hOut--,this.wOut=0|Math.round(i*this.hOut/s);1==this.hOut&&this.wOut>this.spec.maxNumPixels&&(this.wOut=this.spec.maxNumPixels)}}}shrinkingNeeded(){return this.wOut!=this.croppedCanvas.width()||this.hOut!=this.croppedCanvas.height()}createOutputCanvas(){return new nt(this.wOut,this.hOut)}shrinkWithWorker(){try{const t=this.croppedCanvas.context().getImageData(0,0,this.croppedCanvas.width(),this.croppedCanvas.height()).data,e={canvasId:this.canvasId,wIn:this.croppedCanvas.width(),hIn:this.croppedCanvas.height(),dataIn:t,wOut:this.wOut,hOut:this.hOut};this.failSafeTimeout=setTimeout((()=>this.shrinkWithWorkerFailSafe("fail-safe timeout reached")),1e4),this.spec.worker.setMessageListener(r),this.spec.worker.postMessage(e,[t.buffer])}catch(t){this.shrinkWithWorkerFailSafe("exception in spawning worker or sending work message")}}shrinkWithWorkerResultHandler(t){if(t.success&&t.wOut==this.wOut&&t.hOut==this.hOut&&null!=t.dataOut&&t.dataOut.length>0){E.gaTrack("WebWorker","Downsample","Succeeded",1);const e=this.createOutputCanvas(),i=e.context().createImageData(e.width(),e.height());i.data.set(t.dataOut),e.context().putImageData(i,0,0),e.wasShrunk=!0,e.wasCropped=this.croppedCanvas.wasCropped,this.completed(e)}else this.shrinkWithWorkerFailSafe("Worker reports failure")}shrinkWithWorkerFailSafe(t){E.gaTrack("WebWorker","Downsample","Failed",0),e=!1,this.shrinkWithoutWorker()}shrinkWithoutWorker(){var t=this.createOutputCanvas();t.context().drawCanvasEx2(this.croppedCanvas,0,0,t.width(),t.height()),t.wasShrunk=!0,t.wasCropped=this.croppedCanvas.wasCropped,this.completed(t)}produceThumbnail(e){if(this.spec.thumbnailSize){const i=this.spec.thumbnailSize.w,s=this.spec.thumbnailSize.h,n=new nt(i,s);n.context().setFillStyle("rgb(255,255,255)"),n.context().fillRect(0,0,i,s);const r=Math.min(i/e.width(),s/e.height());return n.context().context.drawImage(e.element,(i-e.width()*r)/2,(s-e.height()*r)/2,e.width()*r,e.height()*r),n.toBlob("image/jpeg",t.ThumbnailJpegQuality)}return null}completed(t){clearTimeout(this.failSafeTimeout),this.failSafeTimeout=void 0,s.remove(this.canvasId),this.spec.completed(t,t.wasShrunk||t.wasCropped,(()=>this.produceThumbnail(t)))}process(){this.shrinkingNeeded()?e&&this.spec.worker?this.shrinkWithWorker():this.shrinkWithoutWorker():this.completed(this.croppedCanvas)}}function r(t){const e=t.data;s.contains(e.canvasId)&&s.get(e.canvasId).shrinkWithWorkerResultHandler(e)}t.process=function(t){const e=new n("cs_"+i++,t);s.put(e.canvasId,e),e.process()}}(R||(R={})),function(t){let e;t.isMac=navigator.platform.toUpperCase().indexOf("MAC")>=0,t.zoomDelta=function(t,e=1.2,i=!0){let s=i?t.deltaY:t.deltaY*t.deltaFactor/100;return Math.pow(e,s)},function(t){t[t.CanvasEnter=0]="CanvasEnter",t[t.CanvasLeave=1]="CanvasLeave",t[t.Hover=2]="Hover",t[t.Tap=3]="Tap",t[t.ActionStart=4]="ActionStart",t[t.ActionMove=5]="ActionMove",t[t.ActionEnd=6]="ActionEnd",t[t.PanZoom=7]="PanZoom",t[t.DoubleClick=8]="DoubleClick",t[t.MomentumTranslate=9]="MomentumTranslate"}(e=t.InteractionType||(t.InteractionType={}));class i{constructor(t,e,i,s,n,r,o,a,h){this.type=t,this.interactionIdentifier=e,this.referenceInteraction=i,this.pageX=s,this.pageY=n,this.zoomTo=r,this.canvas=o,this.isTouch=a,this.isFirstPan=h,this.numTouches=0,i||(this.referenceInteraction=this),this.timestamp=Date.now()}dup(t){return new i(t,this.interactionIdentifier,this.referenceInteraction,this.pageX,this.pageY,this.zoomTo,this.canvas,this.isTouch,this.isFirstPan)}getReferenceBefore(t){let e=this.timestamp-t,i=this.referenceInteraction;for(;i.referenceInteraction.timestamp>e&&i!=i.referenceInteraction;)i=i.referenceInteraction;return i}getMostRecentTwoTouch(t){let e=this.timestamp-t,i=this.referenceInteraction;for(;i.numTouches<2&&i.referenceInteraction.timestamp>e&&i!=i.referenceInteraction;)i=i.referenceInteraction;return 2==i.numTouches?i:void 0}isMousePanEnd(){return this.type==e.ActionEnd&&this.referenceInteraction.type==e.ActionMove}shouldStopMouseMomentumPan(){return this.type==e.ActionStart||this.type==e.ActionMove||this.type==e.DoubleClick||this.type==e.Tap||this.type==e.PanZoom}isTouchPanEnd(){return!!!this.getMostRecentTwoTouch(500)&&this.type==e.CanvasLeave&&this.referenceInteraction.type==e.PanZoom}shouldStopTouchMomentumPan(){return this.type==e.ActionStart||this.type==e.ActionMove||this.type==e.DoubleClick||this.type==e.Tap||this.type==e.CanvasEnter}}t.Interaction=i;class s{constructor(t,e,i){this.identifier=t,this.pageX=e,this.pageY=i}static from(t){return new s(t.identifier,t.pageX,t.pageY)}find(t){for(let e=0;e<t.length;e++){const i=t.item(e);if(i.identifier==this.identifier)return i}return null}distanceSqrTo(t){const e=this.pageX-t.pageX,i=this.pageY-t.pageY;return e*e+i*i}distanceTo(t){return Math.max(1,Math.sqrt(this.distanceSqrTo(t)))}isNull(){return this==t.NullTouch}}t.YoTouch=s,t.TouchSpaceRadiusPx=10,t.TouchSpaceRadiusSqrPx=t.TouchSpaceRadiusPx*t.TouchSpaceRadiusPx,t.TouchTimeBoxMs=300,t.DoubleTapRadiusPx=20,t.DoubleTapTimeMs=300,t.NullTouch=new s(null,0,0);let n=!1;try{let t=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("test",null,t)}catch(t){}t.AddEventListenerThirdArgForTouch=!!n&&{passive:!1}}(_||(_={})),function(t){t.Mega=1048576;const e=10,i=20,s=100,n=20,r=6,o=n-2,h=r-2;t.initialized=!1;var c=null;t.lockAspectRatio=!1,t.maxNumMegapixels=4;var l=0,u=0;const d=tt.empty();var p=1,m=null,g=null,f=0,w=0,v=0,b=0;const x=it.empty();var C=1,S=1,P=0,T=0;const M=tt.empty(),k=tt.empty(),A=tt.empty(),I=tt.empty();var R=!1;const D=tt.empty(),F=it.empty(),B=it.empty();class O{constructor(t,e){this.key=t,this.anchor=e,this.oppositeAnchor=y.opposite(this.anchor)}}var L=null;const z=new O("resize-top",y.Top),U=new O("resize-top-right",y.TopRight),W=new O("resize-right",y.Right),N=new O("resize-bottom-right",y.BottomRight),G=new O("resize-bottom",y.Bottom),H=new O("resize-bottom-left",y.BottomLeft),q=new O("resize-left",y.Left),X=new O("resize-top-left",y.TopLeft),V=new O("resize-move",y.Center);let Q=!1;function j(e,i,s,n,r){s.$().text(e.toFixed(0)+" x "+i.toFixed(0)+" px"),n.$().text(E.formatAspectRatio(E.fuzzyAspectRatioEx({w:e,h:i},c.aspectRatios))),r.$().text((e*i/t.Mega).toFixed(1))}function J(){a.PreCrop.Sidebar.MaxNumMegapixels.display.$().text(t.maxNumMegapixels+" megapixels"),j(Math.round(B.width()),Math.round(B.height()),a.PreCrop.Sidebar.cropped_image_size_display,a.PreCrop.Sidebar.cropped_image_aspect_ratio_display,a.PreCrop.Sidebar.cropped_image_megapixels_display),a.PreCrop.Sidebar.lock_aspect_ratio_button.$().prop("checked",t.lockAspectRatio);const e=B.width()*B.height()/t.Mega>t.maxNumMegapixels;a.PreCrop.Sidebar.cropped_image_warning.$().toggle(e),a.PreCrop.Sidebar.cropped_image_success.$().toggle(!e),a.PreCrop.Sidebar.cropped_image_megapixels_display.$().attr("style",e?"color:red;":"")}function Y(){t.lockAspectRatio=!t.lockAspectRatio,pt(),J()}function Z(){t.maxNumMegapixels=Math.min(t.maxNumMegapixels+1,c.maxMaxNumMegapixels),J()}function K(){t.maxNumMegapixels=Math.max(1,t.maxNumMegapixels-1),J()}function et(){$(window).off("beforeunload"),location.reload()}function st(){const t=B.width(),e=B.height();t>0&&e>0&&null!=c.completed&&(c.completed(B),a.PreCrop.App.$().hide(),Q||a.body.$().removeClass("modal-open"))}function rt(t,e){if(null!=t&&null!=e){M.set(A),k.set(I);var i=$(g.element).offset();return A.setXy(t-i.left,e-i.top),s=A,I.setXy((s.x-x.left)*S,(s.y-x.top)*S),M.notEquals(A)||k.notEquals(I)}var s;return!1}function ot(){const t=i*S,e=Math.abs(I.x-B.left)<t,s=Math.abs(I.y-B.top)<t,n=Math.abs(I.x-B.right)<t,r=Math.abs(I.y-B.bottom)<t,o=B.center(),a=Math.abs(I.x-o.x)<t&&Math.abs(I.y-o.y)<t;var h=null;I.x>B.left-t&&I.x<B.right+t&&I.y>B.top-t&&I.y<B.bottom+t&&(e?h=s?X:r?H:q:n?h=s?U:r?N:W:s?h=z:r?h=G:a&&(h=V)),at(h)}function at(t){L=t,null==t?$(g.element).attr("class","canvas-view"):$(g.element).attr("class",L.key+"-tool canvas-view"),Tt()}function ht(t){const e=t.touches.item(0);dt(e.pageX,e.pageY),gt(e.pageX,e.pageY),t.preventDefault()}function ct(t){const e=t.touches.item(0);dt(e.pageX,e.pageY),t.preventDefault()}function lt(t){wt(-1e5,-1e5),t.preventDefault()}function ut(t){dt(t.pageX,t.pageY)}function dt(t,e){const i=rt(t,e);if(R){if(null!=L&&i){B.setFrom(F),B.moveAnchor(L.anchor,I.minus(D)),B.normalize(),B.left=Math.max(B.left,0),B.top=Math.max(B.top,0),B.right=Math.min(B.right,l),B.bottom=Math.min(B.bottom,u),B.round();Math.round(Math.max(0,s-B.width())),Math.round(Math.max(0,s-B.height()));B.moveAnchorToMinSize(L.anchor,s,s),B.round(),pt(),J(),Tt()}}else ot()}function pt(){if(t.lockAspectRatio){var e=y.Center;if(null!=L&&(e=L.oppositeAnchor),B.forceAspectRatio(p,e),B.width()>l||B.height()>u)B.set(0,0,l,u);else{const t=Math.max(0,-B.left)+Math.min(0,l-B.right),e=Math.max(0,-B.top)+Math.min(0,u-B.bottom);B.translate(t,e)}B.round(),Tt()}}function mt(t){gt(t.pageX,t.pageY),$(window).on("mouseup",ft),$(window).on("mousemove",ut)}function gt(t,e){R=!0,D.set(I),F.setFrom(B),rt(t,e)}function ft(t){wt(t.pageX,t.pageY),$(window).off("mouseup",ft),$(window).off("mousemove",ut)}function wt(t,e){R=!1,$(window).off("mouseup",ft),$(window).off("mousemove",ut),rt(t,e),ot()}function vt(t){R||at(null)}function yt(t){R||(rt(t.pageX,t.pageY),ot())}function bt(){null!=m&&null!=g&&(f=m.outerWidth(),w=m.outerHeight(),g.width()==f&&g.height()==w||g.setSize(f,w),(b=w-2*e)/(v=f-2*e)>u/l?(x.left=e,T=u/l*(P=v),x.top=e+.5*(b-T)):(x.top=e,P=l/u*(T=b),x.left=e+.5*(v-P)),x.right=x.left+P,x.bottom=x.top+T,S=1/(C=P/l)),J(),Tt()}function xt(t){return new tt(x.left+t.x*C,x.top+t.y*C)}function Ct(t,e,i,s,a){const c=L==a,l=xt(e);t.setFillStyle("#ffffff"),t.fillRect(l.x+i,l.y+s,i*n,s*r),t.fillRect(l.x+i,l.y+s,i*r,s*n),t.setFillStyle(c?"#ff0000":"#000000"),t.fillRect(l.x+2*i,l.y+2*s,i*o,s*h),t.fillRect(l.x+2*i,l.y+2*s,i*h,s*o)}function St(t,e,i,s){const a=L==s,c=xt(e);t.setFillStyle("#ffffff"),t.fillRect(c.x+i,c.y-n/2,i*r,n),t.setFillStyle(a?"#ff0000":"#000000"),t.fillRect(c.x+2*i,c.y-o/2,i*h,o)}function Pt(t,e,i,s){const a=L==s,c=xt(e);t.setFillStyle("#ffffff"),t.fillRect(c.x-n/2,c.y+i,n,i*r),t.setFillStyle(a?"#ff0000":"#000000"),t.fillRect(c.x-o/2,c.y+2*i,o,i*h)}function Tt(){if(null!=c.inputCanvas&&null!=g&&0!=f&&0!=w){const s=g.context();s.clearRect(0,0,f,w),s.drawCanvasEx2(c.inputCanvas,x.left,x.top,P,T),s.setStrokeStyle("#000000"),s.setGlobalAlpha(.4),s.setLineWidth(1);const n=Math.round((e=B.left,x.left+e*C))+.5,r=Math.round((t=B.top,x.top+t*C))+.5,o=Math.round(B.width()*C)-1,a=Math.round(B.height()*C)-1;s.strokeRect(n,r,o,a),s.setGlobalAlpha(1),Ct(s,B.topLeft(),1,1,X),Ct(s,B.topRight(),-1,1,U),Ct(s,B.bottomRight(),-1,-1,N),Ct(s,B.bottomLeft(),1,-1,H),St(s,B.leftCenter(),1,q),St(s,B.rightCenter(),-1,W),Pt(s,B.topCenter(),1,z),Pt(s,B.bottomCenter(),-1,G),function(t,e,s){var n=i/2,r=1.75*n,o=L==s?"#ff0000":"#000000";const a=xt(e);t.beginPath(),t.triangle(a.x,a.y-r,-Math.PI/2,2,5),t.triangle(a.x,a.y+r,Math.PI/2,2,5),t.triangle(a.x-r,a.y,Math.PI,2,5),t.triangle(a.x+r,a.y,0,2,5),t.strokeEx(2,"#FFF"),t.fillEx(o);var h=n+2;t.fillCircle(a.x,a.y,h,"#FFFFFF"),t.fillCircle(a.x,a.y,h-1,o)}(s,B.center(),V)}var t,e}t.show=function(e){l=(c=e).inputCanvas.width(),u=c.inputCanvas.height(),d.setXy(.5*l,.5*u),B.set(0,0,l,u),p=u/l,t.lockAspectRatio=!!c.lockAspectRatio,t.maxNumMegapixels=c.maxNumMegapixels,t.initialized||(t.initialized=!0,m=a.PreCrop.ViewContainer.$(),g=new nt(m.outerWidth(),m.outerHeight()),m.append(g.element),$(g.element).mousedown(mt).mouseup(ft).mousemove(ut).hover(yt,vt),g.element.addEventListener("touchstart",ht,_.AddEventListenerThirdArgForTouch),g.element.addEventListener("touchmove",ct,_.AddEventListenerThirdArgForTouch),g.element.addEventListener("touchend",lt,_.AddEventListenerThirdArgForTouch),a.PreCrop.Sidebar.crop_button.$().click(st),a.PreCrop.Sidebar.cancel_button.$().click(et),a.PreCrop.Sidebar.lock_aspect_ratio_button.$().click(Y),c.maxMaxNumMegapixels?(a.PreCrop.Sidebar.MaxNumMegapixels.decrease.$().click(K),a.PreCrop.Sidebar.MaxNumMegapixels.increase.$().click(Z)):(a.PreCrop.Sidebar.MaxNumMegapixels.decrease.$().hide(),a.PreCrop.Sidebar.MaxNumMegapixels.increase.$().hide()),$(window).resize(bt)),j(l,u,a.PreCrop.Sidebar.input_image_size_display,a.PreCrop.Sidebar.input_image_aspect_ratio_display,a.PreCrop.Sidebar.input_image_megapixels_display),J(),a.PreCrop.App.$().show(),Q=a.body.$().hasClass("modal-open"),Q||a.body.$().addClass("modal-open"),setTimeout(bt,0)}}(D||(D={})),function(t){const e=new ut("Downsampler",[],pt);t.loadImageShrinkAndThumbnail=function(i,s,n,r,o){t.loadCheckRotateImage(s,!1,n,(n=>{let a=window.GlobalsEx.MaxMaxNumPixels;const h=n.width()*n.height(),c=h>a,l={w:n.width(),h:n.height(),sizePixels:h,sizeBytes:s.size,transparent:!1};function u(i){R.process({inputCanvas:n,crop:i,maxNumPixels:a,thumbnailSize:void 0,worker:o?e:void 0,completed:function(e,i,n){if(i||t.needsReencoding(s.type)){let i=t.recodeCanvasFile(s,e);r(l,i,e)}else r(l,s,e)}})}c&&i?D.show({inputFile:s,inputCanvas:n,lockAspectRatio:void 0,maxNumMegapixels:window.GlobalsEx.MaxMaxNumMegapixels,maxMaxNumMegapixels:window.GlobalsEx.MaxMaxNumMegapixels,aspectRatios:[],completed:t=>{a=D.maxNumMegapixels*D.Mega,u(t)}}):u()}))}}(F||(F={}));class mt{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s,this.isEmpty=this.width<=0||this.height<=0}toString(){return`Rect2i(${this.x},${this.y},${this.width},${this.height})`}rescaleToFit(t,e){let i=Math.min(t/this.width,e/this.height),s=Math.round(this.width*i),n=Math.round(this.height*i);return new mt(0,0,s,n)}pad(t,e,i,s){return new mt(this.x-t,this.y-e,this.width+t+i,this.height+e+s)}}mt.EmptyIntersection=new mt(0,0,0,0),function(t){let e;!function(t){t[t.Init=0]="Init",t[t.Reading=1]="Reading",t[t.Error=2]="Error"}(e||(e={}));t.Result=class{constructor(t,i){this.name=t,this.original=i,this.state=e.Init,this.iAry=0,this.k=0;let s=i.width(),n=i.height();this.result=new nt(s,n),this.imageData=i.context().getImageDataFull(),this.imageBounds=new mt(0,0,s,n)}done(){this.result.context().putImageData(this.imageData,0,0);let t=this.result.width(),e=0,i=this.result.height(),s=0;for(let n=0,r=0;n<this.result.height();n++)for(let o=0;o<this.result.width();o++,r++)0!=(255&this.imageData.data[4*r+3])&&(o<t&&(t=o),e<=o&&(e=o+1),n<i&&(i=n),s<=n&&(s=n+1));this.notFullyTransparentBounds=t>e?mt.EmptyIntersection:new mt(t,i,e-t,s-i),this.imageData=null}append(t){if(this.ary=new Uint8Array(t),this.iAry=0,this.state==e.Init){this.state=e.Reading;this.nextByte();let t=this.nextInt(),i=this.nextInt();if(t!=this.original.width()||i!=this.original.height())throw this.state=e.Error,`Weird size inconsistency: ${t} != ${this.original.width()} || ${i} != ${this.original.height()}`}if(this.state==e.Reading)for(;this.iAry<this.ary.length;){let t=this.nextByte(),e=t>>6&3,i=63&t;switch(2!=e&&(i|=this.nextByte()<<6),i++,e){case 0:this.k+=i;break;case 1:for(let t=0;t<i;t++,this.k++)this.setPixel(4*this.k,0,0,0,0);break;case 2:case 3:for(let t=0;t<i;t++,this.k++)this.setPixel(4*this.k,this.nextByte(),this.nextByte(),this.nextByte(),this.nextByte())}}this.ary=null}nextByte(){return this.ary[this.iAry++]}nextInt(){return this.ary[this.iAry++]<<24|this.ary[this.iAry++]<<16|this.ary[this.iAry++]<<8|this.ary[this.iAry++]}setPixel(t,e,i,s,n){this.imageData.data[t]=i,this.imageData.data[t+1]=s,this.imageData.data[t+2]=n,this.imageData.data[t+3]=e}}}(B||(B={}));class gt{static load(){let t=null;try{t=JSON.parse(window.localStorage.downloadOptions)}catch(t){}return t?gt.from(t):gt.Default}static pullFromDom(){const t=W.DefaultDownloadOptions;let e=a.tag("input:checked");function i(t,e){return null==t?e:t}function s(t){return t.anscestorOf(e).$().val()}return new gt(W.DefaultDownloadOptions.version,i(function(t){switch(t){default:case"transparent":return 0;case"white":return 1;case"custom":return 2}}(s(a.Options.BackgroundStyleGroup.group)),t.background),i(a.Options.BackgroundStyleGroup.CustomColor.input.$().val(),t.customBackgroundColor),i(function(t){switch(t){default:case"OpaqueFileFormatJpeg":return 0;case"OpaqueFileFormatPng":return 1}}(s(a.Options.OpaqueFileFormatGroup.group)),t.opaqueFileFormat),(n=parseInt(a.Options.JpegQualityGroup.JpegQuality.input.$().val()),r=t.jpegQuality,null==n||isNaN(n)?r:n),i(a.Options.MarginGroup.Margin.input.$().val(),t.margin),i(a.Options.TargetSizeGroup.TargetSize.input.$().val(),t.targetSize),i(function(t){switch(t){case"CropAlignmentTop":return 0;default:case"CropAlignmentMiddle":return 1;case"CropAlignmentBottom":return 2}}(s(a.Options.CropAlignmentGroup.group)),t.verticalAlignment),i("none"===s(a.Options.SuffixGroup.group)?0:1,t.suffix));var n,r}static listen(t){a.Options.container.anscestorOf(a.tag("input")).$().change((()=>{t(gt.pullFromDom())}))}static from(t){const e=W.DefaultDownloadOptions;function i(t,e){return null==t?e:t}return new gt(e.version,i(t.background,e.background),i(t.customBackgroundColor,e.customBackgroundColor),i(t.opaqueFileFormat,e.opaqueFileFormat),i(t.jpegQuality,e.jpegQuality),i(t.margin,e.margin),i(t.targetSize,e.targetSize),i(t.verticalAlignment,e.verticalAlignment),i(t.suffix,e.suffix))}constructor(t,e,i,s,n,r,o,a,h){this.version=t,this.background=e,this.customBackgroundColor=i,this.opaqueFileFormat=s,this.jpegQuality=n,this.margin=r,this.targetSize=o,this.verticalAlignment=a,this.suffix=h,this.cropMargin=ht.parse(this.margin),this.cropToForeground=!!this.cropMargin,this.hasCropMarginError=!!this.margin!=!!this.cropMargin,this.targetSizePx=ct.parse(this.targetSize),this.hasTargetSizeError=!!this.targetSize!=!!this.targetSizePx,this.format=0===this.background?1:this.opaqueFileFormat,this.contentType=1===this.format?"image/png":"image/jpeg",this.quality=1===this.format?void 0:this.jpegQuality/100,this.bgColor=0===this.background?void 0:1===this.background?"#ffffff":this.customBackgroundColor,this.margin=(this.margin||"").trim(),this.targetSize=(this.targetSize||"").trim()}createCanvas(t,e){const i=new nt(t,e);if(i.context().toggleImageSmoothing(!0),this.bgColor){const s=i.context().context;s.fillStyle=this.bgColor,s.fillRect(0,0,t,e)}return i}render(t){if(0==this.background&&!this.cropMargin&&!this.targetSizePx)return t.result;const e=t.result,i=t.notFullyTransparentBounds,s=this.cropToForeground?i.isEmpty?t.imageBounds:i:t.imageBounds;let n;if(this.targetSizePx){const t=this.cropMargin?this.cropMargin.marginFor(this.targetSizePx.width,this.targetSizePx.height):mt.EmptyIntersection,i=this.targetSizePx.width-t.x-t.width,r=this.targetSizePx.height-t.y-t.height,o=s.rescaleToFit(i,r),a=(i-o.width)/2,h=0===this.verticalAlignment?0:1===this.verticalAlignment?(r-o.height+1)/2:r-o.height;n=this.createCanvas(this.targetSizePx.width,this.targetSizePx.height),n.context().drawCanvasEx3(e,s.x,s.y,s.width,s.height,t.x+a,t.y+h,o.width,o.height)}else{const t=this.cropMargin?this.cropMargin.marginFor(s.width,s.height):mt.EmptyIntersection,i=s.pad(t.x,t.y,t.width,t.height);n=this.createCanvas(i.width,i.height),n.context().drawCanvasEx3(e,s.x,s.y,s.width,s.height,t.x,t.y,s.width,s.height)}return n}filename(t){return 1===this.suffix&&(t+="_pixian_ai"),t+=1===this.format?".png":".jpeg"}toDownloadOptions(){return{version:this.version,background:this.background,customBackgroundColor:this.customBackgroundColor,opaqueFileFormat:this.opaqueFileFormat,jpegQuality:this.jpegQuality,margin:this.margin,targetSize:this.targetSize,verticalAlignment:this.verticalAlignment,suffix:this.suffix}}save(){try{const t=this.toDownloadOptions();localStorage.downloadOptions=JSON.stringify(t)}catch(t){}}pushToDom(){let t=a.tag("input");function e(e,i){e.anscestorOf(t).$().prop("checked",!1),e.anscestorOf(a.tag(`input[value="${i}"]`)).$().prop("checked",!0)}e(a.Options.BackgroundStyleGroup.group,function(t){switch(t){default:case 0:return"transparent";case 1:return"white";case 2:return"custom"}}(this.background)),a.Options.BackgroundStyleGroup.CustomColor.input.$().val(this.customBackgroundColor),a.Options.BackgroundStyleGroup.CustomColor.input.$().siblings("output").val(this.customBackgroundColor),e(a.Options.OpaqueFileFormatGroup.group,function(t){switch(t){default:case 0:return"OpaqueFileFormatJpeg";case 1:return"OpaqueFileFormatPng"}}(this.opaqueFileFormat)),a.Options.JpegQualityGroup.JpegQuality.input.$().val(""+this.jpegQuality).trigger("input"),a.Options.MarginGroup.Margin.input.$().val(this.margin),a.Options.TargetSizeGroup.TargetSize.input.$().val(this.targetSize),e(a.Options.CropAlignmentGroup.group,function(t){switch(t){case 0:return"CropAlignmentTop";default:case 1:return"CropAlignmentMiddle";case 2:return"CropAlignmentBottom"}}(this.verticalAlignment)),e(a.Options.SuffixGroup.group,0===this.suffix?"none":"_pixian_ai")}pushErrorState(){a.Options.MarginGroup.Margin.row.$().toggleClass("has-error",this.hasCropMarginError),a.Options.TargetSizeGroup.TargetSize.row.$().toggleClass("has-error",this.hasTargetSizeError)}}gt.Default=gt.from(W.DefaultDownloadOptions),gt.EcommerceDefault=gt.from(W.EcommerceDownloadOptions),gt.FaceStickerDefault=gt.from(W.FaceStickerDownloadOptions),function(t){t[t.Trying=0]="Trying",t[t.Success=1]="Success",t[t.FailureSilent=2]="FailureSilent",t[t.FailureShown=3]="FailureShown",t[t.Stopped=4]="Stopped"}(O||(O={}));class ft{constructor(t){this.opts=t,this.tries=0,this.triesEver=0,this.lastErrorMessage="",this.isTrying=!1,this.state=O.Trying,this.timeout=0,this.executionStopped=()=>{this.state=O.Stopped,this.isTrying=!1,this.tries=0,this.lastErrorMessage="",L.deregister(this)},this.executionSuccess=()=>{this.state=O.Success,this.isTrying=!1,this.tries=0,this.lastErrorMessage="",this.opts.success(),L.deregister(this)},this.executionError=t=>{this.isTrying=!1,this.lastErrorMessage=t.substr(0,200),this.tries<this.opts.numberOfSilentRetriesBeforeShowingErrorToUser?(this.state=O.FailureSilent,this.clearTimeout(),this.timeout=setTimeout(this.tryExecute,this.opts.millisBetweenSilentRetries)):this.opts.giveUpAfterSilentRetries?this.state=O.FailureSilent:(this.state=O.FailureShown,L.register(this))},this.executionPunt=()=>{this.isTrying=!1,this.state=O.FailureSilent,this.clearTimeout(),this.timeout=setTimeout(this.tryExecute,100)},this.tryExecute=()=>{if(this.clearTimeout(),!this.isTrying){this.state=O.Trying,this.isTrying=!0,this.tries+=1,this.triesEver+=1;try{this.opts.execute(this.executionSuccess,this.executionError)}catch(t){this.tries=Math.max(this.tries,this.opts.numberOfSilentRetriesBeforeShowingErrorToUser),setTimeout((()=>{this.executionError(t.toString())}),0)}return!0}return!1}}start(){return this.tryExecute(),this}clearTimeout(){this.timeout&&(clearTimeout(this.timeout),this.timeout=0)}makeHtmlRow(){let t=$(document.createElement("tr"));return t.append(E.makeElement("td",this.opts.label)),t.append(E.makeElement("td",this.lastErrorMessage)),t}toString(){return`RetryInstance(${this.opts.label}, tries: ${this.tries} (${this.triesEver}), err: '${this.lastErrorMessage}', isTrying: ${this.isTrying}, state: ${O[this.state]})`}}!function(t){setTimeout((function(){!0}),0);var e=[],i=5e3,s=36e5,n=null,r=0,o=i,h=!1;function c(){var t=a.RetryDialog.Body.$();t.empty();var i=$(document.createElement("tr"));i.append(E.makeElement("th",d.s("Task"))),i.append(E.makeElement("th",d.s("Error"))),t.append(i);for(var s=0;s<e.length;s++)t.append(e[s].makeHtmlRow())}function l(){r=Date.now(),null!=n&&(clearInterval(n),n=null),(o*=2)>s&&(o=s),a.RetryDialog.Countdown.$().text(d.s("Retrying now..."));for(var t=0;t<e.length;t++)e[t].tryExecute()}function u(){var t=Date.now(),e=Math.round((r+o-t)/1e3);e<=0?l():a.RetryDialog.Countdown.$().text(d.s("Retrying in {0} {0,plural,one{second}other{seconds}}...",e)),c()}t.register=function(t){e.indexOf(t)<0&&(E.gaTrack("ErrorShown",t.opts.label,t.lastErrorMessage,null),e.push(t),c()),E.modal(a.RetryDialog.Dialog.css()),h=!0,null==n&&(r=Date.now(),n=setInterval(u,1e3))},t.deregister=function(t){var s=e.indexOf(t);s>=0&&(e.splice(s,1),c()),o=i,r=Date.now(),0==e.length&&h&&a.RetryDialog.Dialog.$().modal("hide")},$((()=>{a.RetryDialog.RetryNowButton.$().click((()=>{l(),o=i}))}))}(L||(L={})),function(t){t[t.Disconnected=0]="Disconnected",t[t.Connecting=1]="Connecting",t[t.Connected=2]="Connected",t[t.Error=3]="Error"}(z||(z={}));class wt{constructor(t){this.state=z.Disconnected,this.websocket=null,this.arraybuffer=null,this.hasReceivedMessage=!1,this.closeReason=null,this.lastDebugUrl="unknown",this.opts=$.extend({numberOfSilentRetriesBeforeShowingErrorToUser:3,millisBetweenSilentRetries:1e3},t),this.eventHandlers={open:t=>{this.onOpen()},close:t=>{this.onClose(t)},message:t=>{this.onMessage(t)},heartbeater:()=>{this.opts.heartbeat&&null!=this.websocket&&this.websocket.readyState==WebSocket.OPEN&&this.doSend(this.opts.heartbeat.message)}},this.retryable=new ft({label:this.opts.label,execute:(t,e)=>{this.clearWebSocket(z.Connecting),this.hasReceivedMessage=!1,this.closeReason=null;let i=this.opts.url();this.lastDebugUrl=i.split("?")[0],this.websocket=new WebSocket(i),this.websocket.binaryType="arraybuffer",this.websocket.addEventListener("open",this.eventHandlers.open),this.websocket.addEventListener("close",this.eventHandlers.close),this.websocket.addEventListener("message",this.eventHandlers.message)},success:()=>{this.opts.connectedToNewServer()},numberOfSilentRetriesBeforeShowingErrorToUser:this.opts.numberOfSilentRetriesBeforeShowingErrorToUser,millisBetweenSilentRetries:this.opts.millisBetweenSilentRetries}).start()}clearWebSocket(t){this.state=t,null!=this.websocket&&(this.websocket.removeEventListener("open",this.eventHandlers.open),this.websocket.removeEventListener("close",this.eventHandlers.close),this.websocket.removeEventListener("message",this.eventHandlers.message),this.websocket.close(),this.websocket=null),this.arraybuffer=null,this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=void 0)}onOpen(){E.gaTrack("WebSocket",this.lastDebugUrl,"connected",1),this.opts.heartbeat&&this.opts.heartbeat.millis>0&&(this.heartbeatTimer=setInterval(this.eventHandlers.heartbeater,this.opts.heartbeat.millis)),this.opts.sendOnOpen?this.doSend(this.opts.sendOnOpen):this.eventHandlers.heartbeater()}onClose(t){this.clearWebSocket(z.Disconnected);let e=t.reason;if(this.closeReason&&!e&&(e=this.closeReason.code.toString()),e){if(this.opts.puntOnCloseReason&&this.opts.puntOnCloseReason(e))return void this.retryable.executionPunt();{let t=this.opts.closeReasonToMessage(e);if(t)return this.onError(t)}}else if(!this.hasReceivedMessage)return this.onError(this.opts.unableToConnectMessage);this.opts.disconnectedFromServer()?this.onError(this.opts.unexpectedCloseMessage):this.retryable.executionStopped()}onError(t){E.gaTrack("WebSocket",this.lastDebugUrl,"error: "+t,0),this.opts.customOnError&&!this.opts.customOnError(t)||this.retryable.executionError(t)}onMessage(t){if("string"==typeof t.data){const e=JSON.parse(t.data);if(e.closeReason)return this.closeReason=e.closeReason,void this.websocket.close();!this.hasReceivedMessage&&this.doSend(this.opts.heartbeat.message)&&(this.hasReceivedMessage=!0,this.state=z.Connected,this.retryable.executionSuccess()),null!=this.arraybuffer&&(e.arraybuffer=this.arraybuffer,this.arraybuffer=null),this.opts.newMessageFromServer(e)}else this.arraybuffer=t.data}doSend(t,e=!1){try{let i=e?t:JSON.stringify(t);return this.websocket.send(i),!0}catch(t){return this.clearWebSocket(z.Error),this.onError(this.opts.sendFailedMessage+"Error: "+t),!1}}send0(t,e){return null==this.websocket||this.websocket.readyState!=WebSocket.OPEN?(null==this.websocket&&this.retryable.tryExecute(),!1):this.doSend(t,e)}send(t){return this.send0(t,!1)}sendBinary(t){return this.send0(t,!0)}getState(){return this.state}forceClose(){this.clearWebSocket(z.Disconnected)}}!function(t){t.getWorkerUrl=function(t,e){let i=("http:"==location.protocol?"ws:":"wss:")+"//"+location.host+t+"?"+window.GlobalsEx.LocaleParameter;for(let t in e)e.hasOwnProperty(t)&&(i+="&"+t+"="+e[t]);return i}}(U||(U={})),function(t){t.BigImageCutoffPoints=5e3,t.BigImageSizeMegapixels=2,t.BigImageMaxScaleFactor=4,t.BigImageScaleTimeoutMillis=150,t.MinProgress=5}(W||(W={}));class vt{constructor(t,e,i,s=0){this.img=t,this.inputFile=e,this.downloadOpts=i,this.state=s,this.currentJobId=-1,this.numPunts=0,this.numDisconnects=0,this.errorMessageTr="",this.uploadProgress=-1,this.processingProgress=-1,this.downloadProgress=-1,this.hasDownloaded=!1,this.listeners=[],this.name=E.dropExtension(e.name)}sizeLabel(){let t=this.getResult();return t||(t=this.img),`${t.width()} × ${t.height()} px`}originalSizeLabel(){return`${this.img.width()} × ${this.img.height()} px`}getResult(){return!this.renderedResult&&this.result&&(this.renderedResult=this.downloadOpts.render(this.result)),this.renderedResult}toDataURL(){return this.getResult().toDataURL(this.contentType(),this.downloadOpts.quality)}toResultFile(){return this.getResult().toFile(this.contentType(),this.downloadOpts.quality,this.filename())}toBlobAsync(t){this.getResult().toBlobAsync(t)}setDownloadOpts(t){this.downloadOpts=t,this.renderedResult=null,this.hasDownloaded=!1,6==this.state&&(this.state=9,this.fireNotifications(),setTimeout((()=>{this.state=6,this.fireNotifications()}),1))}contentType(){return this.downloadOpts.contentType}filename(){return this.downloadOpts.filename(this.name)}numPixels(){return this.img.width()*this.img.height()}hasFailed(){return 7==this.state}hasResult(){return 6==this.state}hasFinished(){return this.state>=6}addListener(t){this.listeners.push(t)}removeListener(t){let e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}fireNotifications(){for(let t of this.listeners)t({source:this})}reset(){return this.currentJobId=-1,this.numPunts=this.numDisconnects=0,this.state=0,this.errorMessageTr="",this.uploadProgress=this.processingProgress=this.downloadProgress=-1,this.nextResult=this.result=null,this.close(),this}close(){this.websocket&&this.websocket.forceClose(),this.websocket=null}trigger(){let t=this;if(0==t.state){t.state=1,this.currentJobId=++vt.JobId,t.uploadProgress=W.MinProgress,this.processingProgress=this.downloadProgress=-1;let e={index:0,command:0};t.websocket=new wt({url:()=>U.getWorkerUrl("/internal/websocket",{len:t.inputFile.size,w:t.img.width(),h:t.img.height(),model:window.GlobalsEx.model}),connectedToNewServer(){t.state=2;let e={index:0,command:2,body:{jobId:t.currentJobId}};t.websocket.send(e),t.trigger()},disconnectedFromServer:()=>(t.numDisconnects++,t.state<6&&(t.numDisconnects<W.MaxTries?(t.state=0,!0):(t.onError(d.s("Unexpected disconnection from the server. ")),!1))),newMessageFromServer(e){const i=e;i.body&&i.body.jobId&&i.body.jobId!=t.currentJobId&&-1!=i.body.jobId||(i.body&&(i.body.arraybuffer=e.arraybuffer),t.onMessage(i))},heartbeat:{millis:2e4,message:e},label:d.s("Connect to worker"),puntOnCloseReason:e=>"-3"==e&&t.numPunts++<W.NumPuntsWhenWorkersBusy,closeReasonToMessage(t){switch(t){case"2":return d.s("Unknown image - it may have been deleted, or you may not have the necessary credentials to access it");case"-3":return d.s("Workers overloaded. Additional workers should be online in a couple of minutes. ");case"-4":return;default:return t}},unableToConnectMessage:d.s("Unable to connect to the worker. Is your firewall or proxy blocking WebSockets?"),unexpectedCloseMessage:d.s("Unexpected worker disconnection. "),sendFailedMessage:d.s("Failed to send message to worker. ")})}else 2==t.state&&(t.state=3,t.inputFile.arrayBuffer().then((e=>{if(t.websocket){let i=Math.ceil(e.byteLength/W.BytesPerChunk);for(let s=0;s<i;s++){let i=s*W.BytesPerChunk,n=Math.min(e.byteLength,(s+1)*W.BytesPerChunk);t.websocket.sendBinary(e.slice(i,n))}}})).catch((t=>{this.onError(d.s("Failed to upload the image: {0}",JSON.stringify(t)))})));this.fireNotifications()}progressPercent(){switch(this.state){case 0:return 0;case 1:case 2:case 3:case 4:case 5:return(Math.max(0,this.uploadProgress)+3*Math.max(0,this.processingProgress)+Math.max(0,this.downloadProgress))/5;default:return 100}}onMessage(t){switch(t.command){case 0:case 1:break;case 5:let e=t.body;this.uploadProgress=Math.max(W.MinProgress,e.progress),e.finished&&(this.state=4,this.processingProgress=W.MinProgress);break;case 6:let i=t.body;this.processingProgress=Math.max(W.MinProgress,i.progress);break;case 7:let s=t.body;this.spec=s.spec,this.state=5,this.processingProgress=100,this.downloadProgress=W.MinProgress,this.nextResult=new B.Result(this.inputFile.name,this.img);break;case 8:let n=t.body;this.downloadProgress=Math.max(W.MinProgress,n.progress),this.nextResult.append(n.arraybuffer);break;case 9:this.nextResult.done(),this.result=this.nextResult,this.hasDownloaded=!1,this.state=6,this.close();break;case 10:let r=t.body;this.onError(r.errorMessageTr)}this.fireNotifications()}onError(t){this.errorMessageTr=t,this.state=7,this.close(),this.fireNotifications()}cancel(){this.listeners=[],this.state=8,this.close()}}vt.JobId=0;class yt{constructor(t,e){this.model=t,this.remove=e,this.id=new n("cv"+yt._id++),this.resultProcessed=!1,this.listener=t=>{this.updateState()};Date.now();t.addListener(this.listener);let i=a.Card.Template.$().html().replace(/_id_/g,`${this.id.name()}`),s=$(i);s.prependTo(a.Card.CardList.$()),a.Card.CardList.$().show(),this.$outer=this.id.anscestorOf(a.Card.outer),this.$error=this.id.anscestorOf(a.Card.error),this.progressCircle=new ot(150,E.empty,W.DarkColorRgb,W.DarkColor),this.id.anscestorOf(a.Card.containerProcessing).$().append(this.progressCircle.canvas.element),this.$imageOriginal=this.id.anscestorOf(a.Card.imageOriginal),this.setImage(this.$imageOriginal,t.img),this.$imageResult=this.id.anscestorOf(a.Card.imageResult),this.$download=this.id.anscestorOf(a.Card.download),this.$download.$().click((()=>t.hasDownloaded=!0)),this.$zazzle=this.id.anscestorOf(a.Card.zazzle),this.id.anscestorOf(a.Card.filename).$().text(t.inputFile.name),this.id.anscestorOf(a.Card.imageSize).$().text(t.sizeLabel()),this.$copy=this.id.anscestorOf(a.Card.copy);let r=-1;this.$copy.$().click((()=>{let e=this.$copy.$(),i=a.CopyToClipboard.show_copied.name(),s=a.CopyToClipboard.show_copying.name(),n=a.CopyToClipboard.show_failed.name(),o=s+" "+i+" "+n;function h(){-1!=r&&clearTimeout(r),r=setTimeout((()=>{e.removeClass(o),r=-1}),3e3)}e.removeClass(o),e.addClass(s),t.toBlobAsync((t=>E.copyImageBlobToClipboard(t,(()=>{e.removeClass(s).addClass(i),h()}),(()=>{e.removeClass(s).addClass(n),h()}))))})),this.id.anscestorOf(a.Card.remove).$().click((()=>{e(this),s.remove()})).hover((()=>{this.id.toggleClass(a.Card.removeHovered)})),$(this.id.css()+" ul.nav li:eq(1)").addClass("disabled"),$(this.id.css()+" ul.nav li:first a").tab("show"),this.updateState(),a.ScrollTarget.$().get(0).scrollIntoView({block:"start",inline:"start",behavior:"smooth"});let o=this.id;function h(e,i,s=!1,n=!1){o.anscestorOf(e).$().click((e=>{n&&i(t.inputFile,!e.ctrlKey);let r=!n&&s?t.inputFile:t.toResultFile();return i(r,!e.ctrlKey),!1}))}h(a.Card.recompressor,A.sendFileToRecompressor),h(a.Card.vectorMagic,A.sendFileToVectorMagic),h(a.Card.vectorizer,A.sendFileToVectorizer),h(a.Card.pixianFaceSticker,A.sendFileToPixianFaceSticker,!0),h(a.Card.pixianBg,A.sendFileToPixianBg,!0),h(a.Card.clippingMagic,A.sendFileToClippingMagic,!0),h(a.Card.pixspy,A.sendFileToPixspy,!1,!0)}setImage(t,e){let i=e.element;t.$().empty().append(i),i.style.width=i.style.height="auto"}setState(t){this.$outer.setClasses(a.Card.outer,t)}processResult(){this.setImage(this.$imageResult,this.model.getResult()),this.id.anscestorOf(a.Card.imageSize).$().text(this.model.sizeLabel()).attr("title",d.s("Original size: {0}",this.model.originalSizeLabel()));let t=this.model.toDataURL(),e=this.model.filename(),i=this.model.contentType();this.$download.$().attr("href",t).attr("download",e),x.attachToLink(this.$download.$(),(()=>i+":"+e)),this.model.spec&&this.$zazzle.$().attr("href",`/images/${this.model.spec.token}/zazzle`)}updateState(){switch(this.model.state){case 0:this.setState(a.Card.statePending);break;case 1:case 2:case 3:case 4:case 5:this.setState(a.Card.stateProcessing),this.progressCircle.setPercent(this.model.progressPercent());break;case 6:this.setState(a.Card.stateDone),this.resultProcessed||(this.processResult(),this.resultProcessed=!0);break;case 7:this.setState(a.Card.stateError),this.$error.$().text(this.model.errorMessageTr);break;case 9:this.setState(a.Card.stateRegenerating),this.resultProcessed=!1}}}yt._id=0,function(t){const e=3;let i,s,n=[],r=[],o=[],h=!1,c=!1,l=!1;function u(t,e){let i=e.indexOf(t);return i>=0&&(e.splice(i,1),!0)}function d(t){u(t,n),u(t.model,r),u(t.model,o),0==n.length&&a.Card.CardList.$().hide(),t.model.cancel()}function p(){for(;r.length<e&&o.length>0;){let t=o.shift();r.push(t),t.trigger()}}function m(t){l||(l=!0,setTimeout(f,50)),t.source.hasFinished()&&(u(t.source,r),p())}function g(t,e,i){s=t;for(let e=0;e<n.length;e++)n[e].model.setDownloadOpts(t);return e&&t.save(),i&&t.pushToDom(),t.pushErrorState(),a.Options.container.anscestorOf(a.tag("input")).$().each(((t,e)=>{let i=e,s=i.getAttribute("data-attribute-class");switch(i.type){case"checkbox":case"radio":a.Options.container.$().toggleClass(s,i.checked);break;case"text":a.Options.container.$().toggleClass(s,0==i.value.length)}})),!1}function f(){l=!1;let t=0,e=0,s=0,r=0,o=0;for(let i=0;i<n.length;i++){let a=n[i].model,h=a.numPixels();a.hasFailed()||(t++,o+=a.progressPercent()*h,a.hasResult()&&(r+=h,e++),s+=h)}s>0&&(o/=s,o=Math.round(o)),h=e==t,i.setPercent(o)}t.initialize=function(){i=new ot(100,E.empty,"255,255,255","#d2d7db","0,0,0"),a.Totals.progress.$().append(i.canvas.element),a.Totals.save_all_btn.$().click((function(t){return function(){if(h&&!c){c=!0,a.Totals.save_all_icon.$().css("opacity","0"),a.Totals.save_all_spinner.$().show();let t=n.filter((t=>t.model.hasResult())),e=t.filter((t=>!t.model.hasDownloaded));e.length>0&&(t=e);for(let e=0;e<t.length;e++){let i=t[e],s=e;setTimeout((()=>{i.$download.$().get(0).dispatchEvent(new MouseEvent("click")),s==t.length-1&&(a.Totals.save_all_icon.$().css("opacity","1"),a.Totals.save_all_spinner.$().hide(),c=!1)}),300*e)}}}(),!1})),1==window.GlobalsEx.model?g(gt.FaceStickerDefault,!1,!1):(g(gt.load(),!1,!0),gt.listen((function(t){g(t,!0,!1)})),a.Options.ResetToDefaults.$().click((function(t){return g(gt.Default,!0,!0)})),a.Options.ResetToEcommerce.$().click((function(t){return g(gt.EcommerceDefault,!0,!0)})))},t.add=function(t,e){let i=new vt(e,t,s);i.addListener(m);let r=new yt(i,d);n.unshift(r),o.push(i),p(),a.Options.container.$().show(),a.Totals.outer_container.$().show(),a.hasDroppedImageIndicator.removeClass(a.hasNotDroppedImage).addClass(a.hasDroppedImage)}}(N||(N={})),function(t){t.fetchUrl=function(t){return"/api/fetchUrl?url="+encodeURIComponent(t)}}(G||(G={})),function(t){const e="stickySettings";var i=null;t.initialize=function(){if(!(i=null))try{i=JSON.parse(window.localStorage[e])}catch(t){i={}}},t.splitView=function(t){return void 0===t?0!=i.splitView:(i.splitView=t,function(){try{window.localStorage[e]=JSON.stringify(i)}catch(t){}}(),t)}}(H||(H={})),function(t){let e={label:"Unknown",url:"",tries:3,paramname:"file",withCredentials:!1,data:{},headers:{},progress:t=>{},success:()=>{},giveUpAfterSilentRetries:!1,timeout:3e4};function i(t,i,s){let n=$.extend({},e,i),r=new XMLHttpRequest,o=r.upload,a=new FormData;function h(){r.abort()}$.each(n.headers,(function(t,e){r.setRequestHeader(t,e)})),$.each(n.data,(function(t,e){a.append(t,e)})),a.append(n.paramname,t);let c=setTimeout(h,n.timeout),l=0;o.onprogress=function(t){if(clearTimeout(c),c=setTimeout(h,n.timeout),t.lengthComputable){let e=Math.round(100*t.loaded/t.total);l!==e&&(l=e,n.progress(l))}},o.onerror=function(t){s.errorHandler(E.formatXhrError(r,void 0))},o.onabort=function(t){s.errorHandler(E.formatXhrError(r,"abort"))},o.onloadend=function(t){clearTimeout(c)},r.onload=function(){clearTimeout(c),r.responseText?r.status<200||r.status>299?s.errorHandler(E.formatXhrError(r,"onload")):(n.progress(100),s.successHandler(r.responseText)):s.errorHandler(E.formatXhrError(r,"empty"))},r.withCredentials=!!n.withCredentials,r.open("POST",n.url,!0),r.send(a)}function s(t,s,n){const r=n.url,o=n.backupUrl;let a="",h=$.extend({},e,n);const c=t.size>s.maxBytes;return new ft({label:h.label,execute:function(e,n){c?n(d.s("The file is too large to upload. ")+d.s("Please pick a file smaller than {0} {0,plural,one{byte}other{bytes}}. ",s.maxBytes)):(h.url=a=a==r&&o?o:r,function(t,e,s,n){s.data={acl:e.acl||"private",key:e.key,policy:e.policy,success_action_status:201,"x-amz-algorithm":"AWS4-HMAC-SHA256","x-amz-credential":e.credential,"x-amz-date":e.date,"x-amz-signature":e.signature,"Content-Type":t.type,"Cache-Control":s.maxAge?"max-age="+s.maxAge:"no-cache"},e.token&&(s.data["x-amz-security-token"]=e.token),i(t,s,n)}(t,s,h,{errorHandler:n,successHandler:e}))},success:function(){h.success()},numberOfSilentRetriesBeforeShowingErrorToUser:c?0:h.tries,millisBetweenSilentRetries:1e3,giveUpAfterSilentRetries:h.giveUpAfterSilentRetries}).start()}t.uploadRaw=i,t.uploadS3WithRetry=s,t.uploadS3JsonWithRetry=function(t,e,i){return s(new Blob([JSON.stringify(t)],{type:"application/json"}),e,i)}}(q||(q={})),function(t){t.MinScaleFactor=1/16,t.MaxScaleFactor=16,t.zoomStep=1.2,t.zoomToFitBackOff=.95,t.configure=function(e){e.MinScaleFactor&&(t.MinScaleFactor=e.MinScaleFactor),e.MaxScaleFactor&&(t.MaxScaleFactor=e.MaxScaleFactor),e.zoomStep&&(t.zoomStep=e.zoomStep),e.zoomToFitBackOff&&(t.zoomToFitBackOff=e.zoomToFitBackOff)},t.buttonFor=function(t){return 1==(1&t.buttons)?"left":2==(2&t.buttons)?"right":4==(4&t.buttons)?"middle":"none"},t.addMovement=function(t,e,i){t.dx=e,t.dy=i}}(X||(X={}));class bt{constructor(t,e,i,s,n,r,o){this.pointerEvent=t,this.x=e,this.y=i,this.type=s,this.numTouches=n,this.down=r,this.root=o,this.isSynthetic=!1,this.button=X.buttonFor(this.pointerEvent),this.timestamp=Date.now()}getPoint(){return new tt(this.x,this.y)}getRoot(){return this.root||this}sameXyAs(t){return this.x==t.x&&this.y==t.y}}class xt{constructor(t){this.owner=t,this.dx=0,this.dy=0,this.scale=1}constrainTranslation(){}constrainScale(t){return t}quantizeOffset(){this.dx=Math.round(this.dx),this.dy=Math.round(this.dy)}translateBy(t,e,i=!0){0==t&&0==e||(this.dx+=t,this.dy+=e,i&&this.constrainTranslation(),this.owner.invalidate())}setScaleAndOffset(t,e,i){this.scale=t,this.dx=e,this.dy=i,this.owner.invalidate()}zoomBy(t){1!=t&&this.zoomTo(this.scale*t)}zoomTo(t){this.scale!=t&&(this.scale=this.constrainScale(t),this.owner.invalidate())}zoomAboutBy(t,e,i){this.zoomAboutTo(t,e,this.scale*i)}zoomAboutTo(t,e,i){const s=(i=this.constrainScale(i))/this.scale;this.dx=t-(t-this.dx)*s,this.dy=e-(e-this.dy)*s,this.scale=i,this.constrainTranslation(),this.owner.invalidate()}transformEvent(t,e){const i=t.getRoot(),s=e?i:t;return new bt(t.pointerEvent,(s.x-this.dx)/this.scale,(s.y-this.dy)/this.scale,s.type,s.numTouches,t.down?this.transformEvent(t.down,e):void 0,i)}transformContext(t,e){e?t.context.setTransform(this.scale,0,0,this.scale,this.dx,this.dy):t.context.transform(this.scale,0,0,this.scale,this.dx,this.dy)}transformPoint(t){return new tt(this.scale*t.x+this.dx,this.scale*t.y+this.dy)}transformRect(t){return new it(this.scale*t.left+this.dx,this.scale*t.top+this.dy,this.scale*t.right+this.dx,this.scale*t.bottom+this.dy)}inverseTransformPoint(t){return new tt((t.x-this.dx)/this.scale,(t.y-this.dy)/this.scale)}inverseTransformRect(t){return new it((t.left-this.dx)/this.scale,(t.top-this.dy)/this.scale,(t.right-this.dx)/this.scale,(t.bottom-this.dy)/this.scale)}snapPointToCanvasPixels(t,e=.5,i=.5){return this.inverseTransformPoint(this.transformPoint(t).snap(e,i))}getScale(){return this.scale}getDxDy(){return new tt(this.dx,this.dy)}getDx(){return this.dx}getDy(){return this.dy}}class Ct extends xt{constructor(t=1,e=1){super(void 0),this.imageWidth=t,this.imageHeight=e,this.views=[],this.canvasPad=it.empty(),this.stickyZoom=0,this.owner=this}constrainTranslation(){this.stickyZoom=0;const t=0*this.scale+this.dx,e=this.imageWidth*this.scale+this.dx,i=this.canvasWidth/2;t>i?this.dx-=t-i:e<i&&(this.dx-=e-i);const s=0*this.scale+this.dy,n=this.imageHeight*this.scale+this.dy,r=this.canvasHeight/2;s>r?this.dy-=s-r:n<r&&(this.dy-=n-r)}getState(){return{dx:this.dx,dy:this.dy,scale:this.scale,stickyZoom:this.stickyZoom}}setState(t){this.dx=t.dx,this.dy=t.dy,this.scale=t.scale,this.stickyZoom=t.stickyZoom,this.owner.invalidate()}constrainScale(t){return this.stickyZoom=0,E.clamp(t,X.MinScaleFactor,X.MaxScaleFactor)}setCanvasPad(t,e,i,s){this.canvasPad.set(t,e,i,s)}canvasWidthInterior(){return this.canvasWidth-this.canvasPad.left-this.canvasPad.right}canvasHeightInterior(){return this.canvasHeight-this.canvasPad.top-this.canvasPad.bottom}canvasCenterX(){return this.canvasPad.left+.5*this.canvasWidthInterior()}canvasCenterY(){return this.canvasPad.top+.5*this.canvasHeightInterior()}canvasCenter(){return new tt(this.canvasCenterX(),this.canvasCenterY())}stopAllPanAnimations(){for(let t of this.views)t.stopPanAnimation()}zoomTo(t){this.zoomAboutTo(this.canvasCenterX(),this.canvasCenterY(),t)}centerImagePoint(t,e,i=!0){this.dx=this.canvasCenterX()-t*this.scale,this.dy=this.canvasCenterY()-e*this.scale,i&&this.quantizeOffset(),this.invalidate()}center(){this.centerImagePoint(.5*this.imageWidth,.5*this.imageHeight)}zoomToFit(){const t=Math.min(this.canvasHeightInterior()/this.imageHeight,this.canvasWidthInterior()/this.imageWidth)*X.zoomToFitBackOff;this.scale=this.constrainScale(t),this.center(),this.stickyZoom=1}fitRect(t){const e=Math.min(this.canvasHeightInterior()/t.height(),this.canvasWidthInterior()/t.width())*X.zoomToFitBackOff;this.scale=this.constrainScale(e);let i=t.center();this.centerImagePoint(i.x,i.y),this.stickyZoom=0}zoom1To1(){this.scale=1,this.center(),this.stickyZoom=2}dblClick(){switch(this.stickyZoom){case 0:case 2:this.zoomToFit();break;case 1:this.zoom1To1()}}register(t){this.views.push(t)}setCanvasSize(t,e,i){if(t!=this.canvasWidth||e!=this.canvasHeight||i){switch(this.canvasWidth>0&&(this.dx+=.5*(t-this.canvasWidth),this.dy+=.5*(e-this.canvasHeight)),this.canvasWidth=t,this.canvasHeight=e,this.stickyZoom){case 0:this.constrainTranslation();break;case 1:this.zoomToFit();break;case 2:this.zoom1To1()}this.invalidate(!0)}}setImageSize(t,e){if(t!=this.imageWidth||e!=this.imageHeight){switch(this.imageWidth=t,this.imageHeight=e,this.stickyZoom){case 0:this.constrainTranslation();break;case 1:this.zoomToFit();break;case 2:this.zoom1To1()}this.invalidate(!0)}}invalidate(t){for(let e of this.views)e.invalidate(t)}}class St{constructor(...t){this.children=[],this.transform=new xt(this),this.visible=!0,this.fixedCoordinates=!1,this.handler=void 0,this.add(...t)}setView(t){this.view=t;for(let e of this.children)e.setView(t)}add(...t){this.children||(this.children=[]),this.children.push(...t);for(let e of t)e.parent=this,e.setView(this.view);return this}getPropagatedScale(){let t=this.transform.getScale();return this.parent&&(t*=this.parent.getPropagatedScale()),t}getScale(){return this.view.getScale()}transformEvent(t){return this.transform.transformEvent(t,this.fixedCoordinates)}transformEventWithAncestors(t){return this.parent&&(t=this.parent.transformEventWithAncestors(t)),this.transformEvent(t)}transformContext(t){this.transform.transformContext(t,this.fixedCoordinates)}inFixedCoordinates(t,e){t.context.save(),this.transform.transformContext(t,!0),e(),t.context.restore()}inCanvasCoordinates(t,e){t.context.save(),t.context.resetTransform(),e(),t.context.restore()}drawTo(t){if(this.visible){t.context.save(),this.transformContext(t),this.drawInner(t);for(let e of this.children)e.drawTo(t);this.drawInnerAfterChildren(t),t.context.restore()}}invalidate(t){this.visible&&this.view&&this.view.invalidate(t)}drawInner(t){}drawInnerAfterChildren(t){}moveHandlerWithPropagation(t){const e=this.transformEvent(t);if(this.children.length>0)for(let t=this.children.length-1;t>=0;t--){const i=this.children[t];if(i.visible){const t=i.moveHandlerWithPropagation(e);if(t)return t}}return this.moveHandler(e)}dblClick(t){return!0}moveHandler(t){if(this.handler&&this.handler.moveHandler(t))return this}mouseCursor(t){if(this.handler)return this.handler.mouseCursor(t)}}class Pt extends St{constructor(t){super(),this.camera=t,this.eventHistory=[],this.panPxPerMs=tt.zero(),this.panimationListeners=[],this.panAnimationFrame=()=>{if(!this.hasPanSpeed())return;this.timerId=void 0;let t=Date.now(),e=t-this.lastPanFrameAt;this.lastPanFrameAt=t;let i=this.camera.getDx(),s=this.camera.getDy();if(this.camera.translateBy(this.panPxPerMs.x*e,this.panPxPerMs.y*e),this.firePanimationListeners(this.camera.getDx()-i,this.camera.getDy()-s),t-this.lastPanInteraction.timestamp>150){let t=.003*e/this.panPxPerMs.length();t>=1?(this.panPxPerMs.setXy(0,0),this.camera.invalidate()):(this.panPxPerMs.plusEqualsScaled(-t,this.panPxPerMs),this.triggerPanAnimation())}else this.triggerPanAnimation()}}addPanimationListener(t){this.panimationListeners.push(t)}removePanimationListener(t){this.panimationListeners=this.panimationListeners.filter((e=>e!=t))}firePanimationListeners(t,e){for(let i of this.panimationListeners)i(t,e)}moveHandler(t){if(1==t.type)"left"==t.button&&this.camera.stopAllPanAnimations();else if(2==t.type){if(this.camera.stopAllPanAnimations(),t.down&&"left"==t.button){const e=t.getRoot();this.camera.translateBy(e.pointerEvent.dx,e.pointerEvent.dy)}}else 3==t.type&&this.tryStartPanAnimation(t);return this.addEventToHistory(t),this}mouseCursor(t){return t?a.grab_closed:a.grab_open}stopPanAnimation(){this.timerId&&(clearTimeout(this.timerId),this.timerId=void 0,this.lastPanFrameAt=void 0,this.panPxPerMs.setXy(0,0),this.lastPanInteraction=void 0,this.camera.invalidate())}tryStartPanAnimation(t){if(this.lastPanInteraction=t,Date.now()-this.lastPinchZoomAt<500)return;let e=this.panAnimationReferenceEvent(t.timestamp-100);if(e){let i=Math.max(10,t.timestamp-e.timestamp);if(i<500){let s=1;if(this.panPxPerMs.setXy((t.x-e.x)/i,(t.y-e.y)/i).capLength(1.75*Math.sqrt(s)),this.hasPanSpeed())return this.lastPanFrameAt=Date.now(),void this.triggerPanAnimation()}}}triggerPanAnimation(){this.timerId||(this.timerId=setTimeout(this.panAnimationFrame,10))}hasPanSpeed(){return 0!=this.panPxPerMs.lengthSqr()}panAnimationReferenceEvent(t){let e=this.eventHistory,i=e[e.length-1];if(2==i.type){for(let s=e.length-1;s>=0;s--){let n=e[s];if(2!=n.type)return i;if(i=n,i.timestamp<t)return i}return i}}addEventToHistory(t){let e=t.timestamp;for(this.eventHistory.push(t);this.eventHistory[0]&&e-this.eventHistory[0].timestamp>1e3;)this.eventHistory.shift()}}class Tt{constructor(t,e,i){this.pointerId=t,this.pageX=e,this.pageY=i,this.pageXy=new tt(this.pageX,this.pageY)}}class Mt{constructor(t,e){this.imageView=t,this.isParent=e,this.touchPointsMap=new Map,this.startPinchZoom=void 0}numTouches(){return this.touchPointsMap.size}dup(){let t=new Mt(this.imageView,!1);for(let e of this.touchPointsMap.values())t.addOrUpdate(e);return t.pinchPageCenter=this.pinchPageCenter.dup(),t.pinchWidth=this.pinchWidth,t.pinchScale=this.pinchScale,t.pinchDxDy=this.pinchDxDy.dup(),t}addOrUpdate(t){let e=this.numTouches();this.touchPointsMap.set(t.pointerId,t);let i=this.numTouches();if(2==i){this.pinchPageCenter=tt.zero();for(let t of this.touchPointsMap.values())this.pinchPageCenter.plusEquals(t.pageXy);this.pinchPageCenter.timesEquals(.5),this.pinchWidth=0;for(let t of this.touchPointsMap.values())this.pinchWidth+=this.pinchPageCenter.distanceTo(t.pageXy);this.pinchWidth*=.5,this.pinchScale=this.imageView.getCamera().getScale(),this.pinchDxDy=this.imageView.getCamera().getDxDy()}this.isParent&&1==e&&2==i&&(this.startPinchZoom=this.dup())}remove(t){this.touchPointsMap.delete(t),this.numTouches()<2&&this.startPinchZoom&&(this.startPinchZoom=void 0)}}class kt{constructor(t,e,i,s,n){this.camera=t,this.root=e,this.canvas=i,this.topText=s,this.bottomText=n,this.visible=!1,this.redrawTimeout=void 0,this.lastRedrawAt=0,this.redrawRequestedAt=0,this.highDpiRatio=1,this.countWheelDeltaMod120IsZero=void 0,this.countDeltaYisNotInteger=void 0,this.isDiscreteDevice=!0,this.mightBeDiscreteDevice=!0,this.lastX=0,this.lastY=0,this.touchPointList=new Mt(this,!0),this.topTextMargin=20,this.mouseWheel=t=>{let e=c.cast(t.originalEvent);this.updateIsDiscrete(e);const i=_.zoomDelta(t,X.zoomStep,this.isDiscreteDevice),s=this.canvasXyFromPageXy(t);this.camera.stopAllPanAnimations(),this.camera.zoomAboutBy(s.canvasX,s.canvasY,i);let n=this.getStaticLastPointerEvent();n&&this.moveHandler(n),t.preventDefault()},this.pointerDown=t=>{this.checkAddDxDy(t),this.touchPointList.addOrUpdate(new Tt(t.pointerId,t.pageX,t.pageY)),1==this.touchPointList.numTouches()&&this.downHandler(t),t.isPrimary&&(this.lastPrimaryPointerEvent=t),t.stopPropagation()},this.pointerMove=t=>{this.checkAddDxDy(t),this.touchPointList.addOrUpdate(new Tt(t.pointerId,t.pageX,t.pageY));let e=this.touchPointList.numTouches();if(e<=1)this.moveHandler(t),t.isPrimary&&(this.lastPrimaryPointerEvent=t);else if(2==e){let t=this.touchPointList.startPinchZoom.pinchPageCenter,e=this.canvasPointFromPagePoint(t),i=this.touchPointList.startPinchZoom.pinchWidth,s=this.touchPointList.startPinchZoom.pinchScale,n=this.touchPointList.pinchPageCenter,r=(this.canvasPointFromPagePoint(n),s*this.touchPointList.pinchWidth/i);this.getCamera().zoomAboutTo(e.x,e.y,r),this.clearLastPrimaryPointerEvent(),this.grabLayer.lastPinchZoomAt=Date.now()}t.stopPropagation()},this.pointerUp=t=>{this.checkAddDxDy(t),this.touchPointList.remove(t.pointerId),0==this.touchPointList.numTouches()&&this.upHandler(t),1==this.touchPointList.numTouches()&&this.clearLastPrimaryPointerEvent(),t.stopPropagation()},this.pointerCancel=this.pointerUp,this.pointerLeave=this.pointerUp,this.contextMenu=t=>{t.preventDefault(),t.stopPropagation()},this.dblClick=t=>{let e=!0;if(this.lastMoveEvent){let t=this.hit(this.lastMoveEvent);if(t){let i=t.transformEventWithAncestors(this.lastMoveEvent);e=t.dblClick(i)}}e&&this.camera.dblClick()},this.draw=()=>{if(this.redrawTimeout=void 0,this.lastRedrawAt=Date.now(),!this.visible)return;const t=this.canvas.context();t.clearAll(),this.root.drawTo(t),this.topText&&t.drawCenteredText(this.topText,this.topTextMargin),this.bottomText&&t.drawCenteredText(this.bottomText,this.canvas.logicalHeight()-20)},this.register(),this.grabLayer=new Pt(t),this.grabLayer.setView(this),e.setView(this),t.register(this),e.transform=t,this.canvas.element.setAttribute("touch-action","none")}getCamera(){return this.camera}isDown(){return!!this.downNode}getScale(){return this.camera.getScale()}canvasWidth(){return this.canvas.width()}canvasHeight(){return this.canvas.height()}canvasWidthLogical(){return this.canvas.logicalWidth()}canvasHeightLogical(){return this.canvas.logicalHeight()}canvasRect(){return new it(0,0,this.canvasWidth(),this.canvasHeight())}canvasRectLogical(){return new it(0,0,this.canvasWidthLogical(),this.canvasHeightLogical())}setIsDark(t){this.canvas.$element.parent().toggleClass(a.dark_checker.name(),t)}setCanvasPad(t,e,i,s){this.camera.setCanvasPad(t,e,i,s)}deregister(){this.canvas.$element.off("mousewheel"),this.canvas.element.removeEventListener("pointerdown",this.pointerDown),this.canvas.element.removeEventListener("pointermove",this.pointerMove),this.canvas.element.removeEventListener("pointerup",this.pointerUp),this.canvas.element.removeEventListener("pointercancel",this.pointerCancel),this.canvas.element.removeEventListener("pointerleave",this.pointerLeave),this.canvas.element.removeEventListener("contextmenu",this.contextMenu),this.canvas.element.removeEventListener("dblclick",this.dblClick)}register(){this.canvas.$element.mousewheel(this.mouseWheel),this.canvas.element.addEventListener("pointerdown",this.pointerDown),this.canvas.element.addEventListener("pointermove",this.pointerMove),this.canvas.element.addEventListener("pointerup",this.pointerUp),this.canvas.element.addEventListener("pointercancel",this.pointerCancel),this.canvas.element.addEventListener("pointerleave",this.pointerLeave),this.canvas.element.addEventListener("contextmenu",this.contextMenu),this.canvas.element.addEventListener("dblclick",this.dblClick)}getStaticLastPointerEvent(){if(this.lastPrimaryPointerEvent){let t=$.extend(!0,{},this.lastPrimaryPointerEvent);return X.addMovement(t,0,0),t}}getLastMoveEvent(){return this.lastMoveEvent}stopPanAnimation(){this.grabLayer.stopPanAnimation()}simulateMoveEvent(t){this.lastMoveEvent=void 0,this.lastPrimaryPointerEvent=void 0,this.checkAddMoveClass(this.hit(t)),this.lastMoveEvent=t,this.lastPrimaryPointerEvent=t.pointerEvent}canvasXyFromPageXy(t){const e=this.canvas.$element.offset();return{canvasX:t.pageX-e.left,canvasY:t.pageY-e.top}}canvasPointFromPagePoint(t){const e=this.canvas.$element.offset();return new tt(t.x-e.left,t.y-e.top)}sceneMoveEvent(t,e,i){const s=this.canvas.$element.offset();return new bt(t,t.pageX-s.left,t.pageY-s.top,e,this.touchPointList.numTouches(),i)}updateIsDiscrete(t){let e=t.wheelDelta||t.wheelDeltaY||t.wheelDeltaX,i=t.deltaY||t.deltaX||t.deltaZ,s=t.deltaMode;if(void 0!==i){let t=!Number.isInteger(i);void 0===this.countDeltaYisNotInteger?this.countDeltaYisNotInteger=t?kt.ThreshDeltaIsNotInteger:0:t?this.countDeltaYisNotInteger++:this.countDeltaYisNotInteger=0}if(void 0===e){let t=0===s;this.mightBeDiscreteDevice=this.isDiscreteDevice=!t}else{let t=Math.abs(e)%120==0;void 0===this.countWheelDeltaMod120IsZero?this.countWheelDeltaMod120IsZero=t?kt.ThreshWheelDeltaMod120IsZero:0:t?this.countWheelDeltaMod120IsZero++:this.countWheelDeltaMod120IsZero=0,this.countWheelDeltaMod120IsZero>=kt.ThreshWheelDeltaMod120IsZero?this.mightBeDiscreteDevice=this.isDiscreteDevice=!0:_.isMac?this.mightBeDiscreteDevice=this.isDiscreteDevice=this.countDeltaYisNotInteger>=kt.ThreshDeltaIsNotInteger:(this.isDiscreteDevice=!1,this.mightBeDiscreteDevice=t)}}checkAddDxDy(t){this.lastPrimaryPointerEvent?X.addMovement(t,t.pageX-this.lastPrimaryPointerEvent.pageX,t.pageY-this.lastPrimaryPointerEvent.pageY):X.addMovement(t,t.movementX||0,t.movementY||0)}clearLastPrimaryPointerEvent(){this.lastPrimaryPointerEvent=void 0}hit(t){return this.hitNode=this.root.moveHandlerWithPropagation(t)||this.grabLayer.moveHandler(t)}checkAddClass(t){t&&this.canvas.$element.addClass(t.name())}checkRemoveClass(t){t&&this.canvas.$element.removeClass(t.name())}removeMoveClass(){this.checkRemoveClass(this.moveClass),this.moveClass=void 0}checkAddMoveClass(t){let e;t&&(e=t.mouseCursor(!1)),this.moveClass!=e&&(this.removeMoveClass(),this.checkAddClass(this.moveClass=e))}downHandler(t){if(this.moveHandler(t),this.downNode=this.hitNode,this.downNode){this.canvas.element.setPointerCapture(t.pointerId),this.downEvent=this.sceneMoveEvent(t,1);let e=this.sceneMoveEvent(t,1,this.downEvent);e=this.downNode.transformEventWithAncestors(e),this.downNode.moveHandler(e),a.body.$().addClass(a.noselect.name()),this.removeMoveClass(),this.downClass=this.downNode.mouseCursor(!0),this.downClass&&a.body.$().addClass(this.downClass.name())}}moveHandler(t){if(this.lastX=t.pageX,this.lastY=t.pageY,this.downNode){let e=this.sceneMoveEvent(t,2,this.downEvent);e=this.downNode.transformEventWithAncestors(e),this.downNode.moveHandler(e)}else this.lastMoveEvent=this.sceneMoveEvent(t,0),this.checkAddMoveClass(this.hit(this.lastMoveEvent))}upHandler(t){if(this.downNode){this.canvas.element.releasePointerCapture(t.pointerId),a.body.$().removeClass(a.noselect.name()),this.downClass&&a.body.$().removeClass(this.downClass.name()),this.downEvent=void 0,this.downNode=void 0,this.downClass=void 0;const e=this.sceneMoveEvent(t,3);this.checkAddMoveClass(this.hit(e))}else this.moveHandler(t)}invalidate(t){this.visible&&(t?(clearTimeout(this.redrawTimeout),this.draw()):this.redrawTimeout||(this.redrawRequestedAt=Date.now(),this.redrawTimeout=window.requestAnimationFrame(this.draw)))}invalidateMouseCursor(){if(this.visible)if(this.downNode){const t=this.downNode.mouseCursor(!0);t!=this.downClass&&(this.downClass&&a.body.$().removeClass(this.downClass.name()),this.downClass=t,this.downClass&&a.body.$().addClass(this.downClass.name()))}else this.lastMoveEvent&&this.checkAddMoveClass(this.hit(this.lastMoveEvent))}show(){this.visible||(this.visible=!0,this.invalidate(),this.canvas.$element.show())}checkSetSize(t,e){this.highDpiRatio=window.devicePixelRatio||1;const i=this.canvas.checkSetSize(t,e,this.highDpiRatio);this.camera.setCanvasSize(t,e,i)}hide(){this.visible=!1,this.canvas.$element.hide()}directDraw(t,e){t.save(),t.context.setTransform(this.highDpiRatio,0,0,this.highDpiRatio,0,0),e(t),t.restore()}}kt.ThreshWheelDeltaMod120IsZero=3,kt.ThreshDeltaIsNotInteger=3,function(t){const e=5,i=["","#FFF","#8d7e9b"];let s,n,r,o,h,c,l,p=-1,m=0,g=0,f=[],w=0,v=0,y=0,b=0;const x=a.Comparison.App.Viewport.parentOf(a.tag("canvas")).or(a.Comparison.App.Buttons.BgSwatch);function C(){const t=a.Comparison.App.Viewport.$().outerWidth()/2|0,e=a.Comparison.App.Viewport.$().outerHeight();for(let i of o)i.checkSetSize(t,e);s.setCanvasSize(t,e,!1)}function S(t){w=0|Math.max(0,Math.min(t,g));const i=w>>1,o=l;l=c[i];const h=l!=o;l.showingLeft=0==(1&w),t>g?(m=2,E.modal(a.Comparison.App.Modals.DoneAll)):0!=m||l.hasBigDifference()||(m=1,E.modal(a.Comparison.App.Modals.Done)),a.Comparison.App.Buttons.rating.$().removeClass("bttn_dark").addClass("bttn_white");let u=l.activeButton();if(u&&u.$().removeClass("bttn_white").addClass("bttn_dark"),r.setTitle(d.s("Result {0}",l.showingLeft?"1":"2")),h){s.setImageSize(l.spec.w,l.spec.h),s.zoomToFit(),l.ensureLoaded(),i+1<c.length&&c[i+1].ensureLoaded(),i+2<c.length&&c[i+2].ensureLoaded(),n.setImage(l.original);let t=l.spec;a.Comparison.App.AdminInfo.$().text(`${t.w}x${t.h}: ${t.iouI}`),a.Comparison.App.ProgressText.$().text(`${i} / ${y} / ${b}`).attr("title",`Done: ${i}\nTotal with large difference: ${y}\nTotal: ${b}`)}for(r.setImage(l.current()),T();f.length>e;)f.shift().clear()}function P(t,e=!1,i,s){let n=w;if(s)n=t>0?g:0;else if(e)for(n=-1==n?0:t>0?1+(1|n):(-2&n)-1;0<=n&&n<=g&&!c[n>>1].wantsRating();)n+=2*t;else if(i)for(n=t>0?1+(1|n):(-2&n)-1;0<=n&&n<=g&&c[n>>1].ratedSame();)n+=2*t;else n+=t;S(n)}function T(){for(let t of o)t.invalidate()}function M(t){l&&(l.assignUserRating(t),P(1,!1,!1,!1))}function k(t){switch(t.keyCode){case 38:return M(2);case 40:return M(1);case 8:case 37:return t.preventDefault(),P(-1,t.shiftKey,t.ctrlKey,t.altKey);case 39:return t.preventDefault(),P(1,t.shiftKey,t.ctrlKey,t.altKey);case 66:case 32:return A();case 27:case 36:return s.zoomToFit();case 35:return s.zoom1To1()}}function A(){p=(p+1)%i.length;let t=i[p];x.$().css("background-color",t),x.toggleClass(a.canvas_container,""==t)}t.startReviewing=function(){$(".navbar").hide(),$(".footer").hide(),$(".container >").hide(),a.Comparison.App.Container.$().show(),a.Comparison.App.Buttons.ThumbsUp.$().click((function(){M(2)})),a.Comparison.App.Buttons.ThumbsDown.$().click((function(){M(1)})),a.Comparison.App.Buttons.Help.$().click((function(){E.modal(a.Comparison.App.Modals.Help,!0)})),a.Comparison.App.Buttons.Exit.$().click((function(){location.reload()})),a.Comparison.App.Buttons.Prev.$().click((function(t){P(-1,t.shiftKey,t.ctrlKey,t.altKey)})),a.Comparison.App.Buttons.Next.$().click((function(t){P(1,t.shiftKey,t.ctrlKey,t.altKey)})),a.Comparison.App.Buttons.BgColor.$().click((function(t){A()})),a.$window.keydown(k),s=new Ct(100,100),n=new I(a.Comparison.App.CanvasOriginal,d.s("Original")),r=new I(a.Comparison.App.CanvasResult,d.s("Result")),o=[n,r],c=comparisonWorkspace.leftToRate.map((function(t){return new R(t)})),b=c.length,g=2*b-1;for(let t of c)t.wantsRating()&&v++,t.hasBigDifference()&&y++;0==v?S(0):(w=-1,P(1,!0,!1,!1)),a.$window.resize(C),C(),A(),E.modal(a.Comparison.App.Modals.Help,!0)};class I extends St{constructor(t,e=void 0){super(),this.id=t,this.canvasEx=new nt(1,1);let i=this.canvasEx.element;i.id=t.name(),a.Comparison.App.Viewport.$().append(i),this.canvasEx.$element.mouseleave((function(){h=void 0})),this.view=new kt(s,this,this.canvasEx,e),this.view.topTextMargin=80,this.view.show()}setTitle(t){this.view.topText=t}setImage(t){this.image=t}setCanvas(t){this.canvas=t}checkSetSize(t,e){return this.canvasEx.checkSetSize(t,e,window.devicePixelRatio||1)}drawInner(t){if(this.canvas?t.drawImage(this.canvas,0,0):this.image&&this.image.complete&&t.drawImage(this.image,0,0),h){let e=t.context;e.beginPath();let i=20/s.getScale();e.arc(h.x-i,h.y-i,i,0,2*Math.PI,!1),e.lineWidth=3/s.getScale(),e.strokeStyle="#FFF",e.stroke(),e.lineWidth=1/s.getScale(),e.strokeStyle="#000",e.stroke()}}moveHandler(t){h=t,T()}}class R{constructor(t){switch(this.spec=t,this.leftIsPixian=Math.random()<.5,this.showingLeft=!0,this.leftRating=0,this.rightRating=0,t.rating){case 0:this.set(0,0);break;case 1:this.set(2,2);break;case 2:this.set(1,1);break;case 3:this.set(2,1);break;case 4:this.set(1,2)}}set(t,e){this.leftIsPixian?(this.leftRating=t,this.rightRating=e):(this.leftRating=e,this.rightRating=t)}wantsRating(){return 0==this.spec.rating}ratedSame(){return 1==this.spec.rating||2==this.spec.rating}hasBigDifference(){return this.spec.iouI<W.IouThresholdI}userRatingToRating(t){if(this.showingLeft?this.leftRating=t:this.rightRating=t,0==this.leftRating||0==this.rightRating)return 0;{let t=2==(this.leftIsPixian?this.leftRating:this.rightRating),e=2==(this.leftIsPixian?this.rightRating:this.leftRating);return t&&e?1:t||e?t?3:4:2}}assignUserRating(t){this.spec.rating=this.userRatingToRating(t),0!=this.spec.rating&&$.ajax({url:u.csrf(`/comparisons/${comparisonWorkspace.id}/rate/${this.spec.oid}/${this.spec.rating}`),method:"POST",error:(t,e,i)=>{alert(`Error saving your rating: '${e}', '${i}'.\n\nPlease email comparisons@pixian.ai if this persists, thanks!`)}})}current(){return this.showingLeft?this.left():this.right()}left(){return this.leftIsPixian?this.pixian:this.result}right(){return this.leftIsPixian?this.result:this.pixian}ensureLoaded(){this.original||(this.original=this.loadImage(`/comparisons/${comparisonWorkspace.id}/original/${this.spec.oid}`),this.pixian=this.loadImage(`/comparisons/${comparisonWorkspace.id}/pixian/${this.spec.oid}`),this.result=this.loadImage(`/comparisons/${comparisonWorkspace.id}/result/${this.spec.rid}`),f.push(this))}loadImage(t){let e=new Image;return e.src=t,e.onload=T,e}clear(){this.original=this.pixian=this.result=void 0}activeRating(){return this.showingLeft?this.leftRating:this.rightRating}activeButton(){switch(this.activeRating()){case 0:return;case 2:return a.Comparison.App.Buttons.ThumbsUp;case 1:return a.Comparison.App.Buttons.ThumbsDown}}}}(V||(V={})),function(t){const e=3;let i,s=0,r=[],o=[],h=[],c=[];function l(){return"undefined"!=typeof comparisonWorkspace&&!!(comparisonWorkspace.uploadUrl||comparisonWorkspace.leftToRate.length>0)}function p(t,e){if(function(t,e){let i=t.indexOf(e);i>=0&&t.splice(i,1)}(o,t),e){h.push(this);let t=comparisonWorkspace.wantsOriginals?++comparisonWorkspace.uploadedOriginals:++comparisonWorkspace.uploadedResults;i.count.$().text(""+t)}else c.push(this);m()}function m(){o.length<e&&r.length>0&&r.shift().upload()}t.wanted=l,t.init=function(){return a.Comparison.StartRating.$().click(V.startReviewing),l()},t.handleNewFile=function(t){if(t.size>W.MaxBytesPerImage)E.fatalErrorStr(d.s("Terribly sorry, but that file is too large to process. Please try another."));else{let e=new g(t);i=comparisonWorkspace.wantsOriginals?a.Comparison.Originals:a.Comparison.Results,i.Table.$().show(),i.Table.anscestorOf(a.tag("tbody")).$().prepend(e.$html),r.push(e),m()}};class g{constructor(t){this.file=t,this.tableCellId=new n("FileUpload"+s++),this.percent0To100=0,this.errorHandler=t=>{this.tableCellId.$().text(`Error: ${t}`),p(this,!1)},this.successHandler=t=>{this.tableCellId.$().text("Done!"),p(this,!0)},this.progress=t=>{t=Math.max(t,1),this.percent0To100=t,this.tableCellId.$().html(`<div class="progress"><div class="progress-bar" style="width: ${t}%"></div></div>`)},this.$html=$(`<tr><td>${t.name}</td><td id="${this.tableCellId.name()}"><span class="i">Pending</span></td>`)}upload(){this.progress(0),o.push(this);let t={label:"",success:null,url:u.csrf(comparisonWorkspace.uploadUrl)},e={errorHandler:this.errorHandler,successHandler:this.successHandler};q.uploadRaw(this.file,t,e)}}}(Q||(Q={})),function(t){function e(t){return 0==t?"0.0%":100==t?"100.0%":t<.005||99.995<t?t.toFixed(4)+"%":t<.05||99.95<t?t.toFixed(3)+"%":t<.5||99.5<t?t.toFixed(2)+"%":t.toFixed(1)+"%"}function i(t){return t.toLocaleString("en-US")}t.init=function(){a.chart.$().each(((t,s)=>{const n=JSON.parse(s.dataset.x),r=JSON.parse(s.dataset.ys),o=s.dataset.labels&&JSON.parse(s.dataset.labels),a=s.dataset.colors&&JSON.parse(s.dataset.colors),h=s.dataset.title,c=s.dataset.unit,l=r.map(((t,e)=>{let i={data:t,fill:!0};return o&&o[e]&&(i.label=o[e]),a&&a[e]&&(i.borderColor=a[e],i.backgroundColor=a[e]),i}));let u="%"==c?e:i;new Chart(s,{type:"line",data:{labels:n,datasets:l},options:{plugins:{legend:{display:!!o,position:"right",reverse:!0,labels:{boxWidth:12}},title:{display:!!h,text:h},tooltip:{callbacks:{label:function(t){let e=t.dataset.label||"";return e&&(e+=": "),null!==t.parsed.y&&(e+=u(t.parsed.y)),e}}}},elements:{point:{pointStyle:!1,hitRadius:7}},scales:{y:{suggestedMax:100,suggestedMin:0,ticks:{beginAtZero:!0,callback:(t,e,i)=>u(t)}}}}})}))}}(j||(j={})),function(t){let e;!function(t){t[t.paypal=0]="paypal",t[t.fake=1]="fake"}(e||(e={}));function i(t){let e=[];function i(t,i){e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}function s(t,e){if($.isArray(e))$.each(e,(function(e,i){s(t+"["+e+"]",i)}));else if("object"==$.type(e))for(let i in e)e.hasOwnProperty(i)&&s(t+"."+i,e[i]);else i(t,e)}i(GlobalsShared.localeQueryParameter,GlobalsShared.locale);for(let e in t)t.hasOwnProperty(e)&&s(e,t[e]);return e.join("&").replace(" ","+")}function s(t){return function(e,i,s){t({error:{message:r(e,i)}})}}function r(t,e){if(0===t.status)return d.s("Failed to connect to the server.")+"\n"+d.s("Please verify your network connection.")+"\n";{const i=t.responseText.toString().substring(0,200);return t.status<200||299<t.status?t.statusText+" ["+t.status+"]\n"+i:"parsererror"===e?d.s("Failed to parse JSON response.")+" ["+e+"]\n"+i:"timeout"===e?d.s("Request time out.")+" ["+e+"]":"abort"===e?d.s("Request aborted by the server.")+" ["+e+"]":d.s("Unknown error.")+"\n"+i}}function o(){return merchantJs.settings.host+"/payments/v0/preapprovals/"+merchantJs.settings.wud+"/"}function h(t,e){let n=o()+"payment_method?"+i(t);$.ajax(n,{dataType:"jsonp",timeout:3e4,success:function(t){e(t)},error:s(e)})}let c,l,u,p;!function(t){let n=null,r=null;function a(){n&&(r&&(clearInterval(r),r=null),n.close(),n=null)}function c(t,r,h){a(),n=window.open("","_blank"),n.document.write("<h3>Loading...</h3>");var c=o()+e[t]+"?"+i(r);$.ajax(c,{dataType:"jsonp",timeout:3e4,success:function(t){h(t)},error:s(h)})}t.handler=function(t){return function(e,i,s){c(t,e,(function(t){var e,o;!t||t.error?(a(),i(t)):(e=t.preapproval.processorToken.url,o=function(){s(),h(t.preapproval,i)},n&&(n.location.href=e,n.focus(),r=setInterval((function(){n.closed&&(clearInterval(r),r=null,o())}),100)))}))}}}(c||(c={})),function(t){t.initialize=function(){return!0},t.pay=function(t){t({error:{message:"Unavailable"}})},t.radioButton=function(){return new n("__unavailable_payment_processor__")},t.name=function(){return"unavailable"}}(l||(l={})),function(t){let e,i,s;t.initialize=function(){return"undefined"!=typeof Stripe&&(e=Stripe(merchantJs.settings.stripePublishableKey),i=e.elements({locale:GlobalsShared.locale}),s=i.create("card",{style:{base:{lineHeight:"1.429"}}}),s.mount(a.merchant.StripeCardElement.css()),s.on("change",(function(t){t&&t.error?a.merchant.StripeCardErrors.$().text(t.error.message):a.merchant.StripeCardErrors.$().text("")})),s.on("focus",(function(){a.merchant.StripeCardElement.$().addClass("focus")})),s.on("blur",(function(){a.merchant.StripeCardElement.$().removeClass("focus")})),!0)},t.pay=function(t){f(),e.createToken(s,{name:a.merchant.StripeNameElement.$().val()}).then((function(e){if(e.error)t({error:{message:e.error.message}});else{y();const i=e.token;h({processor:"stripe",processorToken:{id:i.id,card:i.card},preapprovalSpec:merchantJs.preapprovalSpec},t)}}))},t.radioButton=function(){return a.merchant.RadioStripe},t.name=function(){return"stripe"}}(u||(u={})),function(t){let e;t.initialize=function(){if("undefined"!=typeof braintree){let t=!0;return braintree.dropin.create({authorization:merchantJs.settings.braintreeTokenizationKey,container:a.merchant.BraintreeDropinContainer.css(),locale:GlobalsShared.locale.replace("-","_"),card:{cardholderName:!0},dataCollector:{kount:!0}}).then((function(t){e=t})).catch((function(e){t=!1,f(),a.merchant.PaymentError.$().text(e.message).show()})),t}return!1},t.pay=function(t){f(),e.requestPaymentMethod((function(i,s){if(i)e.clearSelectedPaymentMethod(),t({error:i});else{y();h({processor:"braintree",processorToken:s,preapprovalSpec:merchantJs.preapprovalSpec},(function(i){i.error&&e.clearSelectedPaymentMethod(),t(i)}))}}))},t.radioButton=function(){return a.merchant.RadioBraintree},t.name=function(){return"braintree"}}(p||(p={}));const m=c.handler(e.paypal),g=c.handler(e.fake);function f(){a.merchant.PaymentError.$().hide(),a.merchant.StripePaymentError.$().hide(),a.merchant.PaymentMethodFormSubmit.$().attr("disabled","disabled")}function w(){a.merchant.PaymentMethodFormSubmit.$().removeAttr("disabled")}function v(t){a.merchant.PaymentError.$().html("<p>"+t).show(),w()}function y(){a.merchant.ShowWhenMinibrowsing.$().modal("hide"),a.merchant.ShowWhenCreatingPm.$().modal("show")}function b(t){a.merchant.ShowWhenMinibrowsing.$().modal("hide"),a.merchant.ShowWhenCreatingPm.$().modal("hide"),null===t?v("Got a null response from the server"):t.error?v(t.error.message):(a.merchant.ShowWhenSubmitting.$().modal("show"),C({streamlexPaymentToken:t.paymentMethod.streamlexPaymentToken,defaultPaymentMethod:x}))}let x="stripe",C=null;$((function(){"undefined"!=typeof merchantJs&&(!function(t){C=t;let e=!1,i=!1;merchantJs.settings.braintreePrimary?merchantJs.settings.canBraintree?e=!0:merchantJs.settings.canStripe&&(i=!0):merchantJs.settings.canStripe?i=!0:merchantJs.settings.canBraintree&&(e=!0);const s=e?p:i?u:l,n=s.initialize(),r=n&&(merchantJs.settings.canBraintree||merchantJs.settings.canStripe||merchantJs.settings.canPaypal);x=s.name();const o=$("input[type=radio][name=paymentMethod]");let h=null,c=!1;o.change((function(){var t;a.merchant.CreditCardProcessorForm.$().toggle(s.radioButton().$().prop("checked")),h=$(this),c=merchantJs.needZipCode&&("paypal"==(t=h.data("processor")||h.val())||"fake"==t),a.merchant.TaxSection.$().toggle(c)})),$("#paymentMethod_"+merchantJs.defaultPaymentMethod).prop("checked",!0).change(),a.merchant.AcceptTermsWrapper.$().removeClass(a.merchant.has_error.name()),a.merchant.InitializingIndicator.$().hide(),a.merchant.SubmitSection.$().show(),a.merchant.PaymentMethodForm.$().submit((function(){x=h&&h.val()||s.name();let e=!1;if(c){let t=/^\d{5}$/,i=(""+a.merchant.TaxPostalCode.$().val()).trim();t.test(i)?(a.merchant.TaxPostalCodeFormGroup.removeClass(a.merchant.has_error),a.merchant.TaxLocationPostalCode.$().val(i)):(a.merchant.TaxPostalCodeFormGroup.addClass(a.merchant.has_error),e=!0)}if(a.merchant.AcceptTerms.$().prop("checked")?a.merchant.AcceptTermsWrapper.removeClass(a.merchant.has_error):(a.merchant.AcceptTermsWrapper.addClass(a.merchant.has_error),e=!0),e)return!1;switch(f(),x){case"stripe":u.pay(b);break;case"braintree":p.pay(b);break;case"paypal":a.merchant.ShowWhenMinibrowsing.$().modal("show"),m(merchantJs.preapprovalSpec,b,y);break;case"fake":merchantJs.settings.isTesting&&(a.merchant.ShowWhenMinibrowsing.$().modal("show"),g(merchantJs.preapprovalSpec,b,y));break;default:a.merchant.ShowWhenSubmitting.$().modal("show"),t({streamlexPaymentToken:x,defaultPaymentMethod:x})}return!1})),r?w():(f(),n||a.merchant.FailedToLoadPaymentBackendJs.$().show())}((function(t){a.merchant.StreamlexPaymentToken.$().val(t.streamlexPaymentToken),a.merchant.DefaultPaymentMethod.$().val(t.defaultPaymentMethod),a.merchant.PaymentForm.$().submit()})),$(window).on("load",(function(){(new Image).src="https://www.paypal.com/home"})))}))}(J||(J={})),function(t){F.RecodeJpegQuality=.75,D.Mega=1e6;let e={};try{e=window.localStorage||{}}catch(t){}let i,s=null,n=!1;function r(){return $(window).off("beforeunload"),location.reload(),!1}function o(t,e=!0){Date.now();if(!n)return;let i=t.type.toLowerCase().split(";")[0];F.loadImageShrinkAndThumbnail(e,t,(e=>{E.gaTrack("image","loadFailed","Type: "+i+", Ext: "+E.getExtensionWithDot(t.name).toLowerCase()),E.fatalErrorStr(d.s('Failed to read image file with name: "{0}", and type: "{1}".',t.name,t.type))}),((t,e,s)=>{e.size>W.MaxBytesPerImage?E.fatalErrorStr(d.s("Terribly sorry, but that file is too large to process. Please try another.")):(E.gaTrack("image","uploaded",i),N.add(e,s))}),!0)}function c(t,e,i){if(!n)return;E.gaTrack("image","fromUrl",t),E.progress(!0);let s=null;T.download({url:t,displayUrl:i,progress:E.progressUpdate,error:E.fatalErrorStr,success:t=>{e&&(t.name=e),s=t,E.progress(!1),o(s)}})}function l(t){let e=t.keyCode;C.isCommandOrCtrl(e)?a.ctl_key.$().addClass(a.active_key.name()):86==e&&a.v_key.$().addClass(a.active_key.name())}function u(t){let e=a.v_key.$(),i=t.keyCode;C.isCommandOrCtrl(i)&&(a.ctl_key.$().removeClass(a.active_key.name()),e.removeClass(a.active_key.name())),86==i&&e.removeClass(a.active_key.name())}function p(){a.ctl_key.$().removeClass(a.active_key.name()),a.v_key.$().removeClass(a.active_key.name())}function m(t){if(t){a.v_key.$().addClass(a.active_key.name());let t=a.ctl_key.$().parent();t.hasClass(a.pasted.name())||(t.addClass(a.pasted.name()),setTimeout((()=>{p(),t.removeClass(a.pasted.name())}),3e3))}else a.paste_buttons.$().addClass(a.wrong_shake.name()),null!=i&&clearTimeout(i),i=setTimeout((()=>{a.paste_buttons.$().removeClass(a.wrong_shake.name()),p()}),600)}function g(t,e,i,s,n){alert(`Error: event: '${t}', source: '${e}', lineno: '${i}', colno: '${s}', error: '${n}'`)}t.afterPaste=m,$(document).ready((function(){a.jsNotInitializedYet.removeClass(a.jsNotInitializedYet),n=function(){if(null==s){if(s=I.list(),s.length>0){let t="<h1>"+d.s("Unsupported Browser")+"</h1><p>"+d.s("Terribly sorry, but your browser appears to be missing key feature(s) required to use this website:")+"</p><ul>";for(let e=0;e<s.length;e++)t+="<li>"+s[e]+"</li>";t+="</ul>",t+="<div>"+d.s("Please try the latest version of one of these browsers instead: <b>{0}, {1}, {2}</b>.",'<a href="'+W.BrowserChromeUrl+'">Chrome</a>','<a href="'+W.BrowserFirefoxUrl+'">Firefox</a>','<a href="'+W.BrowserMicrosoftEdgeUrl+'">Microsoft Edge</a>')+"</div>",a.App.ModernizrAlert.$().html(t).slideDown(500)}s.length>0&&(a.body.$().addClass(a.cannot_run_app.name()),a.App.starter.$().attr("disabled","disabled").addClass("disabled"),a.App.starter.anscestorOf(a.tag("button")).$().attr("disabled","disabled").addClass("disabled"))}else s.length>0&&(a.htmlBody.$().scrollTop(0),E.blink(a.App.ModernizrAlert));return 0==s.length&&(a.App.App.$().length>0||a.Card.Template.$().length>0||Q.wanted())}();let t=window.Globals.assets[window.GlobalsEx.model];if(n){H.initialize(),a.App.cancel_upload.$().click(r),a.App.force_exit.$().click(r),a.App.exit_app.$().click(r);const e=new k.Particles(a.popup_drop_target_particles_container.$(),{r:78,g:55,b:100,a:255});k.NumExplodingFrames=10;const i=Q.init(),s=i?Q.handleNewFile:o;S.initialize({monitor_file_input:a.FileInput.Field,monitor_paste:a.FileInput.PasteTarget,monitor_drag:a.body,hover_class:a.drop_ready,error:t=>{alert(t)},drop:t=>{for(let e=0;e<t.length;e++)s(t[e],1==t.length)},onDragEnter:t=>e.mouseInHandler(t),onDragOver:t=>e.mouseMoveHandler(t),onDragLeave:t=>e.mouseOutHandler(t),beforeDrop:()=>e.explode(),hideDurationMs:100,pastedUrl:function(t){i||c(G.fetchUrl(t),void 0,t)},afterPaste:m,dropOnce:!1}),M.initialize(a.FileInput.UploadFromWeb.show_dialog,(function(t){c(G.fetchUrl(t),void 0,t)})),a.App.new_from_url_link.$().click((function(t){if(0==t.button){let t=$(this);return c(t.data("url"),t.data("filename")),!1}return!0})),a.FileInput.click_to_upload.$().click((function(){let t=a.FileInput.Field.el();t.value=null,t.click()})),navigator.clipboard&&navigator.clipboard.write&&a.Card.CardList.addClass(a.CopyToClipboard.supported),N.initialize();let n=$(window);n.keydown(l),n.keyup(u),a.BeforeAfter.try_this_btn.$().click((()=>{E.loadFileFromUrl(t.wildcat_jpeged,"example.jpeg",(t=>{o(t)}))})),A.setFileReceiver(o)}new rt(a.BeforeAfter.container.css(),t.wildcat_jpeged,t.wildcat_smoothed,window.devicePixelRatio||1);h.checkInit(),j.init(),a.tabLink.$().click((function(t){t.preventDefault(),$("."+$(this).data("tab")).each((function(t,e){$(e).tab("show")}))})),"localhost"==location.hostname&&(window.onerror=g)}))}(Y||(Y={}))}("undefined"==typeof MainExport?MainExport={}:MainExport);